!function(n,t){typeof define=="function"&&define.amd?define(t):typeof exports=="object"?module.exports=t():n.Phaser=t()}(this,function(){function f(){return t.Matrix=typeof Float32Array!="undefined"?Float32Array:Array,t.Matrix}var t=t||{},n=n||{VERSION:"1.1.5",DEV_VERSION:"1.1.5",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,SPRITE:0,BUTTON:1,BULLET:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,CANVAS_PX_ROUND:!1,CANVAS_CLEAR_RECT:!0},r,u,i;return t.InteractionManager=function(){},n.Utils={shuffle:function(n){for(var i,r,t=n.length-1;t>0;t--)i=Math.floor(Math.random()*(t+1)),r=n[t],n[t]=n[i],n[i]=r;return n},pad:function(n,t,i,r){var t,i,r,u,f,e;if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=" "),typeof r=="undefined"&&(r=3),u=0,t+1>=n.length)switch(r){case 1:n=Array(t+1-n.length).join(i)+n;break;case 3:f=Math.ceil((u=t-n.length)/2);e=u-f;n=Array(e+1).join(i)+n+Array(f+1).join(i);break;default:n=n+Array(t+1-n.length).join(i)}return n},isPlainObject:function(n){if(typeof n!="object"||n.nodeType||n===n.window)return!1;try{if(n.constructor&&!hasOwn.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,f,r,i,o,s,t=arguments[0]||{},u=1,c=arguments.length,h=!1;for(typeof t=="boolean"&&(h=t,t=arguments[1]||{},u=2),c===u&&(t=this,--u);u<c;u++)if((e=arguments[u])!=null)for(f in e)(r=t[f],i=e[f],t!==i)&&(h&&i&&(n.Utils.isPlainObject(i)||(o=Array.isArray(i)))?(o?(o=!1,s=r&&Array.isArray(r)?r:[]):s=r&&n.Utils.isPlainObject(r)?r:{},t[f]=n.Utils.extend(h,s,i)):i!==undefined&&(t[f]=i));return t}},t.hex2rgb=function(n){return[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]},typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(){var n=Array.prototype.slice;return function(t){function r(){var u=f.concat(n.call(arguments));i.apply(this instanceof r?this:t,u)}var i=this,f=n.call(arguments,1);if(typeof i!="function")throw new TypeError;return r.prototype=function u(n){return n&&(u.prototype=n),(this instanceof u)?void 0:new u}(i.prototype),r}}()),Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)=="[object Array]"}),f(),t.mat3={},t.mat3.create=function(){var n=new t.Matrix(9);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},t.mat3.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},t.mat4={},t.mat4.create=function(){var n=new t.Matrix(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},t.mat3.multiply=function(n,t,i){i||(i=n);var r=n[0],u=n[1],f=n[2],e=n[3],o=n[4],s=n[5],h=n[6],c=n[7],l=n[8],a=t[0],v=t[1],y=t[2],p=t[3],w=t[4],b=t[5],k=t[6],d=t[7],g=t[8];return i[0]=a*r+v*e+y*h,i[1]=a*u+v*o+y*c,i[2]=a*f+v*s+y*l,i[3]=p*r+w*e+b*h,i[4]=p*u+w*o+b*c,i[5]=p*f+w*s+b*l,i[6]=k*r+d*e+g*h,i[7]=k*u+d*o+g*c,i[8]=k*f+d*s+g*l,i},t.mat3.clone=function(n){var i=new t.Matrix(9);return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},t.mat3.transpose=function(n,t){if(!t||n===t){var i=n[1],r=n[2],u=n[5];return n[1]=n[3],n[2]=n[6],n[3]=i,n[5]=n[7],n[6]=r,n[7]=u,n}return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],t},t.mat3.toMat4=function(n,i){return i||(i=t.mat4.create()),i[15]=1,i[14]=0,i[13]=0,i[12]=0,i[11]=0,i[10]=n[8],i[9]=n[7],i[8]=n[6],i[7]=0,i[6]=n[5],i[5]=n[4],i[4]=n[3],i[3]=0,i[2]=n[2],i[1]=n[1],i[0]=n[0],i},t.mat4.create=function(){var n=new t.Matrix(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},t.mat4.transpose=function(n,t){if(!t||n===t){var i=n[1],r=n[2],u=n[3],f=n[6],e=n[7],o=n[11];return n[1]=n[4],n[2]=n[8],n[3]=n[12],n[4]=i,n[6]=n[9],n[7]=n[13],n[8]=r,n[9]=f,n[11]=n[14],n[12]=u,n[13]=e,n[14]=o,n}return t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15],t},t.mat4.multiply=function(n,t,i){i||(i=n);var o=n[0],s=n[1],h=n[2],c=n[3],l=n[4],a=n[5],v=n[6],y=n[7],p=n[8],w=n[9],b=n[10],k=n[11],d=n[12],g=n[13],nt=n[14],tt=n[15],r=t[0],u=t[1],f=t[2],e=t[3];return i[0]=r*o+u*l+f*p+e*d,i[1]=r*s+u*a+f*w+e*g,i[2]=r*h+u*v+f*b+e*nt,i[3]=r*c+u*y+f*k+e*tt,r=t[4],u=t[5],f=t[6],e=t[7],i[4]=r*o+u*l+f*p+e*d,i[5]=r*s+u*a+f*w+e*g,i[6]=r*h+u*v+f*b+e*nt,i[7]=r*c+u*y+f*k+e*tt,r=t[8],u=t[9],f=t[10],e=t[11],i[8]=r*o+u*l+f*p+e*d,i[9]=r*s+u*a+f*w+e*g,i[10]=r*h+u*v+f*b+e*nt,i[11]=r*c+u*y+f*k+e*tt,r=t[12],u=t[13],f=t[14],e=t[15],i[12]=r*o+u*l+f*p+e*d,i[13]=r*s+u*a+f*w+e*g,i[14]=r*h+u*v+f*b+e*nt,i[15]=r*c+u*y+f*k+e*tt,i},t.Point=function(n,t){this.x=n||0;this.y=t||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.constructor=t.Point,t.Rectangle=function(n,t,i,r){this.x=n||0;this.y=t||0;this.width=i||0;this.height=r||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1},t.Rectangle.prototype.constructor=t.Rectangle,t.Polygon=function(n){var r,i,u;if(n instanceof Array||(n=Array.prototype.slice.call(arguments)),typeof n[0]=="number"){for(r=[],i=0,u=n.length;i<u;i+=2)r.push(new t.Point(n[i],n[i+1]));n=r}this.points=n},t.Polygon.prototype.clone=function(){for(var i=[],n=0;n<this.points.length;n++)i.push(this.points[n].clone());return new t.Polygon(i)},t.Polygon.prototype.contains=function(n,t){for(var r=!1,i=0,u=this.points.length-1;i<this.points.length;u=i++){var e=this.points[i].x,f=this.points[i].y,s=this.points[u].x,o=this.points[u].y,h=f>t!=o>t&&n<(s-e)*(t-f)/(o-f)+e;h&&(r=!r)}return r},t.Polygon.prototype.constructor=t.Polygon,t.DisplayObject=function(){this.last=this;this.first=this;this.position=new t.Point;this.scale=new t.Point(1,1);this.pivot=new t.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.buttonMode=!1;this.renderable=!1;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=t.mat3.create();this.localTransform=t.mat3.create();this.color=[];this.dynamic=!0;this._sr=0;this._cr=1;this.filterArea=new t.Rectangle(0,0,1,1)},t.DisplayObject.prototype.constructor=t.DisplayObject,t.DisplayObject.prototype.setInteractive=function(n){this.interactive=n},Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(n){this._interactive=n;this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(n){n?this._mask?(n.start=this._mask.start,n.end=this._mask.end):(this.addFilter(n),n.renderable=!1):(this.removeFilter(this._mask),this._mask.renderable=!0);this._mask=n}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(n){var r,t,u,i;if(n){for(this._filters&&this.removeFilter(this._filters),this.addFilter(n),r=[],t=0;t<n.length;t++)for(u=n[t].passes,i=0;i<u.length;i++)r.push(u[i]);n.start.filterPasses=r}else this._filters&&this.removeFilter(this._filters);this._filters=n}}),t.DisplayObject.prototype.addFilter=function(n){var i=new t.FilterBlock,f=new t.FilterBlock,e,o,r,u,s,h;for(n.start=i,n.end=f,i.data=n,f.data=n,i.first=i.last=this,f.first=f.last=this,i.open=!0,i.target=this,e=i,o=i,u=this.first._iPrev,u?(r=u._iNext,e._iPrev=u,u._iNext=e):r=this,r&&(r._iPrev=o,o._iNext=r),e=f,o=f,r=null,u=null,u=this.last,r=u._iNext,r&&(r._iPrev=o,o._iNext=r),e._iPrev=u,u._iNext=e,s=this,h=this.last;s;)s.last===h&&(s.last=f),s=s.parent;this.first=i;this.__renderGroup&&this.__renderGroup.addFilterBlocks(i,f)},t.DisplayObject.prototype.removeFilter=function(n){var f=n.start,t=f._iNext,i=f._iPrev,r,e,u;for(t&&(t._iPrev=i),i&&(i._iNext=t),this.first=f._iNext,r=n.end,t=r._iNext,i=r._iPrev,t&&(t._iPrev=i),i._iNext=t,e=r._iPrev,u=this;u.last===r;)if(u.last=e,u=u.parent,!u)break;this.__renderGroup&&this.__renderGroup.removeFilterBlocks(f,r)},t.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var n=this.localTransform,i=this.parent.worldTransform,r=this.worldTransform;n[0]=this._cr*this.scale.x;n[1]=-this._sr*this.scale.y;n[3]=this._sr*this.scale.x;n[4]=this._cr*this.scale.y;var c=this.pivot.x,l=this.pivot.y,a=n[0],v=n[1],u=this.position.x-n[0]*c-l*n[1],y=n[3],p=n[4],f=this.position.y-n[4]*l-c*n[3],e=i[0],o=i[1],w=i[2],s=i[3],h=i[4],b=i[5];n[2]=u;n[5]=f;r[0]=e*a+o*y;r[1]=e*v+o*p;r[2]=e*u+o*f+w;r[3]=s*a+h*y;r[4]=s*v+h*p;r[5]=s*u+h*f+b;this.worldAlpha=this.alpha*this.parent.worldAlpha;this.vcount=t.visibleCount},t.visibleCount=0,t.DisplayObjectContainer=function(){t.DisplayObject.call(this);this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,t.DisplayObjectContainer.prototype.addChild=function(n){var t,f,e,u,r,i,o;if(n.parent&&n.parent!==this&&n.parent.removeChild(n),n.parent=this,this.children.push(n),this.stage){t=n;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}for(f=n.first,e=n.last,r=this._filters||this._mask?this.last._iPrev:this.last,u=r._iNext,i=this,o=r;i;)i.last===o&&(i.last=n.last),i=i.parent;u&&(u._iPrev=e,e._iNext=u);f._iPrev=r;r._iNext=f;this.__renderGroup&&(n.__renderGroup&&n.__renderGroup.removeDisplayObjectAndChildren(n),this.__renderGroup.addDisplayObjectAndChildren(n))},t.DisplayObjectContainer.prototype.addChildAt=function(n,t){var i,e,o,f,u,r,s;if(t>=0&&t<=this.children.length){if(n.parent!==undefined&&n.parent.removeChild(n),n.parent=this,this.stage){i=n;do i.interactive&&(this.stage.dirty=!0),i.stage=this.stage,i=i._iNext;while(i)}if(e=n.first,o=n.last,t===this.children.length)for(u=this.last,r=this,s=this.last;r;)r.last===s&&(r.last=n.last),r=r.parent;else u=t===0?this:this.children[t-1].last;f=u._iNext;f&&(f._iPrev=o,o._iNext=f);e._iPrev=u;u._iNext=e;this.children.splice(t,0,n);this.__renderGroup&&(n.__renderGroup&&n.__renderGroup.removeDisplayObjectAndChildren(n),this.__renderGroup.addDisplayObjectAndChildren(n))}else throw new Error(n+" The index "+t+" supplied is out of bounds "+this.children.length);},t.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.children.indexOf(n),r=this.children.indexOf(t);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.removeChild(n);this.removeChild(t);i<r?(this.addChildAt(t,i),this.addChildAt(n,r)):(this.addChildAt(n,r),this.addChildAt(t,i))}},t.DisplayObjectContainer.prototype.getChildAt=function(n){if(n>=0&&n<this.children.length)return this.children[n];throw new Error("Both the supplied DisplayObjects must be a child of the caller "+this);},t.DisplayObjectContainer.prototype.removeChild=function(n){var e=this.children.indexOf(n),s,t,i;if(e!==-1){var u=n.first,r=n.last,f=r._iNext,o=u._iPrev;if(f&&(f._iPrev=o),o._iNext=f,this.last===r)for(s=u._iPrev,t=this;t.last===r;)if(t.last=s,t=t.parent,!t)break;if(r._iNext=null,u._iPrev=null,this.stage){i=n;do i.interactive&&(this.stage.dirty=!0),i.stage=null,i=i._iNext;while(i)}n.__renderGroup&&n.__renderGroup.removeDisplayObjectAndChildren(n);n.parent=undefined;this.children.splice(e,1)}else throw new Error(n+" The supplied DisplayObject must be a child of the caller "+this);},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){t.DisplayObject.prototype.updateTransform.call(this);for(var n=0,i=this.children.length;n<i;n++)this.children[n].updateTransform()}},t.blendModes={},t.blendModes.NORMAL=0,t.blendModes.SCREEN=1,t.Sprite=function(n){t.DisplayObjectContainer.call(this);this.anchor=new t.Point;this.texture=n;this.blendMode=t.blendModes.NORMAL;this._width=0;this._height=0;n.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind));this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}}),t.Sprite.prototype.setTexture=function(n){this.texture.baseTexture!==n.baseTexture?(this.textureChange=!0,this.texture=n,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=n;this.updateFrame=!0},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height);this.updateFrame=!0},t.Sprite.fromFrame=function(n){var i=t.TextureCache[n];if(!i)throw new Error('The frameId "'+n+'" does not exist in the texture cache'+this);return new t.Sprite(i)},t.Sprite.fromImage=function(n){var i=t.Texture.fromImage(n);return new t.Sprite(i)},t.Stage=function(n){t.DisplayObjectContainer.call(this);this.worldTransform=t.mat3.create();this.interactive=!0;this.interactionManager=new t.InteractionManager(this);this.dirty=!0;this.__childrenAdded=[];this.__childrenRemoved=[];this.stage=this;this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5);this.setBackgroundColor(n);this.worldVisible=!0},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(n){this.interactionManager.setTargetDomElement(n)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;this.vcount=t.visibleCount;for(var n=0,i=this.children.length;n<i;n++)this.children[n].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0);this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(n){this.backgroundColor=n||0;this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i;this.backgroundColorString="#"+i},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},t.CustomRenderable=function(){t.DisplayObject.call(this);this.renderable=!0},t.CustomRenderable.prototype=Object.create(t.DisplayObject.prototype),t.CustomRenderable.prototype.constructor=t.CustomRenderable,t.CustomRenderable.prototype.renderCanvas=function(){},t.CustomRenderable.prototype.initWebGL=function(){},t.CustomRenderable.prototype.renderWebGL=function(){},t.Strip=function(n,i,r){t.DisplayObjectContainer.call(this);this.texture=n;this.blendMode=t.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]);this.colors=new Float32Array([1,1,1,1]);this.indices=new Uint16Array([0,1,2,3])}catch(u){this.uvs=[0,1,1,1,1,0,0,1];this.verticies=[0,0,0,0,0,0,0,0,0];this.colors=[1,1,1,1];this.indices=[0,1,2,3]}this.width=i;this.height=r;n.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind));this.renderable=!0},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype.setTexture=function(n){this.texture=n;this.width=n.frame.width;this.height=n.frame.height;this.updateFrame=!0},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Rope=function(n,i){t.Strip.call(this,n);this.points=i;try{this.verticies=new Float32Array(i.length*4);this.uvs=new Float32Array(i.length*4);this.colors=new Float32Array(i.length*2);this.indices=new Uint16Array(i.length*2)}catch(r){this.verticies=new Array(i.length*4);this.uvs=new Array(i.length*4);this.colors=new Array(i.length*2);this.indices=new Array(i.length*2)}this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var u=this.points,o,s,n,r,i;if(!(u.length<1)){var t=this.uvs,h=u[0],f=this.indices,e=this.colors;for(this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,e[0]=1,e[1]=1,f[0]=0,f[1]=1,o=u.length,i=1;i<o;i++)s=u[i],n=i*4,r=i/(o-1),i%2?(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1):(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1),n=i*2,e[n]=1,e[n+1]=1,n=i*2,f[n]=n,f[n+1]=n+1,h=s}},t.Rope.prototype.updateTransform=function(){var e=this.points,r,s,n,i,h,f,o,c,l,a,u;if(!(e.length<1)){for(r=e[0],n={x:0,y:0},this.count-=.2,i=this.verticies,i[0]=r.x+n.x,i[1]=r.y+n.y,i[2]=r.x-n.x,i[3]=r.y-n.y,h=e.length,u=1;u<h;u++)f=e[u],o=u*4,s=u<e.length-1?e[u+1]:f,n.y=-(s.x-r.x),n.x=s.y-r.y,c=(1-u/(h-1))*10,c>1&&(c=1),l=Math.sqrt(n.x*n.x+n.y*n.y),a=this.texture.height/2,n.x/=l,n.y/=l,n.x*=a,n.y*=a,i[o]=f.x+n.x,i[o+1]=f.y+n.y,i[o+2]=f.x-n.x,i[o+3]=f.y-n.y,r=f;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(n){this.texture=n;this.updateFrame=!0},t.TilingSprite=function(n,i,r){t.DisplayObjectContainer.call(this);this.texture=n;this.width=i;this.height=r;this.tileScale=new t.Point(1,1);this.tilePosition=new t.Point(0,0);this.renderable=!0;this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,t.TilingSprite.prototype.setTexture=function(n){this.texture=n;this.updateFrame=!0},t.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.AbstractFilter=function(n,t){this.passes=[this];this.dirty=!0;this.padding=0;this.uniforms=t||{};this.fragmentSrc=n||[]},t.FilterBlock=function(){this.visible=!0;this.renderable=!0},t.Graphics=function(){t.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.currentPath={points:[]}},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,t.Graphics.prototype.lineStyle=function(n,i,r){this.currentPath.points.length||this.graphicsData.pop();this.lineWidth=n||0;this.lineColor=i||0;this.lineAlpha=arguments.length<3?1:r;this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY};this.graphicsData.push(this.currentPath)},t.Graphics.prototype.moveTo=function(n,i){this.currentPath.points.length||this.graphicsData.pop();this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:t.Graphics.POLY};this.currentPath.points.push(n,i);this.graphicsData.push(this.currentPath)},t.Graphics.prototype.lineTo=function(n,t){this.currentPath.points.push(n,t);this.dirty=!0},t.Graphics.prototype.beginFill=function(n,t){this.filling=!0;this.fillColor=n||0;this.fillAlpha=arguments.length<2?1:t},t.Graphics.prototype.endFill=function(){this.filling=!1;this.fillColor=null;this.fillAlpha=1},t.Graphics.prototype.drawRect=function(n,i,r,u){this.currentPath.points.length||this.graphicsData.pop();this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[n,i,r,u],type:t.Graphics.RECT};this.graphicsData.push(this.currentPath);this.dirty=!0},t.Graphics.prototype.drawCircle=function(n,i,r){this.currentPath.points.length||this.graphicsData.pop();this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[n,i,r,r],type:t.Graphics.CIRC};this.graphicsData.push(this.currentPath);this.dirty=!0},t.Graphics.prototype.drawEllipse=function(n,i,r,u){this.currentPath.points.length||this.graphicsData.pop();this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[n,i,r,u],type:t.Graphics.ELIP};this.graphicsData.push(this.currentPath);this.dirty=!0},t.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=!1;this.dirty=!0;this.clearDirty=!0;this.graphicsData=[];this.bounds=null},t.Graphics.prototype.updateFilterBounds=function(){var l,y,p,h,c;if(!this.bounds){var u=Infinity,o=-Infinity,f=Infinity,s=-Infinity,e,n,i;for(l=0;l<this.graphicsData.length;l++){var a=this.graphicsData[l],v=a.type,r=a.lineWidth;if(e=a.points,v===t.Graphics.RECT)n=e.x-r/2,i=e.y-r/2,y=e.width+r,p=e.height+r,u=n<u?n:u,o=n+y>o?n+y:o,f=i<f?n:f,s=i+p>s?i+p:s;else if(v===t.Graphics.CIRC||v===t.Graphics.ELIP)n=e.x,i=e.y,h=e.radius+r/2,u=n-h<u?n-h:u,o=n+h>o?n+h:o,f=i-h<f?i-h:f,s=i+h>s?i+h:s;else for(c=0;c<e.length;c+=2)n=e[c],i=e[c+1],u=n-r<u?n-r:u,o=n+r>o?n+r:o,f=i-r<f?i-r:f,s=i+r>s?i+r:s}this.bounds=new t.Rectangle(u,f,o-u,s-f)}},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(n,i){for(var r,u,c,f=n.worldAlpha,h="",b=0;b<n.graphicsData.length;b++)if(r=n.graphicsData[b],u=r.points,i.strokeStyle=h="#"+("00000"+(r.lineColor|0).toString(16)).substr(-6),i.lineWidth=r.lineWidth,r.type===t.Graphics.POLY){for(i.beginPath(),i.moveTo(u[0],u[1]),c=1;c<u.length/2;c++)i.lineTo(u[c*2],u[c*2+1]);u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*f,i.fillStyle=h="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*f,i.stroke())}else if(r.type===t.Graphics.RECT)(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*f,i.fillStyle=h="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fillRect(u[0],u[1],u[2],u[3])),r.lineWidth&&(i.globalAlpha=r.lineAlpha*f,i.strokeRect(u[0],u[1],u[2],u[3]));else if(r.type===t.Graphics.CIRC)i.beginPath(),i.arc(u[0],u[1],u[2],0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*f,i.fillStyle=h="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*f,i.stroke());else if(r.type===t.Graphics.ELIP){var a=r.points,v=a[2]*2,y=a[3]*2,o=a[0]-v/2,l=a[1]-y/2;i.beginPath();var g=.5522848,p=v/2*g,w=y/2*g,k=o+v,d=l+y,s=o+v/2,e=l+y/2;i.moveTo(o,e);i.bezierCurveTo(o,e-w,s-p,l,s,l);i.bezierCurveTo(s+p,l,k,e-w,k,e);i.bezierCurveTo(k,e+w,s+p,d,s,d);i.bezierCurveTo(s-p,d,o,e+w,o,e);i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*f,i.fillStyle=h="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*f,i.stroke())}},t.CanvasGraphics.renderGraphicsMask=function(n,i){var w=n.graphicsData.length,c,u,r,s;if(w!==0)for(w>1&&(w=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")),c=0;c<1;c++)if(u=n.graphicsData[c],r=u.points,u.type===t.Graphics.POLY){for(i.beginPath(),i.moveTo(r[0],r[1]),s=1;s<r.length/2;s++)i.lineTo(r[s*2],r[s*2+1]);r[0]===r[r.length-2]&&r[1]===r[r.length-1]&&i.closePath()}else if(u.type===t.Graphics.RECT)i.beginPath(),i.rect(r[0],r[1],r[2],r[3]),i.closePath();else if(u.type===t.Graphics.CIRC)i.beginPath(),i.arc(r[0],r[1],r[2],0,2*Math.PI),i.closePath();else if(u.type===t.Graphics.ELIP){var l=u.points,a=l[2]*2,v=l[3]*2,e=l[0]-a/2,h=l[1]-v/2;i.beginPath();var d=.5522848,y=a/2*d,p=v/2*d,b=e+a,k=h+v,o=e+a/2,f=h+v/2;i.moveTo(e,f);i.bezierCurveTo(e,f-p,o-y,h,o,h);i.bezierCurveTo(o+y,h,b,f-p,b,f);i.bezierCurveTo(b,f+p,o+y,k,o,k);i.bezierCurveTo(o-y,k,e,f+p,e,f);i.closePath()}},t.CanvasRenderer=function(n,t,i,r){this.transparent=r;this.width=n||800;this.height=t||600;this.view=i||document.createElement("canvas");this.context=this.view.getContext("2d");this.smoothProperty=null;"imageSmoothingEnabled"in this.context?this.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.smoothProperty="oImageSmoothingEnabled");this.scaleMode=null;this.refresh=!0;this.view.width=this.width;this.view.height=this.height;this.count=0},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(n){t.texturesToUpdate=[];t.texturesToDestroy=[];t.visibleCount++;n.updateTransform();this.view.style.backgroundColor===n.backgroundColorString||this.transparent||(this.view.style.backgroundColor=n.backgroundColorString);this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(n);n.interactive&&(n._interactiveEventsAdded||(n._interactiveEventsAdded=!0,n.interactionManager.setTarget(this)));t.Texture.frameUpdates.length>0&&(t.Texture.frameUpdates=[])},t.CanvasRenderer.prototype.resize=function(n,t){this.width=n;this.height=t;this.view.width=n;this.view.height=t},t.CanvasRenderer.prototype.renderDisplayObject=function(n){var i,r=this.context,o,u,e,s,f;r.globalCompositeOperation="source-over";o=n.last._iNext;n=n.first;do{if(i=n.worldTransform,!n.visible){n=n.last._iNext;continue}if(!n.renderable){n=n._iNext;continue}n instanceof t.Sprite?(u=n.texture.frame,u&&u.width&&u.height&&n.texture.baseTexture.source&&(r.globalAlpha=n.worldAlpha,r.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),this.smoothProperty&&this.scaleMode!==n.texture.baseTexture.scaleMode&&(this.scaleMode=n.texture.baseTexture.scaleMode,r[this.smoothProperty]=this.scaleMode===t.BaseTexture.SCALE_MODE.LINEAR),r.drawImage(n.texture.baseTexture.source,u.x,u.y,u.width,u.height,n.anchor.x*-u.width,n.anchor.y*-u.height,u.width,u.height))):n instanceof t.Strip?(r.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),this.renderStrip(n)):n instanceof t.TilingSprite?(r.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),this.renderTilingSprite(n)):n instanceof t.CustomRenderable?(r.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),n.renderCanvas(this)):n instanceof t.Graphics?(r.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),t.CanvasGraphics.renderGraphics(n,r)):n instanceof t.FilterBlock&&n.data instanceof t.Graphics&&(e=n.data,n.open?(r.save(),s=e.alpha,f=e.worldTransform,r.setTransform(f[0],f[3],f[1],f[4],f[2],f[5]),e.worldAlpha=.5,r.worldAlpha=0,t.CanvasGraphics.renderGraphicsMask(e,r),r.clip(),e.worldAlpha=s):r.restore());n=n._iNext}while(n!==o)},t.CanvasRenderer.prototype.renderStripFlat=function(n){var t=this.context,i=n.verticies,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;u<f-2;u++){var r=u*2,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h);t.lineTo(o,c);t.lineTo(s,l)}t.fillStyle="#FF0000";t.fill();t.closePath()},t.CanvasRenderer.prototype.renderTilingSprite=function(n){var t=this.context,i,r;t.globalAlpha=n.worldAlpha;n.__tilePattern||(n.__tilePattern=t.createPattern(n.texture.baseTexture.source,"repeat"));t.beginPath();i=n.tilePosition;r=n.tileScale;t.scale(r.x,r.y);t.translate(i.x,i.y);t.fillStyle=n.__tilePattern;t.fillRect(-i.x,-i.y,n.width/r.x,n.height/r.y);t.scale(1/r.x,1/r.y);t.translate(-i.x,-i.y);t.closePath()},t.CanvasRenderer.prototype.renderStrip=function(n){var i=this.context,h=n.verticies,w=n.uvs,d=h.length/2,k;for(this.count++,k=1;k<d-2;k++){var t=k*2,c=h[t],l=h[t+2],a=h[t+4],v=h[t+1],y=h[t+3],p=h[t+5],r=w[t]*n.texture.width,u=w[t+2]*n.texture.width,f=w[t+4]*n.texture.width,e=w[t+1]*n.texture.height,o=w[t+3]*n.texture.height,s=w[t+5]*n.texture.height;i.save();i.beginPath();i.moveTo(c,v);i.lineTo(l,y);i.lineTo(a,p);i.closePath();i.clip();var b=r*o+e*f+u*s-o*f-e*u-r*s,g=c*o+e*a+l*s-o*a-e*l-c*s,nt=r*l+c*f+u*a-l*f-c*u-r*a,tt=r*o*a+e*l*f+c*u*s-c*o*f-e*u*a-r*l*s,it=v*o+e*p+y*s-o*p-e*y-v*s,rt=r*y+v*f+u*p-y*f-v*u-r*p,ut=r*o*p+e*y*f+v*u*s-v*o*f-e*u*p-r*y*s;i.transform(g/b,it/b,nt/b,rt/b,tt/b,ut/b);i.drawImage(n.texture.baseTexture.source,0,0);i.restore()}},t.PixiShader=function(){this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.textureCount=0},t.PixiShader.prototype.init=function(){var n=t.compileProgram(this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc),i=t.gl,r;i.useProgram(n);this.uSampler=i.getUniformLocation(n,"uSampler");this.projectionVector=i.getUniformLocation(n,"projectionVector");this.offsetVector=i.getUniformLocation(n,"offsetVector");this.dimensions=i.getUniformLocation(n,"dimensions");this.aVertexPosition=i.getAttribLocation(n,"aVertexPosition");this.colorAttribute=i.getAttribLocation(n,"aColor");this.aTextureCoord=i.getAttribLocation(n,"aTextureCoord");for(r in this.uniforms)this.uniforms[r].uniformLocation=i.getUniformLocation(n,r);this.initUniforms();this.program=n},t.PixiShader.prototype.initUniforms=function(){var i,r,n;this.textureCount=1;for(r in this.uniforms)i=this.uniforms[r],n=i.type,n==="sampler2D"?(i._init=!1,i.value!==null&&this.initSampler2D(i)):n==="mat2"||n==="mat3"||n==="mat4"?(i.glMatrix=!0,i.glValueLength=1,n==="mat2"?i.glFunc=t.gl.uniformMatrix2fv:n==="mat3"?i.glFunc=t.gl.uniformMatrix3fv:n==="mat4"&&(i.glFunc=t.gl.uniformMatrix4fv)):(i.glFunc=t.gl["uniform"+n],i.glValueLength=n==="2f"||n==="2i"?2:n==="3f"||n==="3i"?3:n==="4f"||n==="4i"?4:1)},t.PixiShader.prototype.initSampler2D=function(n){if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t.gl.activeTexture(t.gl["TEXTURE"+this.textureCount]),t.gl.bindTexture(t.gl.TEXTURE_2D,n.value.baseTexture._glTexture),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.gl.LINEAR,o=i.minFilter?i.minFilter:t.gl.LINEAR,u=i.wrapS?i.wrapS:t.gl.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.gl.CLAMP_TO_EDGE,r=i.luminance?t.gl.LUMINANCE:t.gl.RGBA;if(i.repeat&&(u=t.gl.REPEAT,f=t.gl.REPEAT),t.gl.pixelStorei(t.gl.UNPACK_FLIP_Y_WEBGL,!1),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.gl.texImage2D(t.gl.TEXTURE_2D,0,r,s,h,c,r,t.gl.UNSIGNED_BYTE,null)}else t.gl.texImage2D(t.gl.TEXTURE_2D,0,r,t.gl.RGBA,t.gl.UNSIGNED_BYTE,n.value.baseTexture.source);t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MAG_FILTER,e);t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,o);t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_WRAP_S,u);t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_WRAP_T,f)}t.gl.uniform1i(n.uniformLocation,this.textureCount);n._init=!0;this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){var n,i;this.textureCount=1;for(i in this.uniforms)n=this.uniforms[i],n.glValueLength===1?n.glMatrix===!0?n.glFunc.call(t.gl,n.uniformLocation,n.transpose,n.value):n.glFunc.call(t.gl,n.uniformLocation,n.value):n.glValueLength===2?n.glFunc.call(t.gl,n.uniformLocation,n.value.x,n.value.y):n.glValueLength===3?n.glFunc.call(t.gl,n.uniformLocation,n.value.x,n.value.y,n.value.z):n.glValueLength===4?n.glFunc.call(t.gl,n.uniformLocation,n.value.x,n.value.y,n.value.z,n.value.w):n.type==="sampler2D"&&(n._init?(t.gl.activeTexture(t.gl["TEXTURE"+this.textureCount]),t.gl.bindTexture(t.gl.TEXTURE_2D,n.value.baseTexture._glTexture),t.gl.uniform1i(n.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(n))},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],t.PrimitiveShader=function(){this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor  * alpha;","}"]},t.PrimitiveShader.prototype.init=function(){var n=t.compileProgram(this.vertexSrc,this.fragmentSrc),i=t.gl;i.useProgram(n);this.projectionVector=i.getUniformLocation(n,"projectionVector");this.offsetVector=i.getUniformLocation(n,"offsetVector");this.aVertexPosition=i.getAttribLocation(n,"aVertexPosition");this.colorAttribute=i.getAttribLocation(n,"aColor");this.translationMatrix=i.getUniformLocation(n,"translationMatrix");this.alpha=i.getUniformLocation(n,"alpha");this.program=n},t.StripShader=function(){this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","   gl_FragColor = gl_FragColor * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"]},t.StripShader.prototype.init=function(){var n=t.compileProgram(this.vertexSrc,this.fragmentSrc),i=t.gl;i.useProgram(n);this.uSampler=i.getUniformLocation(n,"uSampler");this.projectionVector=i.getUniformLocation(n,"projectionVector");this.offsetVector=i.getUniformLocation(n,"offsetVector");this.colorAttribute=i.getAttribLocation(n,"aColor");this.aVertexPosition=i.getAttribLocation(n,"aVertexPosition");this.aTextureCoord=i.getAttribLocation(n,"aTextureCoord");this.translationMatrix=i.getUniformLocation(n,"translationMatrix");this.alpha=i.getUniformLocation(n,"alpha");this.program=n},t._batchs=[],t._getBatch=function(n){return t._batchs.length===0?new t.WebGLBatch(n):t._batchs.pop()},t._returnBatch=function(n){n.clean();t._batchs.push(n)},t._restoreBatchs=function(n){for(var i=0;i<t._batchs.length;i++)t._batchs[i].restoreLostContext(n)},t.WebGLBatch=function(n){this.gl=n;this.size=0;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.uvBuffer=n.createBuffer();this.colorBuffer=n.createBuffer();this.blendMode=t.blendModes.NORMAL;this.dynamicSize=1},t.WebGLBatch.prototype.constructor=t.WebGLBatch,t.WebGLBatch.prototype.clean=function(){this.verticies=[];this.uvs=[];this.indices=[];this.colors=[];this.dynamicSize=1;this.texture=null;this.last=null;this.size=0;this.head=null;this.tail=null},t.WebGLBatch.prototype.restoreLostContext=function(n){this.gl=n;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.uvBuffer=n.createBuffer();this.colorBuffer=n.createBuffer()},t.WebGLBatch.prototype.init=function(n){n.batch=this;this.dirty=!0;this.blendMode=n.blendMode;this.texture=n.texture.baseTexture;this.head=n;this.tail=n;this.size=1;this.growBatch()},t.WebGLBatch.prototype.insertBefore=function(n,t){this.size++;n.batch=this;this.dirty=!0;var i=t.__prev;t.__prev=n;n.__next=t;i?(n.__prev=i,i.__next=n):this.head=n},t.WebGLBatch.prototype.insertAfter=function(n,t){this.size++;n.batch=this;this.dirty=!0;var i=t.__next;t.__next=n;n.__prev=t;i?(n.__next=i,i.__prev=n):this.tail=n},t.WebGLBatch.prototype.remove=function(n){if(this.size--,this.size===0){n.batch=null;n.__prev=null;n.__next=null;return}n.__prev?n.__prev.__next=n.__next:(this.head=n.__next,this.head.__prev=null);n.__next?n.__next.__prev=n.__prev:(this.tail=n.__prev,this.tail.__next=null);n.batch=null;n.__next=null;n.__prev=null;this.dirty=!0},t.WebGLBatch.prototype.split=function(n){var i,r;for(this.dirty=!0,i=new t.WebGLBatch(this.gl),i.init(n),i.texture=this.texture,i.tail=this.tail,this.tail=n.__prev,this.tail.__next=null,n.__prev=null,r=0;n;)r++,n.batch=i,n=n.__next;return i.size=r,this.size-=r,i},t.WebGLBatch.prototype.merge=function(n){this.dirty=!0;this.tail.__next=n.head;n.head.__prev=this.tail;this.size+=n.size;this.tail=n.tail;for(var t=n.head;t;)t.batch=this,t=t.__next},t.WebGLBatch.prototype.growBatch=function(){var n=this.gl,u,r,t,i;for(this.dynamicSize=this.size===1?1:this.size*1.5,this.verticies=new Float32Array(this.dynamicSize*8),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.verticies,n.DYNAMIC_DRAW),this.uvs=new Float32Array(this.dynamicSize*8),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.bufferData(n.ARRAY_BUFFER,this.uvs,n.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(this.dynamicSize*4),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),n.bufferData(n.ARRAY_BUFFER,this.colors,n.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(this.dynamicSize*6),u=this.indices.length/6,r=0;r<u;r++)t=r*6,i=r*4,this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW)},t.WebGLBatch.prototype.refresh=function(){var u,t,r,i;for(this.dynamicSize<this.size&&this.growBatch(),u=0,i=this.head;i;){t=u*8;var o=i.texture,n=o.frame,f=o.baseTexture.width,e=o.baseTexture.height;this.uvs[t+0]=n.x/f;this.uvs[t+1]=n.y/e;this.uvs[t+2]=(n.x+n.width)/f;this.uvs[t+3]=n.y/e;this.uvs[t+4]=(n.x+n.width)/f;this.uvs[t+5]=(n.y+n.height)/e;this.uvs[t+6]=n.x/f;this.uvs[t+7]=(n.y+n.height)/e;i.updateFrame=!1;r=u*4;this.colors[r]=this.colors[r+1]=this.colors[r+2]=this.colors[r+3]=i.worldAlpha;i=i.__next;u++}this.dirtyUVS=!0;this.dirtyColors=!0},t.WebGLBatch.prototype.update=function(){for(var e,tt,it,rt,ut,o,s,h,c,n,l,a,v,y,p,w,k=0,i=this.head,r=this.verticies,f=this.uvs,d=this.colors,b;i;){if(i.vcount===t.visibleCount){if(tt=i.texture.frame.width,it=i.texture.frame.height,rt=i.anchor.x,ut=i.anchor.y,o=tt*(1-rt),s=tt*-rt,h=it*(1-ut),c=it*-ut,n=k*8,e=i.worldTransform,l=e[0],a=e[3],v=e[1],y=e[4],p=e[2],w=e[5],r[n+0]=l*s+v*c+p,r[n+1]=y*c+a*s+w,r[n+2]=l*o+v*c+p,r[n+3]=y*c+a*o+w,r[n+4]=l*o+v*h+p,r[n+5]=y*h+a*o+w,r[n+6]=l*s+v*h+p,r[n+7]=y*h+a*s+w,i.updateFrame||i.texture.updateFrame){this.dirtyUVS=!0;var ft=i.texture,u=ft.frame,g=ft.baseTexture.width,nt=ft.baseTexture.height;f[n+0]=u.x/g;f[n+1]=u.y/nt;f[n+2]=(u.x+u.width)/g;f[n+3]=u.y/nt;f[n+4]=(u.x+u.width)/g;f[n+5]=(u.y+u.height)/nt;f[n+6]=u.x/g;f[n+7]=(u.y+u.height)/nt;i.updateFrame=!1}i.cacheAlpha!==i.worldAlpha&&(i.cacheAlpha=i.worldAlpha,b=k*4,d[b]=d[b+1]=d[b+2]=d[b+3]=i.worldAlpha,this.dirtyColors=!0)}else n=k*8,r[n+0]=r[n+1]=r[n+2]=r[n+3]=r[n+4]=r[n+5]=r[n+6]=r[n+7]=0;k++;i=i.__next}},t.WebGLBatch.prototype.render=function(n,i){var r,u,f;(n=n||0,i===undefined&&(i=this.size),this.dirty&&(this.refresh(),this.dirty=!1),this.size!==0)&&(this.update(),r=this.gl,u=t.defaultShader,r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.verticies),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,r.bufferSubData(r.ARRAY_BUFFER,0,this.uvs)),r.vertexAttribPointer(u.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture._glTexture),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,r.bufferSubData(r.ARRAY_BUFFER,0,this.colors)),r.vertexAttribPointer(u.colorAttribute,1,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f=i-n,r.drawElements(r.TRIANGLES,f*6,r.UNSIGNED_SHORT,n*12))},t.WebGLFilterManager=function(n){this.transparent=n;this.filterStack=[];this.texturePool=[];this.offsetX=0;this.offsetY=0;this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(n,t){this.width=n.x*2;this.height=-n.y*2;this.buffer=t},t.WebGLFilterManager.prototype.pushFilter=function(n){var r=t.gl,e,u,i,f;this.filterStack.push(n);e=n.filterPasses[0];this.offsetX+=n.target.filterArea.x;this.offsetY+=n.target.filterArea.y;u=this.texturePool.pop();u?u.resize(this.width,this.height):u=new t.FilterTexture(this.width,this.height);r.bindTexture(r.TEXTURE_2D,u.texture);this.getBounds(n.target);i=n.target.filterArea;f=e.padding;i.x-=f;i.y-=f;i.width+=f*2;i.height+=f*2;i.x<0&&(i.x=0);i.width>this.width&&(i.width=this.width);i.y<0&&(i.y=0);i.height>this.height&&(i.height=this.height);r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer);r.viewport(0,0,i.width,i.height);t.projection.x=i.width/2;t.projection.y=-i.height/2;t.offset.x=-i.x;t.offset.y=-i.y;r.uniform2f(t.defaultShader.projectionVector,i.width/2,-i.height/2);r.uniform2f(t.defaultShader.offsetVector,-i.x,-i.y);r.colorMask(!0,!0,!0,!0);r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT);n._glFilterTexture=u},t.WebGLFilterManager.prototype.popFilter=function(){var n=t.gl,r=this.filterStack.pop(),i=r.target.filterArea,c=r._glFilterTexture,f,u,l,p,w,b,y,s,h;if(r.filterPasses.length>1){for(n.viewport(0,0,i.width,i.height),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexArray),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvArray),f=c,u=this.texturePool.pop(),u||(u=new t.FilterTexture(this.width,this.height)),n.bindFramebuffer(n.FRAMEBUFFER,u.frameBuffer),n.clear(n.COLOR_BUFFER_BIT),n.disable(n.BLEND),l=0;l<r.filterPasses.length-1;l++)p=r.filterPasses[l],n.bindFramebuffer(n.FRAMEBUFFER,u.frameBuffer),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,f.texture),this.applyFilterPass(p,i,i.width,i.height),w=f,f=u,u=w;n.enable(n.BLEND);c=f;this.texturePool.push(u)}b=r.filterPasses[r.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var e=this.width,o=this.height,a=0,v=0,k=this.buffer;this.filterStack.length===0?n.colorMask(!0,!0,!0,this.transparent):(y=this.filterStack[this.filterStack.length-1],i=y.target.filterArea,e=i.width,o=i.height,a=i.x,v=i.y,k=y._glFilterTexture.frameBuffer);t.projection.x=e/2;t.projection.y=-o/2;t.offset.x=a;t.offset.y=v;i=r.target.filterArea;s=i.x-a;h=i.y-v;n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=s;this.vertexArray[1]=h+i.height;this.vertexArray[2]=s+i.width;this.vertexArray[3]=h+i.height;this.vertexArray[4]=s;this.vertexArray[5]=h;this.vertexArray[6]=s+i.width;this.vertexArray[7]=h;n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexArray);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;n.bufferSubData(n.ARRAY_BUFFER,0,this.uvArray);n.viewport(0,0,e,o);n.bindFramebuffer(n.FRAMEBUFFER,k);n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,c.texture);this.applyFilterPass(b,i,e,o);n.useProgram(t.defaultShader.program);n.uniform2f(t.defaultShader.projectionVector,e/2,-o/2);n.uniform2f(t.defaultShader.offsetVector,-a,-v);this.texturePool.push(c);r._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(n,i,r,u){var f=t.gl,e=n.shader;e||(e=new t.PixiShader,e.fragmentSrc=n.fragmentSrc,e.uniforms=n.uniforms,e.init(),n.shader=e);f.useProgram(e.program);f.uniform2f(e.projectionVector,r/2,-u/2);f.uniform2f(e.offsetVector,0,0);n.uniforms.dimensions&&(n.uniforms.dimensions.value[0]=this.width,n.uniforms.dimensions.value[1]=this.height,n.uniforms.dimensions.value[2]=this.vertexArray[0],n.uniforms.dimensions.value[3]=this.vertexArray[5]);e.syncUniforms();f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0)},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var n=t.gl;this.vertexBuffer=n.createBuffer();this.uvBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertexArray,n.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.bufferData(n.ARRAY_BUFFER,this.uvArray,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),n.STATIC_DRAW)},t.WebGLFilterManager.prototype.getBounds=function(n){var s,et,ot,ht,ct,h,c,l,a,st,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,u=n.first,lt=n.last._iNext,f=-Infinity,e=-Infinity,i=Infinity,r=Infinity,o;do u.visible&&(u instanceof t.Sprite?(et=u.texture.frame.width,ot=u.texture.frame.height,ht=u.anchor.x,ct=u.anchor.y,h=et*(1-ht),c=et*-ht,l=ot*(1-ct),a=ot*-ct,st=!0):u instanceof t.Graphics&&(u.updateFilterBounds(),o=u.bounds,et=o.width,ot=o.height,h=o.x,c=o.x+o.width,l=o.y,a=o.y+o.height,st=!0)),st&&(s=u.worldTransform,v=s[0],y=s[3],p=s[1],w=s[4],b=s[2],k=s[5],d=v*c+p*a+b,it=w*a+y*c+k,g=v*h+p*a+b,rt=w*a+y*h+k,nt=v*h+p*l+b,ut=w*l+y*h+k,tt=v*c+p*l+b,ft=w*l+y*c+k,i=d<i?d:i,i=g<i?g:i,i=nt<i?nt:i,i=tt<i?tt:i,r=it<r?it:r,r=rt<r?rt:r,r=ut<r?ut:r,r=ft<r?ft:r,f=d>f?d:f,f=g>f?g:f,f=nt>f?nt:f,f=tt>f?tt:f,e=it>e?it:e,e=rt>e?rt:e,e=ut>e?ut:e,e=ft>e?ft:e),st=!1,u=u._iNext;while(u!==lt);n.filterArea.x=i;n.filterArea.y=r;n.filterArea.width=f-i;n.filterArea.height=e-r},t.FilterTexture=function(n,i){var r=t.gl;this.frameBuffer=r.createFramebuffer();this.texture=r.createTexture();r.bindTexture(r.TEXTURE_2D,this.texture);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer);r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer);r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture,0);this.resize(n,i)},t.FilterTexture.prototype.resize=function(n,i){if(this.width!==n||this.height!==i){this.width=n;this.height=i;var r=t.gl;r.bindTexture(r.TEXTURE_2D,this.texture);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,i,0,r.RGBA,r.UNSIGNED_BYTE,null)}},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(n,i){var r=t.gl,u;n._webGL||(n._webGL={points:[],indices:[],lastIndex:0,buffer:r.createBuffer(),indexBuffer:r.createBuffer()});n.dirty&&(n.dirty=!1,n.clearDirty&&(n.clearDirty=!1,n._webGL.lastIndex=0,n._webGL.points=[],n._webGL.indices=[]),t.WebGLGraphics.updateGraphics(n));t.activatePrimitiveShader();u=t.mat3.clone(n.worldTransform);t.mat3.transpose(u);r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);r.uniformMatrix3fv(t.primitiveShader.translationMatrix,!1,u);r.uniform2f(t.primitiveShader.projectionVector,i.x,-i.y);r.uniform2f(t.primitiveShader.offsetVector,-t.offset.x,-t.offset.y);r.uniform1f(t.primitiveShader.alpha,n.worldAlpha);r.bindBuffer(r.ARRAY_BUFFER,n._webGL.buffer);r.vertexAttribPointer(t.primitiveShader.aVertexPosition,2,r.FLOAT,!1,24,0);r.vertexAttribPointer(t.primitiveShader.colorAttribute,4,r.FLOAT,!1,24,8);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n._webGL.indexBuffer);r.drawElements(r.TRIANGLE_STRIP,n._webGL.indices.length,r.UNSIGNED_SHORT,0);t.deactivatePrimitiveShader()},t.WebGLGraphics.updateGraphics=function(n){for(var i,r,u=n._webGL.lastIndex;u<n.graphicsData.length;u++)i=n.graphicsData[u],i.type===t.Graphics.POLY?(i.fill&&i.points.length>3&&t.WebGLGraphics.buildPoly(i,n._webGL),i.lineWidth>0&&t.WebGLGraphics.buildLine(i,n._webGL)):i.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(i,n._webGL):(i.type===t.Graphics.CIRC||i.type===t.Graphics.ELIP)&&t.WebGLGraphics.buildCircle(i,n._webGL);n._webGL.lastIndex=n.graphicsData.length;r=t.gl;n._webGL.glPoints=new Float32Array(n._webGL.points);r.bindBuffer(r.ARRAY_BUFFER,n._webGL.buffer);r.bufferData(r.ARRAY_BUFFER,n._webGL.glPoints,r.STATIC_DRAW);n._webGL.glIndicies=new Uint16Array(n._webGL.indices);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n._webGL.indexBuffer);r.bufferData(r.ELEMENT_ARRAY_BUFFER,n._webGL.glIndicies,r.STATIC_DRAW)},t.WebGLGraphics.buildRectangle=function(n,i){var s=n.points,r=s[0],u=s[1],h=s[2],c=s[3];if(n.fill){var y=t.hex2rgb(n.fillColor),e=n.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,p=i.indices,o=f.length/6;f.push(r,u);f.push(l,a,v,e);f.push(r+h,u);f.push(l,a,v,e);f.push(r,u+c);f.push(l,a,v,e);f.push(r+h,u+c);f.push(l,a,v,e);p.push(o,o,o+1,o+2,o+3,o+3)}n.lineWidth&&(n.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],t.WebGLGraphics.buildLine(n,i))},t.WebGLGraphics.buildCircle=function(n,i){var f=n.points,s=f[0],h=f[1],y=f[2],p=f[3],c=40,e=Math.PI*2/c,r=0;if(n.fill){var l=t.hex2rgb(n.fillColor),u=n.fillAlpha,w=l[0]*u,b=l[1]*u,k=l[2]*u,a=i.points,v=i.indices,o=a.length/6;for(v.push(o),r=0;r<c+1;r++)a.push(s,h,w,b,k,u),a.push(s+Math.sin(e*r)*y,h+Math.cos(e*r)*p,w,b,k,u),v.push(o++,o++);v.push(o-1)}if(n.lineWidth){for(n.points=[],r=0;r<c+1;r++)n.points.push(s+Math.sin(e*r)*y,h+Math.cos(e*r)*p);t.WebGLGraphics.buildLine(n,i)}},t.WebGLGraphics.buildLine=function(n,i){var h=0,r=n.points,it,g,ht,ct;if(r.length!==0){if(n.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new t.Point(r[0],r[1]);g=new t.Point(r[r.length-2],r[r.length-1]);it.x===g.x&&it.y===g.y&&(r.pop(),r.pop(),g=new t.Point(r[r.length-2],r[r.length-1]),ht=g.x+(it.x-g.x)*.5,ct=g.y+(it.y-g.y)*.5,r.unshift(ht,ct),r.push(ht,ct));var s=i.points,lt=i.indices,rt=r.length/2,gt=r.length,at=s.length/6,p=n.lineWidth/2,vt=t.hex2rgb(n.lineColor),l=n.lineAlpha,a=vt[0]*l,v=vt[1]*l,y=vt[2]*l,ut,ft,w,b,e,o,ot,st,u,f,k,d,nt,tt,yt,pt,wt,bt,kt,dt,et,ni,c;for(w=r[0],b=r[1],e=r[2],o=r[3],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(w-u,b-f,a,v,y,l),s.push(w+u,b+f,a,v,y,l),h=1;h<rt-1;h++){if(w=r[(h-1)*2],b=r[(h-1)*2+1],e=r[h*2],o=r[h*2+1],ot=r[(h+1)*2],st=r[(h+1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,k=-(o-st),d=e-ot,c=Math.sqrt(k*k+d*d),k/=c,d/=c,k*=p,d*=p,yt=-f+b-(-f+o),pt=-u+e-(-u+w),wt=(-u+w)*(-f+o)-(-u+e)*(-f+b),bt=-d+st-(-d+o),kt=-k+e-(-k+ot),dt=(-k+ot)*(-d+o)-(-k+e)*(-d+st),et=yt*kt-bt*pt,Math.abs(et)<.1){et+=10.1;s.push(e-u,o-f,a,v,y,l);s.push(e+u,o+f,a,v,y,l);continue}ut=(pt*dt-kt*wt)/et;ft=(bt*wt-yt*dt)/et;ni=(ut-e)*(ut-e)+(ft-o)+(ft-o);ni>19600?(nt=u-k,tt=f-d,c=Math.sqrt(nt*nt+tt*tt),nt/=c,tt/=c,nt*=p,tt*=p,s.push(e-nt,o-tt),s.push(a,v,y,l),s.push(e+nt,o+tt),s.push(a,v,y,l),s.push(e-nt,o-tt),s.push(a,v,y,l),gt++):(s.push(ut,ft),s.push(a,v,y,l),s.push(e-(ut-e),o-(ft-o)),s.push(a,v,y,l))}for(w=r[(rt-2)*2],b=r[(rt-2)*2+1],e=r[(rt-1)*2],o=r[(rt-1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(e-u,o-f),s.push(a,v,y,l),s.push(e+u,o+f),s.push(a,v,y,l),lt.push(at),h=0;h<gt;h++)lt.push(at++);lt.push(at-1)}},t.WebGLGraphics.buildPoly=function(n,i){var f=n.points;if(!(f.length<6)){for(var c=i.points,e=i.indices,l=f.length/2,h=t.hex2rgb(n.fillColor),s=n.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=t.PolyK.Triangulate(f),o=c.length/6,r=0,r=0;r<u.length;r+=3)e.push(u[r]+o),e.push(u[r]+o),e.push(u[r+1]+o),e.push(u[r+2]+o),e.push(u[r+2]+o);for(r=0;r<l;r++)c.push(f[r*2],f[r*2+1],a,v,y,s)}},t._defaultFrame=new t.Rectangle(0,0,1,1),t.gl=null,t.WebGLRenderer=function(n,i,r,u,f){var o,s,e;this.transparent=!!u;this.width=n||800;this.height=i||600;this.view=r||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;o=this;this.view.addEventListener("webglcontextlost",function(n){o.handleContextLost(n)},!1);this.view.addEventListener("webglcontextrestored",function(n){o.handleContextRestored(n)},!1);this.batchs=[];s={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!1,stencil:!0};try{t.gl=this.gl=this.view.getContext("experimental-webgl",s)}catch(h){try{t.gl=this.gl=this.view.getContext("webgl",s)}catch(c){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this);}}t.initDefaultShaders();e=this.gl;e.useProgram(t.defaultShader.program);t.WebGLRenderer.gl=e;this.batch=new t.WebGLBatch(e);e.disable(e.DEPTH_TEST);e.disable(e.CULL_FACE);e.enable(e.BLEND);e.colorMask(!0,!0,!0,this.transparent);t.projection=new t.Point(400,300);t.offset=new t.Point(0,0);this.resize(this.width,this.height);this.contextLost=!1;this.stageRenderGroup=new t.WebGLRenderGroup(this.gl,this.transparent)},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.getBatch=function(){return t._batchs.length===0?new t.WebGLBatch(t.WebGLRenderer.gl):t._batchs.pop()},t.WebGLRenderer.returnBatch=function(n){n.clean();t._batchs.push(n)},t.WebGLRenderer.prototype.render=function(n){var i,r;if(!this.contextLost&&(this.__stage!==n&&(this.__stage=n,this.stageRenderGroup.setRenderable(n)),t.WebGLRenderer.updateTextures(),t.visibleCount++,n.updateTransform(),i=this.gl,i.colorMask(!0,!0,!0,this.transparent),i.viewport(0,0,this.width,this.height),i.bindFramebuffer(i.FRAMEBUFFER,null),i.clearColor(n.backgroundColorSplit[0],n.backgroundColorSplit[1],n.backgroundColorSplit[2],!this.transparent),i.clear(i.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=n.backgroundColorSplit,t.projection.x=this.width/2,t.projection.y=-this.height/2,this.stageRenderGroup.render(t.projection),n.interactive&&(n._interactiveEventsAdded||(n._interactiveEventsAdded=!0,n.interactionManager.setTarget(this))),t.Texture.frameUpdates.length>0)){for(r=0;r<t.Texture.frameUpdates.length;r++)t.Texture.frameUpdates[r].updateFrame=!1;t.Texture.frameUpdates=[]}},t.WebGLRenderer.updateTextures=function(){for(var n=0,n=0;n<t.texturesToUpdate.length;n++)t.WebGLRenderer.updateTexture(t.texturesToUpdate[n]);for(n=0;n<t.texturesToDestroy.length;n++)t.WebGLRenderer.destroyTexture(t.texturesToDestroy[n]);t.texturesToUpdate=[];t.texturesToDestroy=[]},t.WebGLRenderer.updateTexture=function(n){var i=t.gl;n._glTexture||(n._glTexture=i.createTexture());n.hasLoaded&&(i.bindTexture(i.TEXTURE_2D,n._glTexture),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n.scaleMode===t.BaseTexture.SCALE_MODE.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n.scaleMode===t.BaseTexture.SCALE_MODE.LINEAR?i.LINEAR:i.NEAREST),n._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),i.bindTexture(i.TEXTURE_2D,null))},t.WebGLRenderer.destroyTexture=function(n){var i=t.gl;n._glTexture&&(n._glTexture=i.createTexture(),i.deleteTexture(i.TEXTURE_2D,n._glTexture))},t.WebGLRenderer.prototype.resize=function(n,i){this.width=n;this.height=i;this.view.width=n;this.view.height=i;this.gl.viewport(0,0,this.width,this.height);t.projection.x=this.width/2;t.projection.y=-this.height/2},t.WebGLRenderer.prototype.handleContextLost=function(n){n.preventDefault();this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){var r,i,n;this.gl=this.view.getContext("experimental-webgl",{alpha:!0});this.initShaders();for(r in t.TextureCache)i=t.TextureCache[r].baseTexture,i._glTexture=null,t.WebGLRenderer.updateTexture(i);for(n=0;n<this.batchs.length;n++)this.batchs[n].restoreLostContext(this.gl),this.batchs[n].dirty=!0;t._restoreBatchs(this.gl);this.contextLost=!1},t.WebGLRenderGroup=function(n,i){this.gl=n;this.root;this.backgroundColor;this.transparent=i==undefined?!0:i;this.batchs=[];this.toRemove=[];this.filterManager=new t.WebGLFilterManager(this.transparent)},t.WebGLRenderGroup.prototype.constructor=t.WebGLRenderGroup,t.WebGLRenderGroup.prototype.setRenderable=function(n){this.root&&this.removeDisplayObjectAndChildren(this.root);n.worldVisible=n.visible;this.root=n;this.addDisplayObjectAndChildren(n)},t.WebGLRenderGroup.prototype.render=function(n,i){var r,f,u;for(t.WebGLRenderer.updateTextures(),r=this.gl,r.uniform2f(t.defaultShader.projectionVector,n.x,n.y),this.filterManager.begin(n,i),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),u=0;u<this.batchs.length;u++){if(f=this.batchs[u],f instanceof t.WebGLBatch){this.batchs[u].render();continue}this.renderSpecial(f,n)}},t.WebGLRenderGroup.prototype.renderSpecific=function(n,i,r){var l,s,a,h,v,u,f,y,o,e,c;for(t.WebGLRenderer.updateTextures(),l=this.gl,l.uniform2f(t.defaultShader.projectionVector,i.x,i.y),this.filterManager.begin(i,r),u=n.first;u._iNext;){if(u.renderable&&u.__renderGroup)break;u=u._iNext}if(f=u.batch,u instanceof t.Sprite)if(f=u.batch,e=f.head,y=e,e==u)s=0;else for(s=1;e.__next!=u;)s++,e=e.__next;else f=u;for(o=n.last;o._iPrev;){if(o.renderable&&o.__renderGroup)break;o=o._iNext}if(o instanceof t.Sprite)if(endBatch=o.batch,e=endBatch.head,e==o)h=0;else for(h=1;e.__next!=o;)h++,e=e.__next;else endBatch=o;if(f==endBatch){f instanceof t.WebGLBatch?f.render(s,h+1):this.renderSpecial(f,i);return}for(a=this.batchs.indexOf(f),v=this.batchs.indexOf(endBatch),f instanceof t.WebGLBatch?f.render(s):this.renderSpecial(f,i),c=a+1;c<v;c++)renderable=this.batchs[c],renderable instanceof t.WebGLBatch?this.batchs[c].render():this.renderSpecial(renderable,i);endBatch instanceof t.WebGLBatch?endBatch.render(0,h+1):this.renderSpecial(endBatch,i)},t.WebGLRenderGroup.prototype.renderSpecial=function(n,i){var r=n.vcount===t.visibleCount;n instanceof t.TilingSprite?r&&this.renderTilingSprite(n,i):n instanceof t.Strip?r&&this.renderStrip(n,i):n instanceof t.CustomRenderable?r&&n.renderWebGL(this,i):n instanceof t.Graphics?r&&n.renderable&&t.WebGLGraphics.renderGraphics(n,i):n instanceof t.FilterBlock&&this.handleFilterBlock(n,i)},flip=!1,r=[],u=0,t.WebGLRenderGroup.prototype.handleFilterBlock=function(n,i){var f=t.gl,e;n.open?n.data instanceof Array?this.filterManager.pushFilter(n):(u++,r.push(n),f.enable(f.STENCIL_TEST),f.colorMask(!1,!1,!1,!1),f.stencilFunc(f.ALWAYS,1,1),f.stencilOp(f.KEEP,f.KEEP,f.INCR),t.WebGLGraphics.renderGraphics(n.data,i),f.colorMask(!0,!0,!0,!0),f.stencilFunc(f.NOTEQUAL,0,r.length),f.stencilOp(f.KEEP,f.KEEP,f.KEEP)):n.data instanceof Array?this.filterManager.popFilter():(e=r.pop(n),e&&(f.colorMask(!1,!1,!1,!1),f.stencilFunc(f.ALWAYS,1,1),f.stencilOp(f.KEEP,f.KEEP,f.DECR),t.WebGLGraphics.renderGraphics(e.data,i),f.colorMask(!0,!0,!0,!0),f.stencilFunc(f.NOTEQUAL,0,r.length),f.stencilOp(f.KEEP,f.KEEP,f.KEEP)),f.disable(f.STENCIL_TEST))},t.WebGLRenderGroup.prototype.updateTexture=function(n){var t,i;for(this.removeObject(n),t=n.first;t!=this.root;)if(t=t._iPrev,t.renderable&&t.__renderGroup)break;for(i=n.last;i._iNext;)if(i=i._iNext,i.renderable&&i.__renderGroup)break;this.insertObject(n,t,i)},t.WebGLRenderGroup.prototype.addFilterBlocks=function(n,t){var i,r;for(n.__renderGroup=this,t.__renderGroup=this,i=n;i!=this.root.first;)if(i=i._iPrev,i.renderable&&i.__renderGroup)break;for(this.insertAfter(n,i),r=t;r!=this.root.first;)if(r=r._iPrev,r.renderable&&r.__renderGroup)break;this.insertAfter(t,r)},t.WebGLRenderGroup.prototype.removeFilterBlocks=function(n,t){this.removeObject(n);this.removeObject(t)},t.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(n){var t,r,i,u;for(n.__renderGroup&&n.__renderGroup.removeDisplayObjectAndChildren(n),t=n.first;t!=this.root.first;)if(t=t._iPrev,t.renderable&&t.__renderGroup)break;for(r=n.last;r._iNext;)if(r=r._iNext,r.renderable&&r.__renderGroup)break;i=n.first;u=n.last._iNext;do i.__renderGroup=this,i.renderable&&(this.insertObject(i,t,r),t=i),i=i._iNext;while(i!=u)},t.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(n){if(n.__renderGroup==this){var t=n.last;do n.__renderGroup=null,n.renderable&&this.removeObject(n),n=n._iNext;while(n)}},t.WebGLRenderGroup.prototype.insertObject=function(n,i,r){var s=i,e=r,u,f,o,h;if(n instanceof t.Sprite){if(s instanceof t.Sprite){if(u=s.batch,u&&u.texture==n.texture.baseTexture&&u.blendMode==n.blendMode){u.insertAfter(n,s);return}}else u=s;if(e)if(e instanceof t.Sprite){if(f=e.batch,f){if(f.texture==n.texture.baseTexture&&f.blendMode==n.blendMode){f.insertBefore(n,e);return}if(f==u){var c=u.split(e),o=t.WebGLRenderer.getBatch(),h=this.batchs.indexOf(u);o.init(n);this.batchs.splice(h+1,0,o,c);return}}}else f=e;o=t.WebGLRenderer.getBatch();o.init(n);u?(h=this.batchs.indexOf(u),this.batchs.splice(h+1,0,o)):this.batchs.push(o);return}n instanceof t.TilingSprite?this.initTilingSprite(n):n instanceof t.Strip?this.initStrip(n):n;this.insertAfter(n,s)},t.WebGLRenderGroup.prototype.insertAfter=function(n,i){var r,f,u;i instanceof t.Sprite?(r=i.batch,r?r.tail==i?(u=this.batchs.indexOf(r),this.batchs.splice(u+1,0,n)):(f=r.split(i.__next),u=this.batchs.indexOf(r),this.batchs.splice(u+1,0,n,f)):this.batchs.push(n)):(u=this.batchs.indexOf(i),this.batchs.splice(u+1,0,n))},t.WebGLRenderGroup.prototype.removeObject=function(n){var r,u,i;if(n instanceof t.Sprite){if(u=n.batch,!u)return;u.remove(n);u.size==0&&(r=u)}else r=n;if(r){if(i=this.batchs.indexOf(r),i==-1)return;if(i==0||i==this.batchs.length-1){this.batchs.splice(i,1);r instanceof t.WebGLBatch&&t.WebGLRenderer.returnBatch(r);return}if(this.batchs[i-1]instanceof t.WebGLBatch&&this.batchs[i+1]instanceof t.WebGLBatch&&this.batchs[i-1].texture==this.batchs[i+1].texture&&this.batchs[i-1].blendMode==this.batchs[i+1].blendMode){this.batchs[i-1].merge(this.batchs[i+1]);r instanceof t.WebGLBatch&&t.WebGLRenderer.returnBatch(r);t.WebGLRenderer.returnBatch(this.batchs[i+1]);this.batchs.splice(i,2);return}this.batchs.splice(i,1);r instanceof t.WebGLBatch&&t.WebGLRenderer.returnBatch(r)}},t.WebGLRenderGroup.prototype.initTilingSprite=function(n){var t=this.gl;n.verticies=new Float32Array([0,0,n.width,0,n.width,n.height,0,n.height]);n.uvs=new Float32Array([0,0,1,0,1,1,0,1]);n.colors=new Float32Array([1,1,1,1]);n.indices=new Uint16Array([0,1,3,2]);n._vertexBuffer=t.createBuffer();n._indexBuffer=t.createBuffer();n._uvBuffer=t.createBuffer();n._colorBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n._vertexBuffer);t.bufferData(t.ARRAY_BUFFER,n.verticies,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,n._uvBuffer);t.bufferData(t.ARRAY_BUFFER,n.uvs,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,n._colorBuffer);t.bufferData(t.ARRAY_BUFFER,n.colors,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,n.indices,t.STATIC_DRAW);n.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,n.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),n.texture.baseTexture._powerOf2=!0):n.texture.baseTexture._powerOf2=!0},t.WebGLRenderGroup.prototype.renderStrip=function(n,i){var r=this.gl;t.activateStripShader();var u=t.stripShader,e=u.program,f=t.mat3.clone(n.worldTransform);t.mat3.transpose(f);r.uniformMatrix3fv(u.translationMatrix,!1,f);r.uniform2f(u.projectionVector,i.x,i.y);r.uniform2f(u.offsetVector,-t.offset.x,-t.offset.y);r.uniform1f(u.alpha,n.worldAlpha);n.dirty?(n.dirty=!1,r.bindBuffer(r.ARRAY_BUFFER,n._vertexBuffer),r.bufferData(r.ARRAY_BUFFER,n.verticies,r.STATIC_DRAW),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,n._uvBuffer),r.bufferData(r.ARRAY_BUFFER,n.uvs,r.STATIC_DRAW),r.vertexAttribPointer(u.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.texture.baseTexture._glTexture),r.bindBuffer(r.ARRAY_BUFFER,n._colorBuffer),r.bufferData(r.ARRAY_BUFFER,n.colors,r.STATIC_DRAW),r.vertexAttribPointer(u.colorAttribute,1,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n._indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n.indices,r.STATIC_DRAW)):(r.bindBuffer(r.ARRAY_BUFFER,n._vertexBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,n.verticies),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,n._uvBuffer),r.vertexAttribPointer(u.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.texture.baseTexture._glTexture),r.bindBuffer(r.ARRAY_BUFFER,n._colorBuffer),r.vertexAttribPointer(u.colorAttribute,1,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n._indexBuffer));r.drawElements(r.TRIANGLE_STRIP,n.indices.length,r.UNSIGNED_SHORT,0);t.deactivateStripShader()},t.WebGLRenderGroup.prototype.renderTilingSprite=function(n,i){var r=this.gl,c=t.shaderProgram,e=n.tilePosition,o=n.tileScale,u=e.x/n.texture.baseTexture.width,f=e.y/n.texture.baseTexture.height,s=n.width/n.texture.baseTexture.width/o.x,h=n.height/n.texture.baseTexture.height/o.y;n.uvs[0]=0-u;n.uvs[1]=0-f;n.uvs[2]=1*s-u;n.uvs[3]=0-f;n.uvs[4]=1*s-u;n.uvs[5]=1*h-f;n.uvs[6]=0-u;n.uvs[7]=1*h-f;r.bindBuffer(r.ARRAY_BUFFER,n._uvBuffer);r.bufferSubData(r.ARRAY_BUFFER,0,n.uvs);this.renderStrip(n,i)},t.WebGLRenderGroup.prototype.initStrip=function(n){var t=this.gl,i=this.shaderProgram;n._vertexBuffer=t.createBuffer();n._indexBuffer=t.createBuffer();n._uvBuffer=t.createBuffer();n._colorBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n._vertexBuffer);t.bufferData(t.ARRAY_BUFFER,n.verticies,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,n._uvBuffer);t.bufferData(t.ARRAY_BUFFER,n.uvs,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,n._colorBuffer);t.bufferData(t.ARRAY_BUFFER,n.colors,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,n.indices,t.STATIC_DRAW)},t.initDefaultShaders=function(){t.primitiveShader=new t.PrimitiveShader;t.primitiveShader.init();t.stripShader=new t.StripShader;t.stripShader.init();t.defaultShader=new t.PixiShader;t.defaultShader.init();var n=t.gl,i=t.defaultShader.program;n.useProgram(i);n.enableVertexAttribArray(t.defaultShader.aVertexPosition);n.enableVertexAttribArray(t.defaultShader.colorAttribute);n.enableVertexAttribArray(t.defaultShader.aTextureCoord)},t.activatePrimitiveShader=function(){var n=t.gl;n.useProgram(t.primitiveShader.program);n.disableVertexAttribArray(t.defaultShader.aVertexPosition);n.disableVertexAttribArray(t.defaultShader.colorAttribute);n.disableVertexAttribArray(t.defaultShader.aTextureCoord);n.enableVertexAttribArray(t.primitiveShader.aVertexPosition);n.enableVertexAttribArray(t.primitiveShader.colorAttribute)},t.deactivatePrimitiveShader=function(){var n=t.gl;n.useProgram(t.defaultShader.program);n.disableVertexAttribArray(t.primitiveShader.aVertexPosition);n.disableVertexAttribArray(t.primitiveShader.colorAttribute);n.enableVertexAttribArray(t.defaultShader.aVertexPosition);n.enableVertexAttribArray(t.defaultShader.colorAttribute);n.enableVertexAttribArray(t.defaultShader.aTextureCoord)},t.activateStripShader=function(){var n=t.gl;n.useProgram(t.stripShader.program)},t.deactivateStripShader=function(){var n=t.gl;n.useProgram(t.defaultShader.program)},t.CompileVertexShader=function(n,i){return t._CompileShader(n,i,n.VERTEX_SHADER)},t.CompileFragmentShader=function(n,i){return t._CompileShader(n,i,n.FRAGMENT_SHADER)},t._CompileShader=function(n,t,i){var u=t.join("\n"),r=n.createShader(i);return(n.shaderSource(r,u),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))?(window.console.log(n.getShaderInfoLog(r)),null):r},t.compileProgram=function(n,i){var r=t.gl,f=t.CompileFragmentShader(r,i),e=t.CompileVertexShader(r,n),u=r.createProgram();return r.attachShader(u,e),r.attachShader(u,f),r.linkProgram(u),r.getProgramParameter(u,r.LINK_STATUS)||window.console.log("Could not initialise shaders"),u},t.BitmapText=function(n,i){t.DisplayObjectContainer.call(this);this.setText(n);this.setStyle(i);this.updateText();this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(n){this.text=n||" ";this.dirty=!0},t.BitmapText.prototype.setStyle=function(n){n=n||{};n.align=n.align||"left";this.style=n;var i=n.font.split(" ");this.fontName=i[i.length-1];this.fontSize=i.length>=2?parseInt(i[i.length-2],10):t.BitmapText.fonts[this.fontName].size;this.dirty=!0},t.BitmapText.prototype.updateText=function(){for(var l,r,y,a,e,h=t.BitmapText.fonts[this.fontName],i=new t.Point,o=null,f=[],u=0,c=[],v=0,s=this.fontSize/h.size,n=0;n<this.text.length;n++){if(l=this.text.charCodeAt(n),/(?:\r\n|\r|\n)/.test(this.text.charAt(n))){c.push(i.x);u=Math.max(u,i.x);v++;i.x=0;i.y+=h.lineHeight;o=null;continue}(r=h.chars[l],r)&&(o&&r[o]&&(i.x+=r.kerning[o]),f.push({texture:r.texture,line:v,charCode:l,position:new t.Point(i.x+r.xOffset,i.y+r.yOffset)}),i.x+=r.xAdvance,o=l)}for(c.push(i.x),u=Math.max(u,i.x),y=[],n=0;n<=v;n++)a=0,this.style.align==="right"?a=u-c[n]:this.style.align==="center"&&(a=(u-c[n])/2),y.push(a);for(n=0;n<f.length;n++)e=new t.Sprite(f[n].texture),e.position.x=(f[n].position.x+y[f[n].line])*s,e.position.y=f[n].position.y*s,e.scale.x=e.scale.y=s,this.addChild(e);this.width=u*s;this.height=(i.y+h.lineHeight)*s},t.BitmapText.prototype.updateTransform=function(){if(this.dirty){while(this.children.length>0)this.removeChild(this.getChildAt(0));this.updateText();this.dirty=!1}t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.Text=function(n,i){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");t.Sprite.call(this,t.Texture.fromCanvas(this.canvas));this.setText(n);this.setStyle(i);this.updateText();this.dirty=!1},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,t.Text.prototype.setStyle=function(n){n=n||{};n.font=n.font||"bold 20pt Arial";n.fill=n.fill||"black";n.align=n.align||"left";n.stroke=n.stroke||"black";n.strokeThickness=n.strokeThickness||0;n.wordWrap=n.wordWrap||!1;n.wordWrapWidth=n.wordWrapWidth||100;this.style=n;this.dirty=!0},t.Text.prototype.setText=function(n){this.text=n.toString()||" ";this.dirty=!0},t.Text.prototype.updateText=function(){var f,n,o,s,i;this.context.font=this.style.font;f=this.text;this.style.wordWrap&&(f=this.wordWrap(this.text));var r=f.split(/(?:\r\n|\r|\n)/),e=[],u=0;for(n=0;n<r.length;n++)o=this.context.measureText(r[n]).width,e[n]=o,u=Math.max(u,o);for(this.canvas.width=u+this.style.strokeThickness,s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,this.canvas.height=s*r.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",n=0;n<r.length;n++)i=new t.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+n*s),this.style.align==="right"?i.x+=u-e[n]:this.style.align==="center"&&(i.x+=(u-e[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(r[n],i.x,i.y),this.style.fill&&this.context.fillText(r[n],i.x,i.y);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.frame.width=this.canvas.width;this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;t.texturesToUpdate.push(this.texture.baseTexture)},t.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);t.Sprite.prototype.updateTransform.call(this)},t.Text.prototype.determineFontHeight=function(n){var r=t.Text.heightCache[n];if(!r){var u=document.getElementsByTagName("body")[0],i=document.createElement("div"),f=document.createTextNode("M");i.appendChild(f);i.setAttribute("style",n+";position:absolute;top:0;left:0");u.appendChild(i);r=i.offsetHeight;t.Text.heightCache[n]=r;u.removeChild(i)}return r},t.Text.prototype.wordWrap=function(n){for(var u,r,t,e,o,i="",s=n.split("\n"),f=0;f<s.length;f++){for(u=this.style.wordWrapWidth,r=s[f].split(" "),t=0;t<r.length;t++)e=this.context.measureText(r[t]).width,o=e+this.context.measureText(" ").width,o>u?(t>0&&(i+="\n"),i+=r[t]+" ",u=this.style.wordWrapWidth-e):(u-=o,i+=r[t]+" ");i+="\n"}return i},t.Text.prototype.destroy=function(n){n&&this.texture.destroy()},t.Text.heightCache={},t.BaseTextureCache={},t.texturesToUpdate=[],t.texturesToDestroy=[],t.BaseTexture=function(n,i){if(t.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=i||t.BaseTexture.SCALE_MODE.DEFAULT,this.hasLoaded=!1,this.source=n,n){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,t.texturesToUpdate.push(this);else{var r=this;this.source.onload=function(){r.hasLoaded=!0;r.width=r.source.width;r.height=r.source.height;t.texturesToUpdate.push(r);r.dispatchEvent({type:"loaded",content:r})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,t.texturesToUpdate.push(this);this.imageUrl=null;this._powerOf2=!1}},t.BaseTexture.prototype.constructor=t.BaseTexture,t.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.imageUrl in t.BaseTextureCache&&delete t.BaseTextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null);this.source=null;t.texturesToDestroy.push(this)},t.BaseTexture.prototype.updateSourceImage=function(n){this.hasLoaded=!1;this.source.src=null;this.source.src=n},t.BaseTexture.fromImage=function(n,i,r){var u=t.BaseTextureCache[n],f;return u||(f=new Image,i&&(f.crossOrigin=""),f.src=n,u=new t.BaseTexture(f,r),u.imageUrl=n,t.BaseTextureCache[n]=u),u},t.BaseTexture.SCALE_MODE={DEFAULT:0,LINEAR:0,NEAREST:1},t.TextureCache={},t.FrameCache={},t.Texture=function(n,i){if(t.EventTarget.call(this),i||(this.noFrame=!0,i=new t.Rectangle(0,0,1,1)),n instanceof t.Texture&&(n=n.baseTexture),this.baseTexture=n,this.frame=i,this.trim=new t.Point,this.scope=this,n.hasLoaded)this.noFrame&&(i=new t.Rectangle(0,0,n.width,n.height)),this.setFrame(i);else{var r=this;n.addEventListener("loaded",function(){r.onBaseTextureLoaded()})}},t.Texture.prototype.constructor=t.Texture,t.Texture.prototype.onBaseTextureLoaded=function(){var n=this.baseTexture;n.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=new t.Rectangle(0,0,n.width,n.height));this.noFrame=!1;this.width=this.frame.width;this.height=this.frame.height;this.scope.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy()},t.Texture.prototype.setFrame=function(n){if(this.frame=n,this.width=n.width,this.height=n.height,n.x+n.width>this.baseTexture.width||n.y+n.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0;t.Texture.frameUpdates.push(this)},t.Texture.fromImage=function(n,i,r){var u=t.TextureCache[n];return u||(u=new t.Texture(t.BaseTexture.fromImage(n,i,r)),t.TextureCache[n]=u),u},t.Texture.fromFrame=function(n){var i=t.TextureCache[n];if(!i)throw new Error('The frameId "'+n+'" does not exist in the texture cache '+this);return i},t.Texture.fromCanvas=function(n,i){var r=new t.BaseTexture(n,i);return new t.Texture(r)},t.Texture.addTextureToCache=function(n,i){t.TextureCache[i]=n},t.Texture.removeTextureFromCache=function(n){var i=t.TextureCache[n];return t.TextureCache[n]=null,i},t.Texture.frameUpdates=[],t.Texture.SCALE_MODE=t.BaseTexture.SCALE_MODE,t.RenderTexture=function(n,i){t.EventTarget.call(this);this.width=n||100;this.height=i||100;this.indetityMatrix=t.mat3.create();this.frame=new t.Rectangle(0,0,this.width,this.height);t.gl?this.initWebGL():this.initCanvas()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.initWebGL=function(){var n=t.gl;this.glFramebuffer=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,this.glFramebuffer);this.glFramebuffer.width=this.width;this.glFramebuffer.height=this.height;this.baseTexture=new t.BaseTexture;this.baseTexture.width=this.width;this.baseTexture.height=this.height;this.baseTexture._glTexture=n.createTexture();n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);this.baseTexture.isRender=!0;n.bindFramebuffer(n.FRAMEBUFFER,this.glFramebuffer);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.baseTexture._glTexture,0);this.projection=new t.Point(this.width/2,-this.height/2);this.render=this.renderWebGL},t.RenderTexture.prototype.resize=function(n,i){if(this.width=n,this.height=i,t.gl){this.projection.x=this.width/2;this.projection.y=-this.height/2;var r=t.gl;r.bindTexture(r.TEXTURE_2D,this.baseTexture._glTexture);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},t.RenderTexture.prototype.initCanvas=function(){this.renderer=new t.CanvasRenderer(this.width,this.height,null,0);this.baseTexture=new t.BaseTexture(this.renderer.view);this.frame=new t.Rectangle(0,0,this.width,this.height);this.render=this.renderCanvas},t.RenderTexture.prototype.renderWebGL=function(n,i,r){var u=t.gl,o,s,e,h,f;for(u.colorMask(!0,!0,!0,!0),u.viewport(0,0,this.width,this.height),u.bindFramebuffer(u.FRAMEBUFFER,this.glFramebuffer),r&&(u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),o=n.children,s=n.worldTransform,n.worldTransform=t.mat3.create(),n.worldTransform[4]=-1,n.worldTransform[5]=this.projection.y*-2,i&&(n.worldTransform[2]=i.x,n.worldTransform[5]-=i.y),t.visibleCount++,n.vcount=t.visibleCount,e=0,h=o.length;e<h;e++)o[e].updateTransform();f=n.__renderGroup;f?n===f.root?f.render(this.projection,this.glFramebuffer):f.renderSpecific(n,this.projection,this.glFramebuffer):(this.renderGroup||(this.renderGroup=new t.WebGLRenderGroup(u)),this.renderGroup.setRenderable(n),this.renderGroup.render(this.projection,this.glFramebuffer));n.worldTransform=s},t.RenderTexture.prototype.renderCanvas=function(n,i,r){var f=n.children,u,e;for(n.worldTransform=t.mat3.create(),i&&(n.worldTransform[2]=i.x,n.worldTransform[5]=i.y),u=0,e=f.length;u<e;u++)f[u].updateTransform();r&&this.renderer.context.clearRect(0,0,this.width,this.height);this.renderer.renderDisplayObject(n);this.renderer.context.setTransform(1,0,0,1,0,0)},t.EventTarget=function(){var n={};this.addEventListener=this.on=function(t,i){n[t]===undefined&&(n[t]=[]);n[t].indexOf(i)===-1&&n[t].push(i)};this.dispatchEvent=this.emit=function(t){if(n[t.type]&&n[t.type].length)for(var i=0,r=n[t.type].length;i<r;i++)n[t.type][i](t)};this.removeEventListener=this.off=function(t,i){var r=n[t].indexOf(i);r!==-1&&n[t].splice(r,1)};this.removeAllEventListeners=function(t){var i=n[t];i&&(i.length=0)}},t.PolyK={},t.PolyK.Triangulate=function(n){var a=!0,e=n.length>>1,o,r,i,u,l,f;if(e<3)return[];for(o=[],r=[],i=0;i<e;i++)r.push(i);for(i=0,u=e;u>3;){var s=r[(i+0)%u],h=r[(i+1)%u],c=r[(i+2)%u],y=n[2*s],p=n[2*s+1],w=n[2*h],b=n[2*h+1],k=n[2*c],d=n[2*c+1],v=!1;if(t.PolyK._convex(y,p,w,b,k,d,a))for(v=!0,l=0;l<u;l++)if((f=r[l],f!==s&&f!==h&&f!==c)&&t.PolyK._PointInTriangle(n[2*f],n[2*f+1],y,p,w,b,k,d)){v=!1;break}if(v)o.push(s,h,c),r.splice((i+1)%u,1),u--,i=0;else if(i++>3*u)if(a){for(o=[],r=[],i=0;i<e;i++)r.push(i);i=0;u=e;a=!1}else return window.console.log("PIXI Warning: shape too complex to fill"),[]}return o.push(r[0],r[1],r[2]),o},t.PolyK._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&g+nt<1},t.PolyK._convex=function(n,t,i,r,u,f,e){return(t-r)*(u-i)+(i-n)*(f-r)>=0===e},n.Camera=function(t,i,r,u,f,e){this.game=t;this.world=t.world;this.id=0;this.view=new n.Rectangle(r,u,f,e);this.screenView=new n.Rectangle(r,u,f,e);this.bounds=new n.Rectangle(r,u,f,e);this.deadzone=null;this.visible=!0;this.atLimit={x:!1,y:!1};this.target=null;this._edge=0;this.displayObject=null},n.Camera.FOLLOW_LOCKON=0,n.Camera.FOLLOW_PLATFORMER=1,n.Camera.FOLLOW_TOPDOWN=2,n.Camera.FOLLOW_TOPDOWN_TIGHT=3,n.Camera.prototype={follow:function(t,i){var r,f,u;typeof i=="undefined"&&(i=n.Camera.FOLLOW_LOCKON);this.target=t;switch(i){case n.Camera.FOLLOW_PLATFORMER:f=this.width/8;u=this.height/3;this.deadzone=new n.Rectangle((this.width-f)/2,(this.height-u)/2-u*.25,f,u);break;case n.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4;this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8;this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},focusOn:function(n){this.setPosition(Math.round(n.x-this.view.halfWidth),Math.round(n.y-this.view.halfHeight))},focusOnXY:function(n,t){this.setPosition(Math.round(n-this.view.halfWidth),Math.round(t-this.view.halfHeight))},update:function(){this.target&&this.updateTarget();this.bounds&&this.checkBounds();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this.deadzone?(this._edge=this.target.x-this.deadzone.x,this.view.x>this._edge&&(this.view.x=this._edge),this._edge=this.target.x+this.target.width-this.deadzone.x-this.deadzone.width,this.view.x<this._edge&&(this.view.x=this._edge),this._edge=this.target.y-this.deadzone.y,this.view.y>this._edge&&(this.view.y=this._edge),this._edge=this.target.y+this.target.height-this.deadzone.y-this.deadzone.height,this.view.y<this._edge&&(this.view.y=this._edge)):this.focusOnXY(this.target.x,this.target.y)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;this.view.x<this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x);this.view.right>this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width);this.view.y<this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top);this.view.bottom>this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height);this.view.floor()},setPosition:function(n,t){this.view.x=n;this.view.y=t;this.bounds&&this.checkBounds()},setSize:function(n,t){this.view.width=n;this.view.height=t}},n.Camera.prototype.constructor=n.Camera,Object.defineProperty(n.Camera.prototype,"x",{get:function(){return this.view.x},set:function(n){this.view.x=n;this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"y",{get:function(){return this.view.y},set:function(n){this.view.y=n;this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"width",{get:function(){return this.view.width},set:function(n){this.view.width=n}}),Object.defineProperty(n.Camera.prototype,"height",{get:function(){return this.view.height},set:function(n){this.view.height=n}}),n.State=function(){this.game=null;this.add=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null},n.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},destroy:function(){}},n.State.prototype.constructor=n.State,n.StateManager=function(n,t){this.game=n;this.states={};this._pendingState=null;typeof t!="undefined"&&t!==null&&(this._pendingState=t);this._created=!1;this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onShutDownCallback=null},n.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);this._pendingState!==null&&(typeof this._pendingState=="string"?this.start(this._pendingState,!1,!1):this.add("default",this._pendingState,!0))},add:function(t,i,r){typeof r=="undefined"&&(r=!1);var u;return i instanceof n.State?u=i:typeof i=="object"?(u=i,u.game=this.game):typeof i=="function"&&(u=new i(this.game)),this.states[t]=u,r&&(this.game.isBooted?this.start(t):this._pendingState=t),u},remove:function(n){this.current==n&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onDestroyCallback=null);delete this.states[n]},start:function(n,t,i){if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=!1),this.game.isBooted===!1){this._pendingState=n;return}this.checkState(n)!==!1&&(this.current&&this.onShutDownCallback.call(this.callbackContext,this.game),t&&(this.game.tweens.removeAll(),this.game.world.destroy(),i===!0&&this.game.cache.destroy()),this.setCurrentState(n),this.onPreloadCallback?(this.game.load.reset(),this.onPreloadCallback.call(this.callbackContext,this.game),this.game.load.totalQueuedFiles()===0?this.game.loadComplete():this.game.load.start()):this.game.loadComplete())},dummy:function(){},checkState:function(n){if(this.states[n]){var t=!1;return(this.states[n].preload&&(t=!0),t===!1&&this.states[n].loadRender&&(t=!0),t===!1&&this.states[n].loadUpdate&&(t=!0),t===!1&&this.states[n].create&&(t=!0),t===!1&&this.states[n].update&&(t=!0),t===!1&&this.states[n].preRender&&(t=!0),t===!1&&this.states[n].render&&(t=!0),t===!1&&this.states[n].paused&&(t=!0),t===!1)?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions."),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+n),!1},link:function(n){this.states[n].game=this.game;this.states[n].add=this.game.add;this.states[n].camera=this.game.camera;this.states[n].cache=this.game.cache;this.states[n].input=this.game.input;this.states[n].load=this.game.load;this.states[n].math=this.game.math;this.states[n].sound=this.game.sound;this.states[n].stage=this.game.stage;this.states[n].time=this.game.time;this.states[n].tweens=this.game.tweens;this.states[n].world=this.game.world;this.states[n].particles=this.game.particles;this.states[n].physics=this.game.physics;this.states[n].rnd=this.game.rnd},setCurrentState:function(n){this.callbackContext=this.states[n];this.link(n);this.onInitCallback=this.states[n].init||this.dummy;this.onPreloadCallback=this.states[n].preload||null;this.onLoadRenderCallback=this.states[n].loadRender||null;this.onLoadUpdateCallback=this.states[n].loadUpdate||null;this.onCreateCallback=this.states[n].create||null;this.onUpdateCallback=this.states[n].update||null;this.onPreRenderCallback=this.states[n].preRender||null;this.onRenderCallback=this.states[n].render||null;this.onPausedCallback=this.states[n].paused||null;this.onShutDownCallback=this.states[n].shutdown||this.dummy;this.current=n;this._created=!1;this.onInitCallback.call(this.callbackContext,this.game)},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game,!0)},resume:function(){this._created&&this.onre&&this.onPausedCallback.call(this.callbackContext,this.game,!1)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game)},render:function(){this._created&&this.onRenderCallback?(this.game.renderType===n.CANVAS&&(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0)),this.onRenderCallback.call(this.callbackContext,this.game),this.game.renderType===n.CANVAS&&this.game.context.restore()):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onDestroyCallback=null;this.game=null;this.states={};this._pendingState=null}},n.StateManager.prototype.constructor=n.StateManager,n.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0},n.LinkedList.prototype={add:function(n){return this.total===0&&this.first==null&&this.last==null?(this.first=n,this.last=n,this.next=n,n.prev=this,this.total++,n):(this.last.next=n,n.prev=this.last,this.last=n,this.total++,n)},remove:function(n){n==this.first?this.first=this.first.next:n==this.last&&(this.last=this.last.prev);n.prev&&(n.prev.next=n.next);n.next&&(n.next.prev=n.prev);n.next=n.prev=null;this.first==null&&(this.last=null);this.total--},callAll:function(n){if(this.first&&this.last){var t=this.first;do t&&t[n]&&t[n].call(t),t=t.next;while(t!=this.last.next)}}},n.LinkedList.prototype.constructor=n.LinkedList,n.Signal=function(){this._bindings=[];this._prevParams=null;var t=this;this.dispatch=function(){n.Signal.prototype.dispatch.apply(t,arguments)}},n.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(n,t){if(typeof n!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t));},_registerListener:function(t,i,r,u){var e=this._indexOfListener(t,r),f;if(e!==-1){if(f=this._bindings[e],f.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.");}else f=new n.SignalBinding(this,t,i,r,u),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(n){var t=this._bindings.length;do--t;while(this._bindings[t]&&n._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,n)},_indexOfListener:function(n,t){for(var i=this._bindings.length,r;i--;)if(r=this._bindings[i],r._listener===n&&r.context===t)return i;return-1},has:function(n,t){return this._indexOfListener(n,t)!==-1},add:function(n,t,i){return this.validateListener(n,"add"),this._registerListener(n,!1,t,i)},addOnce:function(n,t,i){return this.validateListener(n,"addOnce"),this._registerListener(n,!0,t,i)},remove:function(n,t){this.validateListener(n,"remove");var i=this._indexOfListener(n,t);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),n},removeAll:function(){for(var n=this._bindings.length;n--;)this._bindings[n]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var i=Array.prototype.slice.call(arguments),n=this._bindings.length,t;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice();this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(i)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},n.Signal.prototype.constructor=n.Signal,n.SignalBinding=function(n,t,i,r,u){this._listener=t;this._isOnce=i;this.context=r;this._signal=n;this._priority=u||0},n.SignalBinding.prototype={active:!0,params:null,execute:function(n){var t,i;return this.active&&!!this._listener&&(i=this.params?this.params.concat(n):n,t=this._listener.apply(this.context,i),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},n.SignalBinding.prototype.constructor=n.SignalBinding,n.Filter=function(t,i,r){this.game=t;this.type=n.WEBGL_FILTER;this.passes=[this];this.dirty=!0;this.padding=0;this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}};this.fragmentSrc=r||[]},n.Filter.prototype={init:function(){},setResolution:function(n,t){this.uniforms.resolution.value.x=n;this.uniforms.resolution.value.y=t},update:function(n){typeof n!="undefined"&&(n.x>0&&(this.uniforms.mouse.x=n.x.toFixed(2)),n.y>0&&(this.uniforms.mouse.y=n.y.toFixed(2)));this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}},n.Filter.prototype.constructor=n.Filter,Object.defineProperty(n.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(n){this.uniforms.resolution.value.x=n}}),Object.defineProperty(n.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(n){this.uniforms.resolution.value.y=n}}),n.Plugin=function(n,t){typeof t=="undefined"&&(t=null);this.game=n;this.parent=t;this.active=!1;this.visible=!1;this.hasPreUpdate=!1;this.hasUpdate=!1;this.hasPostUpdate=!1;this.hasRender=!1;this.hasPostRender=!1},n.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=!1;this.visible=!1}},n.Plugin.prototype.constructor=n.Plugin,n.PluginManager=function(n,t){this.game=n;this._parent=t;this.plugins=[];this._pluginsLength=0},n.PluginManager.prototype={add:function(n){var t=!1;return typeof n=="function"?n=new n(this.game,this._parent):(n.game=this.game,n.parent=this._parent),typeof n.preUpdate=="function"&&(n.hasPreUpdate=!0,t=!0),typeof n.update=="function"&&(n.hasUpdate=!0,t=!0),typeof n.postUpdate=="function"&&(n.hasPostUpdate=!0,t=!0),typeof n.render=="function"&&(n.hasRender=!0,t=!0),typeof n.postRender=="function"&&(n.hasPostRender=!0,t=!0),t?((n.hasPreUpdate||n.hasUpdate||n.hasPostUpdate)&&(n.active=!0),(n.hasRender||n.hasPostRender)&&(n.visible=!0),this._pluginsLength=this.plugins.push(n),typeof n.init=="function"&&n.init(),n):null},remove:function(n){if(this._pluginsLength!==0)for(this._p=0;this._p<this._pluginsLength;this._p++)if(this.plugins[this._p]===n){n.destroy();this.plugins.splice(this._p,1);this._pluginsLength--;return}},removeAll:function(){for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].destroy();this.plugins.length=0;this._pluginsLength=0},preUpdate:function(){if(this._pluginsLength!==0)for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].active&&this.plugins[this._p].hasPreUpdate&&this.plugins[this._p].preUpdate()},update:function(){if(this._pluginsLength!==0)for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].active&&this.plugins[this._p].hasUpdate&&this.plugins[this._p].update()},postUpdate:function(){if(this._pluginsLength!==0)for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].active&&this.plugins[this._p].hasPostUpdate&&this.plugins[this._p].postUpdate()},render:function(){if(this._pluginsLength!==0)for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].visible&&this.plugins[this._p].hasRender&&this.plugins[this._p].render()},postRender:function(){if(this._pluginsLength!==0)for(this._p=0;this._p<this._pluginsLength;this._p++)this.plugins[this._p].visible&&this.plugins[this._p].hasPostRender&&this.plugins[this._p].postRender()},destroy:function(){this.plugins.length=0;this._pluginsLength=0;this.game=null;this._parent=null}},n.PluginManager.prototype.constructor=n.PluginManager,n.Stage=function(i,r,u){this.game=i;this._backgroundColor="rgb(0,0,0)";this.offset=new n.Point;this.canvas=null;this._stage=new t.Stage(0,!1);this._stage.name="_stage_root";this._stage.interactive=!1;this.display=this._stage;this.scaleMode=n.StageScaleMode.NO_SCALE;this.fullScreenScaleMode=n.StageScaleMode.NO_SCALE;this.scale=new n.StageScaleMode(this.game,r,u);this.aspectRatio=r/u;this.disableVisibilityChange=!1;this._nextOffsetCheck=0;this.checkOffsetInterval=2500;i.config?this.parseConfig(i.config):(this.canvas=n.Canvas.create(r,u),this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%")},n.Stage.prototype={parseConfig:function(t){this.canvas=t.canvasID?n.Canvas.create(this.game.width,this.game.height,t.canvasID):n.Canvas.create(this.game.width,this.game.height);t.canvasStyle?this.canvas.stlye=t.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%";t.checkOffsetInterval&&(this.checkOffsetInterval=t.checkOffsetInterval);t.disableVisibilityChange&&(this.disableVisibilityChange=t.disableVisibilityChange);t.fullScreenScaleMode&&(this.fullScreenScaleMode=t.fullScreenScaleMode);t.scaleMode&&(this.scaleMode=t.scaleMode);t.backgroundColor&&(this.backgroundColor=t.backgroundColor)},boot:function(){n.Canvas.getOffset(this.canvas,this.offset);this.bounds=new n.Rectangle(this.offset.x,this.offset.y,this.game.width,this.game.height);var t=this;this._onChange=function(n){return t.visibilityChange(n)};n.Canvas.setUserSelect(this.canvas,"none");n.Canvas.setTouchAction(this.canvas,"none");this.backgroundColor="#000";document.addEventListener("visibilitychange",this._onChange,!1);document.addEventListener("webkitvisibilitychange",this._onChange,!1);document.addEventListener("pagehide",this._onChange,!1);document.addEventListener("pageshow",this._onChange,!1);window.onblur=this._onChange;window.onfocus=this._onChange},update:function(){this.checkOffsetInterval!==!1&&this.game.time.now>this._nextOffsetCheck&&(n.Canvas.getOffset(this.canvas,this.offset),this._nextOffsetCheck=this.game.time.now+this.checkOffsetInterval)},visibilityChange:function(n){this.disableVisibilityChange||(this.game.paused=this.game.paused===!1&&(n.type=="pagehide"||n.type=="blur"||document.hidden===!0||document.webkitHidden===!0)?!0:!1)}},n.Stage.prototype.constructor=n.Stage,Object.defineProperty(n.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t;this.game.transparent===!1&&(this.game.renderType==n.CANVAS?this.game.canvas.style.backgroundColor=t:(typeof t=="string"&&(t=n.Color.hexToRGB(t)),this._stage.setBackgroundColor(t)))}}),n.Group=function(i,r,u,f){this.game=i;typeof r=="undefined"&&(r=i.world);this.name=u||"group";typeof f=="undefined"&&(f=!1);f?this._container=this.game.stage._stage:(this._container=new t.DisplayObjectContainer,this._container.name=this.name,r?r instanceof n.Group?r._container.addChild(this._container):(r.addChild(this._container),r.updateTransform()):(this.game.stage._stage.addChild(this._container),this.game.stage._stage.updateTransform()));this.type=n.GROUP;this.alive=!0;this.exists=!0;this.group=null;this._container.scale=new n.Point(1,1);this.scale=this._container.scale;this.pivot=this._container.pivot;this.cursor=null},n.Group.RETURN_NONE=0,n.Group.RETURN_TOTAL=1,n.Group.RETURN_CHILD=2,n.Group.SORT_ASCENDING=-1,n.Group.SORT_DESCENDING=1,n.Group.prototype={add:function(t){return t.group!==this&&(t.type&&t.type===n.GROUP?(t.group=this,this._container.addChild(t._container),t._container.updateTransform()):(t.group=this,this._container.addChild(t),t.updateTransform(),t.events&&t.events.onAddedToGroup.dispatch(t,this)),this.cursor===null&&(this.cursor=t)),t},addAt:function(t,i){return t.group!==this&&(t.type&&t.type===n.GROUP?(t.group=this,this._container.addChildAt(t._container,i),t._container.updateTransform()):(t.group=this,this._container.addChildAt(t,i),t.updateTransform(),t.events&&t.events.onAddedToGroup.dispatch(t,this)),this.cursor===null&&(this.cursor=t)),t},getAt:function(n){return this._container.getChildAt(n)},create:function(t,i,r,u,f){typeof f=="undefined"&&(f=!0);var e=new n.Sprite(this.game,t,i,r,u);return e.group=this,e.exists=f,e.visible=f,e.alive=f,this._container.addChild(e),e.updateTransform(),e.events&&e.events.onAddedToGroup.dispatch(e,this),this.cursor===null&&(this.cursor=e),e},createMultiple:function(t,i,r,u){var e,f;for(typeof u=="undefined"&&(u=!1),e=0;e<t;e++)f=new n.Sprite(this.game,0,0,i,r),f.group=this,f.exists=u,f.visible=u,f.alive=u,this._container.addChild(f),f.updateTransform(),f.events&&f.events.onAddedToGroup.dispatch(f,this),this.cursor===null&&(this.cursor=f)},next:function(){this.cursor&&(this.cursor=this.cursor==this._container.last?this._container._iNext:this.cursor._iNext)},previous:function(){this.cursor&&(this.cursor=this.cursor==this._container._iNext?this._container.last:this.cursor._iPrev)},childTest:function(n,t){var i=n+" next: ";i=t._iNext?i+t._iNext.name:i+"-null-";i=i+" "+n+" prev: ";i=t._iPrev?i+t._iPrev.name:i+"-null-";console.log(i)},swapIndex:function(n,t){var i=this.getAt(n),r=this.getAt(t);this.swap(i,r)},swap:function(n,t){if(n===t||!n.parent||!t.parent||n.group!==this||t.group!==this)return!1;var r=n._iPrev,u=n._iNext,f=t._iPrev,e=t._iNext,o=this._container.last._iNext,i=this.game.stage._stage;do i!==n&&i!==t&&(i.first===n?i.first=t:i.first===t&&(i.first=n),i.last===n?i.last=t:i.last===t&&(i.last=n)),i=i._iNext;while(i!=o);return n._iNext==t?(n._iNext=e,n._iPrev=t,t._iNext=n,t._iPrev=r,r&&(r._iNext=t),e&&(e._iPrev=n),n.__renderGroup&&n.__renderGroup.updateTexture(n),t.__renderGroup&&t.__renderGroup.updateTexture(t),!0):t._iNext==n?(n._iNext=t,n._iPrev=f,t._iNext=u,t._iPrev=n,f&&(f._iNext=n),u&&(u._iPrev=t),n.__renderGroup&&n.__renderGroup.updateTexture(n),t.__renderGroup&&t.__renderGroup.updateTexture(t),!0):(n._iNext=e,n._iPrev=f,t._iNext=u,t._iPrev=r,r&&(r._iNext=t),u&&(u._iPrev=t),f&&(f._iNext=n),e&&(e._iPrev=n),n.__renderGroup&&n.__renderGroup.updateTexture(n),t.__renderGroup&&t.__renderGroup.updateTexture(t),!0)},bringToTop:function(n){return n.group===this&&(this.remove(n),this.add(n)),n},getIndex:function(n){return this._container.children.indexOf(n)},replace:function(n,t){if(this._container.first._iNext){var i=this.getIndex(n);i!=-1&&(t.parent!==undefined&&(t.events.onRemovedFromGroup.dispatch(t,this),t.parent.removeChild(t)),this._container.removeChild(n),this._container.addChildAt(t,i),t.events.onAddedToGroup.dispatch(t,this),t.updateTransform(),this.cursor==n&&(this.cursor=this._container._iNext))}},setProperty:function(n,t,i,r){r=r||0;var u=t.length;u==1?r===0?n[t[0]]=i:r==1?n[t[0]]+=i:r==2?n[t[0]]-=i:r==3?n[t[0]]*=i:r==4&&(n[t[0]]/=i):u==2?r===0?n[t[0]][t[1]]=i:r==1?n[t[0]][t[1]]+=i:r==2?n[t[0]][t[1]]-=i:r==3?n[t[0]][t[1]]*=i:r==4&&(n[t[0]][t[1]]/=i):u==3?r===0?n[t[0]][t[1]][t[2]]=i:r==1?n[t[0]][t[1]][t[2]]+=i:r==2?n[t[0]][t[1]][t[2]]-=i:r==3?n[t[0]][t[1]][t[2]]*=i:r==4&&(n[t[0]][t[1]][t[2]]/=i):u==4&&(r===0?n[t[0]][t[1]][t[2]][t[3]]=i:r==1?n[t[0]][t[1]][t[2]][t[3]]+=i:r==2?n[t[0]][t[1]][t[2]][t[3]]-=i:r==3?n[t[0]][t[1]][t[2]][t[3]]*=i:r==4&&(n[t[0]][t[1]][t[2]][t[3]]/=i))},set:function(n,t,i,r,u,f){t=t.split(".");typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);(r===!1||r&&n.alive)&&(u===!1||u&&n.visible)&&this.setProperty(n,t,i,f)},setAll:function(n,t,i,r,u){if(n=n.split("."),typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r=!1),u=u||0,this._container.children.length>0&&this._container.first._iNext){var f=this._container.first._iNext;do(i===!1||i&&f.alive)&&(r===!1||r&&f.visible)&&this.setProperty(f,n,t,u),f=f._iNext;while(f!=this._container.last._iNext)}},addAll:function(n,t,i,r){this.setAll(n,t,i,r,1)},subAll:function(n,t,i,r){this.setAll(n,t,i,r,2)},multiplyAll:function(n,t,i,r){this.setAll(n,t,i,r,3)},divideAll:function(n,t,i,r){this.setAll(n,t,i,r,4)},callAllExists:function(n,t){var r=Array.prototype.splice.call(arguments,2),i;if(this._container.children.length>0&&this._container.first._iNext){i=this._container.first._iNext;do i.exists==t&&i[n]&&i[n].apply(i,r),i=i._iNext;while(i!=this._container.last._iNext)}},callbackFromArray:function(n,t,i){if(i==1){if(n[t[0]])return n[t[0]]}else if(i==2){if(n[t[0]][t[1]])return n[t[0]][t[1]]}else if(i==3){if(n[t[0]][t[1]][t[2]])return n[t[0]][t[1]][t[2]]}else if(i==4){if(n[t[0]][t[1]][t[2]][t[3]])return n[t[0]][t[1]][t[2]][t[3]]}else if(n[t])return n[t];return!1},callAll:function(n,t){var u,f,i;if(typeof n!="undefined"){n=n.split(".");u=n.length;typeof t=="undefined"?t=null:typeof t=="string"&&(t=t.split("."),f=t.length);var e=Array.prototype.splice.call(arguments,2),r=null,o=null;if(this._container.children.length>0&&this._container.first._iNext){i=this._container.first._iNext;do r=this.callbackFromArray(i,n,u),t&&r?(o=this.callbackFromArray(i,t,f),r&&r.apply(o,e)):r&&r.apply(i,e),i=i._iNext;while(i!=this._container.last._iNext)}}},forEach:function(n,t,i){var u,r;if(typeof i=="undefined"&&(i=!1),u=Array.prototype.splice.call(arguments,3),u.unshift(null),this._container.children.length>0&&this._container.first._iNext){r=this._container.first._iNext;do(i===!1||i&&r.exists)&&(u[0]=r,n.apply(t,u)),r=r._iNext;while(r!=this._container.last._iNext)}},forEachExists:function(t,i){var r=Array.prototype.splice.call(arguments,2);r.unshift(null);this.iterate("exists",!0,n.Group.RETURN_TOTAL,t,i,r)},forEachAlive:function(t,i){var r=Array.prototype.splice.call(arguments,2);r.unshift(null);this.iterate("alive",!0,n.Group.RETURN_TOTAL,t,i,r)},forEachDead:function(t,i){var r=Array.prototype.splice.call(arguments,2);r.unshift(null);this.iterate("alive",!1,n.Group.RETURN_TOTAL,t,i,r)},sort:function(t,i){var u,f,r,e;typeof t=="undefined"&&(t="y");typeof i=="undefined"&&(i=n.Group.SORT_ASCENDING);do for(u=!1,r=0,e=this._container.children.length-1;r<e;r++)i==n.Group.SORT_ASCENDING?this._container.children[r][t]>this._container.children[r+1][t]&&(this.swap(this.getAt(r),this.getAt(r+1)),f=this._container.children[r],this._container.children[r]=this._container.children[r+1],this._container.children[r+1]=f,u=!0):this._container.children[r][t]<this._container.children[r+1][t]&&(this.swap(this.getAt(r),this.getAt(r+1)),f=this._container.children[r],this._container.children[r]=this._container.children[r+1],this._container.children[r+1]=f,u=!0);while(u)},iterate:function(t,i,r,u,f,e){var s,o;if(r===n.Group.RETURN_TOTAL&&this._container.children.length===0)return 0;if(typeof u=="undefined"&&(u=!1),s=0,this._container.children.length>0&&this._container.first._iNext){o=this._container.first._iNext;do{if(o[t]===i&&(s++,u&&(e[0]=o,u.apply(f,e)),r===n.Group.RETURN_CHILD))return o;o=o._iNext}while(o!=this._container.last._iNext)}return r===n.Group.RETURN_TOTAL?s:r===n.Group.RETURN_CHILD?null:void 0},getFirstExists:function(t){return typeof t!="boolean"&&(t=!0),this.iterate("exists",t,n.Group.RETURN_CHILD)},getFirstAlive:function(){return this.iterate("alive",!0,n.Group.RETURN_CHILD)},getFirstDead:function(){return this.iterate("alive",!1,n.Group.RETURN_CHILD)},countLiving:function(){return this.iterate("alive",!0,n.Group.RETURN_TOTAL)},countDead:function(){return this.iterate("alive",!1,n.Group.RETURN_TOTAL)},getRandom:function(n,t){return this._container.children.length===0?null:(n=n||0,t=t||this._container.children.length,this.game.math.getRandom(this._container.children,n,t))},remove:function(n){return n.group!==this?!1:(n.events&&n.events.onRemovedFromGroup.dispatch(n,this),n.parent===this._container&&this._container.removeChild(n),this.cursor==n&&(this.cursor=this._container._iNext?this._container._iNext:null),n.group=null,!0)},removeAll:function(){if(this._container.children.length!==0){do this._container.children[0].events&&this._container.children[0].events.onRemovedFromGroup.dispatch(this._container.children[0],this),this._container.removeChild(this._container.children[0]);while(this._container.children.length>0);this.cursor=null}},removeBetween:function(n,t){var r,i;if(this._container.children.length!==0){if(n>t||n<0||t>this._container.children.length)return!1;for(r=n;r<t;r++)i=this._container.children[r],i.events.onRemovedFromGroup.dispatch(i,this),this._container.removeChild(i),this.cursor==i&&(this.cursor=this._container._iNext?this._container._iNext:null)}},destroy:function(n){if(typeof n=="undefined"&&(n=!1),n){if(this._container.children.length>0)do this._container.children[0].group&&this._container.children[0].destroy();while(this._container.children.length>0)}else this.removeAll();this._container.parent.removeChild(this._container);this._container=null;this.game=null;this.exists=!1;this.cursor=null},validate:function(){var u=this.game.stage._stage.last._iNext,n=this.game.stage._stage,t=null,i=null,r=0;do{if(r>0){if(n!==t)return console.log("check next fail"),!1;if(n._iPrev!==i)return console.log("check previous fail"),!1}t=n._iNext;i=n;n=n._iNext;r++}while(n!=u);return!0}},n.Group.prototype.constructor=n.Group,Object.defineProperty(n.Group.prototype,"total",{get:function(){return this._container?this.iterate("exists",!0,n.Group.RETURN_TOTAL):0}}),Object.defineProperty(n.Group.prototype,"length",{get:function(){return this._container?this._container.children.length:0}}),Object.defineProperty(n.Group.prototype,"x",{get:function(){return this._container.position.x},set:function(n){this._container.position.x=n}}),Object.defineProperty(n.Group.prototype,"y",{get:function(){return this._container.position.y},set:function(n){this._container.position.y=n}}),Object.defineProperty(n.Group.prototype,"angle",{get:function(){return n.Math.radToDeg(this._container.rotation)},set:function(t){this._container.rotation=n.Math.degToRad(t)}}),Object.defineProperty(n.Group.prototype,"rotation",{get:function(){return this._container.rotation},set:function(n){this._container.rotation=n}}),Object.defineProperty(n.Group.prototype,"visible",{get:function(){return this._container.visible},set:function(n){this._container.visible=n}}),Object.defineProperty(n.Group.prototype,"alpha",{get:function(){return this._container.alpha},set:function(n){this._container.alpha=n}}),n.World=function(t){n.Group.call(this,t,null,"__world",!1);this.bounds=new n.Rectangle(0,0,t.width,t.height);this.camera=null;this.currentRenderOrderID=0},n.World.prototype=Object.create(n.Group.prototype),n.World.prototype.constructor=n.World,n.World.prototype.boot=function(){this.camera=new n.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this._container;this.game.camera=this.camera},n.World.prototype.preUpdate=function(){if(this.game.stage._stage.first._iNext){var n=this.game.stage._stage.first._iNext;do n=n.preUpdate&&!n.preUpdate()?n.last._iNext:n._iNext;while(n!=this.game.stage._stage.last._iNext)}},n.World.prototype.update=function(){if(this.currentRenderOrderID=0,this.game.stage._stage.first._iNext){var n=this.game.stage._stage.first._iNext;do n=n.update&&!n.update()?n.last._iNext:n._iNext;while(n!=this.game.stage._stage.last._iNext)}},n.World.prototype.postUpdate=function(){var n;if(this.camera.target&&this.camera.target.postUpdate){if(this.camera.target.postUpdate(),this.camera.update(),this.game.stage._stage.first._iNext){n=this.game.stage._stage.first._iNext;do n.postUpdate&&n!==this.camera.target&&n.postUpdate(),n=n._iNext;while(n!=this.game.stage._stage.last._iNext)}}else if(this.camera.update(),this.game.stage._stage.first._iNext){n=this.game.stage._stage.first._iNext;do n.postUpdate&&n.postUpdate(),n=n._iNext;while(n!=this.game.stage._stage.last._iNext)}},n.World.prototype.setBounds=function(n,t,i,r){i<this.game.width&&(i=this.game.width);r<this.game.height&&(r=this.game.height);this.bounds.setTo(n,t,i,r);this.camera.bounds&&this.camera.bounds.setTo(n,t,i,r);this.game.physics.setBoundsToWorld()},n.World.prototype.destroy=function(){this.camera.x=0;this.camera.y=0;this.game.input.reset(!0);this.removeAll()},Object.defineProperty(n.World.prototype,"width",{get:function(){return this.bounds.width},set:function(n){this.bounds.width=n}}),Object.defineProperty(n.World.prototype,"height",{get:function(){return this.bounds.height},set:function(n){this.bounds.height=n}}),Object.defineProperty(n.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(n.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(n.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}),Object.defineProperty(n.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}),Object.defineProperty(n.World.prototype,"visible",{get:function(){return this._container.visible},set:function(n){this._container.visible=n}}),n.Game=function(t,i,r,u,f,e,o){this.id=n.GAMES.push(this)-1;this.config=null;this.parent="";this.width=800;this.height=600;this.transparent=!1;this.antialias=!0;this.renderer=n.AUTO;this.renderType=n.AUTO;this.state=null;this._paused=!1;this._loadComplete=!1;this.isBooted=!1;this.isRunning=!1;this.raf=null;this.add=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.rnd=null;this.device=null;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.stepping=!1;this.pendingStep=!1;this.stepCount=0;arguments.length===1&&typeof arguments[0]=="object"?this.parseConfig(arguments[0]):(typeof t!="undefined"&&(this.width=t),typeof i!="undefined"&&(this.height=i),typeof r!="undefined"&&(this.renderer=r,this.renderType=r),typeof u!="undefined"&&(this.parent=u),typeof e!="undefined"&&(this.transparent=e),typeof o!="undefined"&&(this.antialias=o),this.state=new n.StateManager(this,f));var s=this;return this._onBoot=function(){return s.boot()},document.readyState==="complete"||document.readyState==="interactive"?window.setTimeout(this._onBoot,0):(document.addEventListener("DOMContentLoaded",this._onBoot,!1),window.addEventListener("load",this._onBoot,!1)),this},n.Game.prototype={parseConfig:function(t){this.config=t;t.width&&(this.width=this.parseDimension(t.width,0));t.height&&(this.height=this.parseDimension(t.height,1));t.renderer&&(this.renderer=t.renderer,this.renderType=t.renderer);t.parent&&(this.parent=t.parent);t.transparent&&(this.transparent=t.transparent);t.antialias&&(this.antialias=t.antialias);var i=null;t.state&&(i=t.state);this.state=new n.StateManager(this,i)},parseDimension:function(n,t){var r=0,i=0;return typeof n=="string"?n.substr(-1)==="%"?(r=parseInt(n,10)/100,i=t===0?window.innerWidth*r:window.innerHeight*r):i=parseInt(n,10):i=n,i},boot:function(){this.isBooted||(document.body?(document.removeEventListener("DOMContentLoaded",this._onBoot),window.removeEventListener("load",this._onBoot),this.onPause=new n.Signal,this.onResume=new n.Signal,this.isBooted=!0,this.device=new n.Device,this.math=n.Math,this.rnd=new n.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.stage=new n.Stage(this,this.width,this.height),this.setUpRenderer(),this.world=new n.World(this),this.add=new n.GameObjectFactory(this),this.cache=new n.Cache(this),this.load=new n.Loader(this),this.time=new n.Time(this),this.tweens=new n.TweenManager(this),this.input=new n.Input(this),this.sound=new n.SoundManager(this),this.physics=new n.Physics.Arcade(this),this.particles=new n.Particles(this),this.plugins=new n.PluginManager(this,this),this.net=new n.Net(this),this.debug=new n.Utils.Debug(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.load.onLoadComplete.add(this.loadComplete,this),this.showDebugHeader(),this.isRunning=!0,this._loadComplete=!1,this.raf=new n.RequestAnimationFrame(this),this.raf.start()):window.setTimeout(this._onBoot,20))},showDebugHeader:function(){var r=n.DEV_VERSION,t="Canvas",i="HTML Audio",u;this.renderType==n.WEBGL?t="WebGL":this.renderType==n.HEADLESS&&(t="Headless");this.device.webAudio&&(i="WebAudio");this.device.chrome?(u=["%c %c %c  Phaser v"+r+" - Renderer: "+t+" - Audio: "+i+"  %c %c ","background: #00bff3","background: #0072bc","color: #ffffff; background: #003471","background: #0072bc","background: #00bff3"],console.log.apply(console,u)):console.log("Phaser v"+r+" - Renderer: "+t+" - Audio: "+i)},setUpRenderer:function(){if(this.renderType===n.HEADLESS||this.renderType===n.CANVAS||this.renderType===n.AUTO&&this.device.webGL===!1)if(this.device.canvas)this.renderType===n.AUTO&&(this.renderType=n.CANVAS),this.renderer=new t.CanvasRenderer(this.width,this.height,this.stage.canvas,this.transparent),n.Canvas.setSmoothingEnabled(this.renderer.context,this.antialias),this.canvas=this.renderer.view,this.context=this.renderer.context;else throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");else this.renderType=n.WEBGL,this.renderer=new t.WebGLRenderer(this.width,this.height,this.stage.canvas,this.transparent,this.antialias),this.canvas=this.renderer.view,this.context=null;n.Canvas.addToDOM(this.renderer.view,this.parent,!0);n.Canvas.setTouchAction(this.renderer.view)},loadComplete:function(){this._loadComplete=!0;this.state.loadComplete()},update:function(t){this.time.update(t);this._paused?(this.renderer.render(this.stage._stage),this.plugins.render(),this.state.render()):(this.pendingStep||(this.stepping&&(this.pendingStep=!0),this.plugins.preUpdate(),this.world.preUpdate(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.state.update(),this.world.update(),this.particles.update(),this.plugins.update(),this.world.postUpdate(),this.plugins.postUpdate()),this.renderType!==n.HEADLESS&&(this.renderer.render(this.stage._stage),this.plugins.render(),this.state.render(),this.plugins.postRender()))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.stepping=!1;this.pendingStep=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.input.destroy();this.state.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=!1}},n.Game.prototype.constructor=n.Game,Object.defineProperty(n.Game.prototype,"paused",{get:function(){return this._paused},set:function(n){n===!0?this._paused===!1&&(this._paused=!0,this.onPause.dispatch(this)):this._paused&&(this._paused=!1,this.onResume.dispatch(this))}}),n.Input=function(n){this.game=n;this.hitCanvas=null;this.hitContext=null;this.moveCallback=null;this.moveCallbackContext=this},n.Input.MOUSE_OVERRIDES_TOUCH=0,n.Input.TOUCH_OVERRIDES_MOUSE=1,n.Input.MOUSE_TOUCH_COMBINE=2,n.Input.prototype={pollRate:0,_pollCounter:0,_oldPosition:null,_x:0,_y:0,disabled:!1,multiInputOverride:n.Input.MOUSE_TOUCH_COMBINE,position:null,speed:null,circle:null,scale:null,maxPointers:10,currentPointers:0,tapRate:200,doubleTapRate:300,holdRate:2e3,justPressedRate:200,justReleasedRate:200,recordPointerHistory:!1,recordRate:100,recordLimit:100,pointer1:null,pointer2:null,pointer3:null,pointer4:null,pointer5:null,pointer6:null,pointer7:null,pointer8:null,pointer9:null,pointer10:null,activePointer:null,mousePointer:null,mouse:null,keyboard:null,touch:null,mspointer:null,gamepad:null,onDown:null,onUp:null,onTap:null,onHold:null,interactiveItems:new n.LinkedList,boot:function(){this.mousePointer=new n.Pointer(this.game,0);this.pointer1=new n.Pointer(this.game,1);this.pointer2=new n.Pointer(this.game,2);this.mouse=new n.Mouse(this.game);this.keyboard=new n.Keyboard(this.game);this.touch=new n.Touch(this.game);this.mspointer=new n.MSPointer(this.game);this.gamepad=new n.Gamepad(this.game);this.onDown=new n.Signal;this.onUp=new n.Signal;this.onTap=new n.Signal;this.onHold=new n.Signal;this.scale=new n.Point(1,1);this.speed=new n.Point;this.position=new n.Point;this._oldPosition=new n.Point;this.circle=new n.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.keyboard.start();this.touch.start();this.mspointer.start();this.mousePointer.active=!0},destroy:function(){this.mouse.stop();this.keyboard.stop();this.touch.stop();this.mspointer.stop();this.gamepad.stop();this.moveCallback=null},setMoveCallback:function(n,t){this.moveCallback=n;this.moveCallbackContext=t},addPointer:function(){for(var t=0,i=10;i>0;i--)this["pointer"+i]===null&&(t=i);return t===0?(console.warn("You can only have 10 Pointer objects"),null):(this["pointer"+t]=new n.Pointer(this.game,t),this["pointer"+t])},update:function(){if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.gamepad.active&&this.gamepad.update();this.pointer1.update();this.pointer2.update();this.pointer3&&this.pointer3.update();this.pointer4&&this.pointer4.update();this.pointer5&&this.pointer5.update();this.pointer6&&this.pointer6.update();this.pointer7&&this.pointer7.update();this.pointer8&&this.pointer8.update();this.pointer9&&this.pointer9.update();this.pointer10&&this.pointer10.update();this._pollCounter=0},reset:function(t){if(this.game.isBooted!==!1){typeof t=="undefined"&&(t=!1);this.keyboard.reset();this.mousePointer.reset();this.gamepad.reset();for(var i=1;i<=10;i++)this["pointer"+i]&&this["pointer"+i].reset();this.currentPointers=0;this.game.canvas.style.cursor!=="none"&&(this.game.canvas.style.cursor="default");t===!0&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.interactiveItems.callAll("reset"));this._pollCounter=0}},resetSpeed:function(n,t){this._oldPosition.setTo(n,t);this.speed.setTo(0,0)},startPointer:function(n){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers)return null;if(this.pointer1.active===!1)return this.pointer1.start(n);if(this.pointer2.active===!1)return this.pointer2.start(n);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active===!1)return this["pointer"+t].start(n);return null},updatePointer:function(n){if(this.pointer1.active&&this.pointer1.identifier==n.identifier)return this.pointer1.move(n);if(this.pointer2.active&&this.pointer2.identifier==n.identifier)return this.pointer2.move(n);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==n.identifier)return this["pointer"+t].move(n);return null},stopPointer:function(n){if(this.pointer1.active&&this.pointer1.identifier==n.identifier)return this.pointer1.stop(n);if(this.pointer2.active&&this.pointer2.identifier==n.identifier)return this.pointer2.stop(n);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==n.identifier)return this["pointer"+t].stop(n);return null},getPointer:function(n){if(n=n||!1,this.pointer1.active==n)return this.pointer1;if(this.pointer2.active==n)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active==n)return this["pointer"+t];return null},getPointerFromIdentifier:function(n){if(this.pointer1.identifier==n)return this.pointer1;if(this.pointer2.identifier==n)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].identifier==n)return this["pointer"+t];return null}},n.Input.prototype.constructor=n.Input,Object.defineProperty(n.Input.prototype,"x",{get:function(){return this._x},set:function(n){this._x=Math.floor(n)}}),Object.defineProperty(n.Input.prototype,"y",{get:function(){return this._y},set:function(n){this._y=Math.floor(n)}}),Object.defineProperty(n.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(n.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}}),Object.defineProperty(n.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var n=1;n<=10;n++)this["pointer"+n]&&this["pointer"+n].active&&this.currentPointers++;return this.currentPointers}}),Object.defineProperty(n.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(n.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),n.Key=function(t,i){this.game=t;this.isDown=!1;this.isUp=!1;this.altKey=!1;this.ctrlKey=!1;this.shiftKey=!1;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.keyCode=i;this.onDown=new n.Signal;this.onUp=new n.Signal},n.Key.prototype={processKeyDown:function(n){this.altKey=n.altKey;this.ctrlKey=n.ctrlKey;this.shiftKey=n.shiftKey;this.isDown?(this.duration=n.timeStamp-this.timeDown,this.repeats++):(this.isDown=!0,this.isUp=!1,this.timeDown=n.timeStamp,this.duration=0,this.repeats=0,this.onDown.dispatch(this))},processKeyUp:function(n){this.isDown=!1;this.isUp=!0;this.timeUp=n.timeStamp;this.onUp.dispatch(this)},justPressed:function(n){return typeof n=="undefined"&&(n=250),this.isDown&&this.duration<n},justReleased:function(n){return typeof n=="undefined"&&(n=250),this.isDown===!1&&this.game.time.now-this.timeUp<n}},n.Key.prototype.constructor=n.Key,n.Keyboard=function(n){this.game=n;this._keys={};this._hotkeys={};this._capture={};this.disabled=!1;this._onKeyDown=null;this._onKeyUp=null;this.callbackContext=this;this.onDownCallback=null;this.onUpCallback=null},n.Keyboard.prototype={addCallbacks:function(n,t,i){this.callbackContext=n;this.onDownCallback=t;typeof i!="undefined"&&(this.onUpCallback=i)},addKey:function(t){return this._hotkeys[t]=new n.Key(this.game,t),this.addKeyCapture(t),this._hotkeys[t]},removeKey:function(n){delete this._hotkeys[n]},createCursorKeys:function(){return{up:this.addKey(n.Keyboard.UP),down:this.addKey(n.Keyboard.DOWN),left:this.addKey(n.Keyboard.LEFT),right:this.addKey(n.Keyboard.RIGHT)}},start:function(){var n=this;this._onKeyDown=function(t){return n.processKeyDown(t)};this._onKeyUp=function(t){return n.processKeyUp(t)};window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",this._onKeyUp,!1)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp)},addKeyCapture:function(n){if(typeof n=="object")for(var t in n)this._capture[n[t]]=!0;else this._capture[n]=!0},removeKeyCapture:function(n){delete this._capture[n]},clearCaptures:function(){this._capture={}},processKeyDown:function(n){this.game.input.disabled||this.disabled||(this._capture[n.keyCode]&&n.preventDefault(),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,n),this._keys[n.keyCode]&&this._keys[n.keyCode].isDown?this._keys[n.keyCode].duration=this.game.time.now-this._keys[n.keyCode].timeDown:this._keys[n.keyCode]?(this._keys[n.keyCode].isDown=!0,this._keys[n.keyCode].timeDown=this.game.time.now,this._keys[n.keyCode].duration=0):this._keys[n.keyCode]={isDown:!0,timeDown:this.game.time.now,timeUp:0,duration:0},this._hotkeys[n.keyCode]&&this._hotkeys[n.keyCode].processKeyDown(n))},processKeyUp:function(n){this.game.input.disabled||this.disabled||(this._capture[n.keyCode]&&n.preventDefault(),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,n),this._hotkeys[n.keyCode]&&this._hotkeys[n.keyCode].processKeyUp(n),this._keys[n.keyCode]?(this._keys[n.keyCode].isDown=!1,this._keys[n.keyCode].timeUp=this.game.time.now):this._keys[n.keyCode]={isDown:!1,timeDown:this.game.time.now,timeUp:this.game.time.now,duration:0})},reset:function(){for(var n in this._keys)this._keys[n].isDown=!1},justPressed:function(n,t){return(typeof t=="undefined"&&(t=250),this._keys[n]&&this._keys[n].isDown&&this._keys[n].duration<t)?!0:!1},justReleased:function(n,t){return(typeof t=="undefined"&&(t=250),this._keys[n]&&this._keys[n].isDown===!1&&this.game.time.now-this._keys[n].timeUp<t)?!0:!1},isDown:function(n){return this._keys[n]?this._keys[n].isDown:!1}},n.Keyboard.prototype.constructor=n.Keyboard,n.Keyboard.A="A".charCodeAt(0),n.Keyboard.B="B".charCodeAt(0),n.Keyboard.C="C".charCodeAt(0),n.Keyboard.D="D".charCodeAt(0),n.Keyboard.E="E".charCodeAt(0),n.Keyboard.F="F".charCodeAt(0),n.Keyboard.G="G".charCodeAt(0),n.Keyboard.H="H".charCodeAt(0),n.Keyboard.I="I".charCodeAt(0),n.Keyboard.J="J".charCodeAt(0),n.Keyboard.K="K".charCodeAt(0),n.Keyboard.L="L".charCodeAt(0),n.Keyboard.M="M".charCodeAt(0),n.Keyboard.N="N".charCodeAt(0),n.Keyboard.O="O".charCodeAt(0),n.Keyboard.P="P".charCodeAt(0),n.Keyboard.Q="Q".charCodeAt(0),n.Keyboard.R="R".charCodeAt(0),n.Keyboard.S="S".charCodeAt(0),n.Keyboard.T="T".charCodeAt(0),n.Keyboard.U="U".charCodeAt(0),n.Keyboard.V="V".charCodeAt(0),n.Keyboard.W="W".charCodeAt(0),n.Keyboard.X="X".charCodeAt(0),n.Keyboard.Y="Y".charCodeAt(0),n.Keyboard.Z="Z".charCodeAt(0),n.Keyboard.ZERO="0".charCodeAt(0),n.Keyboard.ONE="1".charCodeAt(0),n.Keyboard.TWO="2".charCodeAt(0),n.Keyboard.THREE="3".charCodeAt(0),n.Keyboard.FOUR="4".charCodeAt(0),n.Keyboard.FIVE="5".charCodeAt(0),n.Keyboard.SIX="6".charCodeAt(0),n.Keyboard.SEVEN="7".charCodeAt(0),n.Keyboard.EIGHT="8".charCodeAt(0),n.Keyboard.NINE="9".charCodeAt(0),n.Keyboard.NUMPAD_0=96,n.Keyboard.NUMPAD_1=97,n.Keyboard.NUMPAD_2=98,n.Keyboard.NUMPAD_3=99,n.Keyboard.NUMPAD_4=100,n.Keyboard.NUMPAD_5=101,n.Keyboard.NUMPAD_6=102,n.Keyboard.NUMPAD_7=103,n.Keyboard.NUMPAD_8=104,n.Keyboard.NUMPAD_9=105,n.Keyboard.NUMPAD_MULTIPLY=106,n.Keyboard.NUMPAD_ADD=107,n.Keyboard.NUMPAD_ENTER=108,n.Keyboard.NUMPAD_SUBTRACT=109,n.Keyboard.NUMPAD_DECIMAL=110,n.Keyboard.NUMPAD_DIVIDE=111,n.Keyboard.F1=112,n.Keyboard.F2=113,n.Keyboard.F3=114,n.Keyboard.F4=115,n.Keyboard.F5=116,n.Keyboard.F6=117,n.Keyboard.F7=118,n.Keyboard.F8=119,n.Keyboard.F9=120,n.Keyboard.F10=121,n.Keyboard.F11=122,n.Keyboard.F12=123,n.Keyboard.F13=124,n.Keyboard.F14=125,n.Keyboard.F15=126,n.Keyboard.COLON=186,n.Keyboard.EQUALS=187,n.Keyboard.UNDERSCORE=189,n.Keyboard.QUESTION_MARK=191,n.Keyboard.TILDE=192,n.Keyboard.OPEN_BRACKET=219,n.Keyboard.BACKWARD_SLASH=220,n.Keyboard.CLOSED_BRACKET=221,n.Keyboard.QUOTES=222,n.Keyboard.BACKSPACE=8,n.Keyboard.TAB=9,n.Keyboard.CLEAR=12,n.Keyboard.ENTER=13,n.Keyboard.SHIFT=16,n.Keyboard.CONTROL=17,n.Keyboard.ALT=18,n.Keyboard.CAPS_LOCK=20,n.Keyboard.ESC=27,n.Keyboard.SPACEBAR=32,n.Keyboard.PAGE_UP=33,n.Keyboard.PAGE_DOWN=34,n.Keyboard.END=35,n.Keyboard.HOME=36,n.Keyboard.LEFT=37,n.Keyboard.UP=38,n.Keyboard.RIGHT=39,n.Keyboard.DOWN=40,n.Keyboard.INSERT=45,n.Keyboard.DELETE=46,n.Keyboard.HELP=47,n.Keyboard.NUM_LOCK=144,n.Mouse=function(t){this.game=t;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.capture=!1;this.button=-1;this.disabled=!1;this.locked=!1;this.pointerLock=new n.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null},n.Mouse.NO_BUTTON=-1,n.Mouse.LEFT_BUTTON=0,n.Mouse.MIDDLE_BUTTON=1,n.Mouse.RIGHT_BUTTON=2,n.Mouse.prototype={start:function(){var n=this;this.game.device.android&&this.game.device.chrome===!1||(this._onMouseDown=function(t){return n.onMouseDown(t)},this._onMouseMove=function(t){return n.onMouseMove(t)},this._onMouseUp=function(t){return n.onMouseUp(t)},document.addEventListener("mousedown",this._onMouseDown,!0),document.addEventListener("mousemove",this._onMouseMove,!0),document.addEventListener("mouseup",this._onMouseUp,!0))},onMouseDown:function(n){(this.event=n,this.capture&&n.preventDefault(),this.button=n.which,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||(n.identifier=0,this.game.input.mousePointer.start(n))},onMouseMove:function(n){(this.event=n,this.capture&&n.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||(n.identifier=0,this.game.input.mousePointer.move(n))},onMouseUp:function(t){(this.event=t,this.capture&&t.preventDefault(),this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled)||(t.identifier=0,this.game.input.mousePointer.stop(t))},requestPointerLock:function(){var n,t;this.game.device.pointerLock&&(n=this.game.stage.canvas,n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestPointerLock(),t=this,this._pointerLockChange=function(n){return t.pointerLockChange(n)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0))},pointerLockChange:function(n){var t=this.game.stage.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,n)):(this.locked=!1,this.pointerLock.dispatch(!1,n))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){document.removeEventListener("mousedown",this._onMouseDown,!0);document.removeEventListener("mousemove",this._onMouseMove,!0);document.removeEventListener("mouseup",this._onMouseUp,!0)}},n.Mouse.prototype.constructor=n.Mouse,n.MSPointer=function(n){this.game=n;this.callbackContext=this.game;this.disabled=!1;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null},n.MSPointer.prototype={start:function(){var n=this;this.game.device.mspointer===!0&&(this._onMSPointerDown=function(t){return n.onPointerDown(t)},this._onMSPointerMove=function(t){return n.onPointerMove(t)},this._onMSPointerUp=function(t){return n.onPointerUp(t)},this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.renderer.view.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.renderer.view.style["-ms-content-zooming"]="none",this.game.renderer.view.style["-ms-touch-action"]="none")},onPointerDown:function(n){this.game.input.disabled||this.disabled||(n.preventDefault(),n.identifier=n.pointerId,this.game.input.startPointer(n))},onPointerMove:function(n){this.game.input.disabled||this.disabled||(n.preventDefault(),n.identifier=n.pointerId,this.game.input.updatePointer(n))},onPointerUp:function(n){this.game.input.disabled||this.disabled||(n.preventDefault(),n.identifier=n.pointerId,this.game.input.stopPointer(n))},stop:function(){this.game.stage.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.stage.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.stage.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.stage.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.stage.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.stage.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}},n.MSPointer.prototype.constructor=n.MSPointer,n.Pointer=function(t,i){this.game=t;this.id=i;this._holdSent=!1;this._history=[];this._nextDrop=0;this._stateReset=!1;this.withinGame=!1;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.x=-1;this.y=-1;this.isMouse=!1;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=!1;this.position=new n.Point;this.positionDown=new n.Point;this.circle=new n.Circle(0,0,44);i===0&&(this.isMouse=!0)},n.Pointer.prototype={start:function(t){return(this.identifier=t.identifier,this.target=t.target,typeof t.button!="undefined"&&(this.button=t.button),this.game.stage.disableVisibilityChange===!1&&this.game.paused&&this.game.stage.scale.incorrectOrientation===!1)?(this.game.paused=!1,this):(this._history.length=0,this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.msSinceLastClick=this.game.time.now-this.timeDown,this.timeDown=this.game.time.now,this._holdSent=!1,this.move(t),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,t),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse===!1&&this.game.input.currentPointers++,this.targetObject!==null&&this.targetObject._touchedHandler(this),this)},update:function(){this.active&&(this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop&&(this._nextDrop=this.game.time.now+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(t){if(!this.game.input.pollLocked){if(typeof t.button!="undefined"&&(this.button=t.button),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.game.paused)return this;if(this.game.input.moveCallback&&this.game.input.moveCallback.call(this.game.input.moveCallbackContext,this,this.x,this.y),this.targetObject!==null&&this.targetObject.isDragged===!0)return this.targetObject.update(this)===!1&&(this.targetObject=null),this;if(this._highestRenderOrderID=-1,this._highestRenderObject=null,this._highestInputPriorityID=-1,this.game.input.interactiveItems.total>0){var i=this.game.input.interactiveItems.next;do(i.pixelPerfect||i.priorityID>this._highestInputPriorityID||i.priorityID==this._highestInputPriorityID&&i.sprite.renderOrderID>this._highestRenderOrderID)&&i.checkPointerOver(this)&&(this._highestRenderOrderID=i.sprite.renderOrderID,this._highestInputPriorityID=i.priorityID,this._highestRenderObject=i),i=i.next;while(i!=null)}return this._highestRenderObject==null?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):this.targetObject==null?(this.targetObject=this._highestRenderObject,this._highestRenderObject._pointerOverHandler(this)):this.targetObject==this._highestRenderObject?this._highestRenderObject.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=this._highestRenderObject,this.targetObject._pointerOverHandler(this)),this}},leave:function(n){this.withinGame=!1;this.move(n)},stop:function(t){if(this._stateReset){t.preventDefault();return}if(this.timeUp=this.game.time.now,(this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.onUp.dispatch(this,t),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.total>0){var i=this.game.input.interactiveItems.next;do i&&i._releasedHandler(this),i=i.next;while(i!=null)}return this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null,this},justPressed:function(n){return n=n||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+n>this.game.time.now},justReleased:function(n){return n=n||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+n>this.game.time.now},reset:function(){this.isMouse===!1&&(this.active=!1);this.identifier=null;this.isDown=!1;this.isUp=!0;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null}},n.Pointer.prototype.constructor=n.Pointer,Object.defineProperty(n.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.now-this.timeDown}}),Object.defineProperty(n.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(n.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),n.Touch=function(n){this.game=n;this.disabled=!1;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=!0;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null},n.Touch.prototype={start:function(){var n=this;this.game.device.touch&&(this._onTouchStart=function(t){return n.onTouchStart(t)},this._onTouchMove=function(t){return n.onTouchMove(t)},this._onTouchEnd=function(t){return n.onTouchEnd(t)},this._onTouchEnter=function(t){return n.onTouchEnter(t)},this._onTouchLeave=function(t){return n.onTouchLeave(t)},this._onTouchCancel=function(t){return n.onTouchCancel(t)},this.game.renderer.view.addEventListener("touchstart",this._onTouchStart,!1),this.game.renderer.view.addEventListener("touchmove",this._onTouchMove,!1),this.game.renderer.view.addEventListener("touchend",this._onTouchEnd,!1),this.game.renderer.view.addEventListener("touchenter",this._onTouchEnter,!1),this.game.renderer.view.addEventListener("touchleave",this._onTouchLeave,!1),this.game.renderer.view.addEventListener("touchcancel",this._onTouchCancel,!1))},consumeDocumentTouches:function(){this._documentTouchMove=function(n){n.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(n){if(this.event=n,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,n),!this.game.input.disabled&&!this.disabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.startPointer(n.changedTouches[t])}},onTouchCancel:function(n){if(this.event=n,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,n),!this.game.input.disabled&&!this.disabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])}},onTouchEnter:function(n){(this.event=n,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||this.preventDefault&&n.preventDefault()},onTouchLeave:function(n){this.event=n;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault()},onTouchMove:function(n){this.event=n;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.updatePointer(n.changedTouches[t])},onTouchEnd:function(n){this.event=n;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.stage.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.stage.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.stage.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.stage.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.stage.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.stage.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},n.Touch.prototype.constructor=n.Touch,n.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=!1;this.priorityID=0;this.useHandCursor=!1;this.isDragged=!1;this.allowHorizontalDrag=!0;this.allowVerticalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnDrag=!1;this.snapOnRelease=!1;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfect=!1;this.pixelPerfectAlpha=255;this.draggable=!1;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=!1;this._tempPoint=new n.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},n.InputHandler.prototype={start:function(t,i){if(t=t||0,typeof i=="undefined"&&(i=!1),this.enabled===!1){this.game.input.interactiveItems.add(this);this.useHandCursor=i;this.priorityID=t;for(var r=0;r<10;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new n.Point;this.enabled=!0;this.sprite.events&&this.sprite.events.onInputOver==null&&(this.sprite.events.onInputOver=new n.Signal,this.sprite.events.onInputOut=new n.Signal,this.sprite.events.onInputDown=new n.Signal,this.sprite.events.onInputUp=new n.Signal,this.sprite.events.onDragStart=new n.Signal,this.sprite.events.onDragStop=new n.Signal)}return this.sprite},reset:function(){this.enabled=!1;for(var n=0;n<10;n++)this._pointerData[n]={id:n,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this),this.stop(),this.sprite=null)},pointerX:function(n){return n=n||0,this._pointerData[n].x},pointerY:function(n){return n=n||0,this._pointerData[n].y},pointerDown:function(n){return n=n||0,this._pointerData[n].isDown},pointerUp:function(n){return n=n||0,this._pointerData[n].isUp},pointerTimeDown:function(n){return n=n||0,this._pointerData[n].timeDown},pointerTimeUp:function(n){return n=n||0,this._pointerData[n].timeUp},pointerOver:function(n){if(this.enabled)if(typeof n=="undefined"){for(var t=0;t<10;t++)if(this._pointerData[t].isOver)return!0}else return this._pointerData[n].isOver;return!1},pointerOut:function(n){if(this.enabled)if(typeof n=="undefined"){for(var t=0;t<10;t++)if(this._pointerData[t].isOut)return!0}else return this._pointerData[n].isOut;return!1},pointerTimeOver:function(n){return n=n||0,this._pointerData[n].timeOver},pointerTimeOut:function(n){return n=n||0,this._pointerData[n].timeOut},pointerDragged:function(n){return n=n||0,this._pointerData[n].isDragged},checkPointerOver:function(n){return this.enabled===!1||this.sprite.visible===!1||this.sprite.group&&this.sprite.group.visible===!1?!1:(this.sprite.getLocalUnmodifiedPosition(this._tempPoint,n.x,n.y),this._tempPoint.x>=0&&this._tempPoint.x<=this.sprite.currentFrame.width&&this._tempPoint.y>=0&&this._tempPoint.y<=this.sprite.currentFrame.height?this.pixelPerfect?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0:void 0)},checkPixel:function(n,t){if(this.sprite.texture.baseTexture.source){this.game.input.hitContext.clearRect(0,0,1,1);n+=this.sprite.texture.frame.x;t+=this.sprite.texture.frame.y;this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,n,t,1,1,0,0,1,1);var i=this.game.input.hitContext.getImageData(0,0,1,1);if(i.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(n){return this.enabled===!1||this.sprite.visible===!1||this.sprite.group&&this.sprite.group.visible===!1?(this._pointerOutHandler(n),!1):this.draggable&&this._draggedPointerID==n.id?this.updateDrag(n):this._pointerData[n.id].isOver===!0?this.checkPointerOver(n)?(this._pointerData[n.id].x=n.x-this.sprite.x,this._pointerData[n.id].y=n.y-this.sprite.y,!0):(this._pointerOutHandler(n),!1):void 0},_pointerOverHandler:function(n){this._pointerData[n.id].isOver===!1&&(this._pointerData[n.id].isOver=!0,this._pointerData[n.id].isOut=!1,this._pointerData[n.id].timeOver=this.game.time.now,this._pointerData[n.id].x=n.x-this.sprite.x,this._pointerData[n.id].y=n.y-this.sprite.y,this.useHandCursor&&this._pointerData[n.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer"),this.sprite.events.onInputOver.dispatch(this.sprite,n))},_pointerOutHandler:function(n){this._pointerData[n.id].isOver=!1;this._pointerData[n.id].isOut=!0;this._pointerData[n.id].timeOut=this.game.time.now;this.useHandCursor&&this._pointerData[n.id].isDragged===!1&&(this.game.canvas.style.cursor="default");this.sprite&&this.sprite.events&&this.sprite.events.onInputOut.dispatch(this.sprite,n)},_touchedHandler:function(n){return this._pointerData[n.id].isDown===!1&&this._pointerData[n.id].isOver===!0&&(this._pointerData[n.id].isDown=!0,this._pointerData[n.id].isUp=!1,this._pointerData[n.id].timeDown=this.game.time.now,this.sprite.events.onInputDown.dispatch(this.sprite,n),this.draggable&&this.isDragged===!1&&this.startDrag(n),this.bringToTop&&this.sprite.bringToTop()),this.consumePointerEvent},_releasedHandler:function(n){this._pointerData[n.id].isDown&&n.isUp&&(this._pointerData[n.id].isDown=!1,this._pointerData[n.id].isUp=!0,this._pointerData[n.id].timeUp=this.game.time.now,this._pointerData[n.id].downDuration=this._pointerData[n.id].timeUp-this._pointerData[n.id].timeDown,this.checkPointerOver(n)?this.sprite.events.onInputUp.dispatch(this.sprite,n,!0):(this.sprite.events.onInputUp.dispatch(this.sprite,n,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default")),this.draggable&&this.isDragged&&this._draggedPointerID==n.id&&this.stopDrag(n))},updateDrag:function(n){return n.isUp?(this.stopDrag(n),!1):(this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=n.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=n.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=n.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.y=n.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0)},justOver:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOver&&this.overDuration(n)<t},justOut:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOut&&this.game.time.now-this._pointerData[n].timeOut<t},justPressed:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isDown&&this.downDuration(n)<t},justReleased:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isUp&&this.game.time.now-this._pointerData[n].timeUp<t},overDuration:function(n){return(n=n||0,this._pointerData[n].isOver)?this.game.time.now-this._pointerData[n].timeOver:-1},downDuration:function(n){return(n=n||0,this._pointerData[n].isDown)?this.game.time.now-this._pointerData[n].timeDown:-1},enableDrag:function(t,i,r,u,f,e){typeof t=="undefined"&&(t=!1);typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=255);typeof f=="undefined"&&(f=null);typeof e=="undefined"&&(e=null);this._dragPoint=new n.Point;this.draggable=!0;this.bringToTop=i;this.dragOffset=new n.Point;this.dragFromCenter=t;this.pixelPerfect=r;this.pixelPerfectAlpha=u;f&&(this.boundsRect=f);e&&(this.boundsSprite=e)},disableDrag:function(){if(this._pointerData)for(var n=0;n<10;n++)this._pointerData[n].isDragged=!1;this.draggable=!1;this.isDragged=!1;this._draggedPointerID=-1},startDrag:function(n){this.isDragged=!0;this._draggedPointerID=n.id;this._pointerData[n.id].isDragged=!0;this.sprite.fixedToCamera?this.dragFromCenter?(this.sprite.centerOn(n.x,n.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-n.x,this.sprite.cameraOffset.y-n.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-n.x,this.sprite.cameraOffset.y-n.y):this.dragFromCenter?(this.sprite.centerOn(n.x,n.y),this._dragPoint.setTo(this.sprite.x-n.x,this.sprite.y-n.y)):this._dragPoint.setTo(this.sprite.x-n.x,this.sprite.y-n.y);this.updateDrag(n);this.bringToTop&&this.sprite.bringToTop();this.sprite.events.onDragStart.dispatch(this.sprite,n)},stopDrag:function(n){this.isDragged=!1;this._draggedPointerID=-1;this._pointerData[n.id].isDragged=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop.dispatch(this.sprite,n);this.sprite.events.onInputUp.dispatch(this.sprite,n);this.checkPointerOver(n)===!1&&this._pointerOutHandler(n)},setDragLock:function(n,t){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=!0);this.allowHorizontalDrag=n;this.allowVerticalDrag=t},enableSnap:function(n,t,i,r){typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!1);typeof snapOffsetX=="undefined"&&(snapOffsetX=0);typeof snapOffsetY=="undefined"&&(snapOffsetY=0);this.snapX=n;this.snapY=t;this.snapOffsetX=snapOffsetX;this.snapOffsetY=snapOffsetY;this.snapOnDrag=i;this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1;this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.x<this.boundsRect.left?this.sprite.x=this.boundsRect.x:this.sprite.x+this.sprite.width>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-this.sprite.width),this.sprite.y<this.boundsRect.top?this.sprite.y=this.boundsRect.top:this.sprite.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-this.sprite.height))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.camerOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.camerOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.x<this.boundsSprite.x?this.sprite.x=this.boundsSprite.x:this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width&&(this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width),this.sprite.y<this.boundsSprite.y?this.sprite.y=this.boundsSprite.y:this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height&&(this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height))}},n.InputHandler.prototype.constructor=n.InputHandler,n.Gamepad=function(t){this.game=t;this._gamepads=[new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this)];this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.disabled=!1;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!=-1;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null},n.Gamepad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback)},start:function(){this._active=!0;var n=this;this._ongamepadconnected=function(t){var i=t.gamepad;n._rawPads.push(i);n._gamepads[i.index].connect(i)};window.addEventListener("gamepadconnected",this._ongamepadconnected,!1);this._ongamepaddisconnected=function(t){var i=t.gamepad;for(var r in n._rawPads)n._rawPads[r].index===i.index&&n._rawPads.splice(r,1);n._gamepads[i.index].disconnect()};window.addEventListener("gamepaddisconnected",this._ongamepaddisconnected,!1)},update:function(){this._pollGamepads();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n]._connected&&this._gamepads[n].pollStatus()},_pollGamepads:function(){var u=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads,h,n,i,t,f,o,r,s,e;if(u){for(this._rawPads=[],h=!1,n=0;n<u.length;n++)if(typeof u[n]!==this._prevRawGamepadTypes[n]&&(h=!0,this._prevRawGamepadTypes[n]=typeof u[n]),u[n]&&this._rawPads.push(u[n]),n===3)break;if(h){for(i={rawIndices:{},padIndices:{}},f=0;f<this._gamepads.length;f++)if(t=this._gamepads[f],t.connected)for(o=0;o<this._rawPads.length;o++)this._rawPads[o].index===t.index&&(i.rawIndices[t.index]=!0,i.padIndices[f]=!0);for(r=0;r<this._gamepads.length;r++)if(t=this._gamepads[r],!i.padIndices[r])for(this._rawPads.length<1&&t.disconnect(),s=0;s<this._rawPads.length;s++){if(i.padIndices[r])break;if(e=this._rawPads[s],e)if(i.rawIndices[e.index]){t.disconnect();continue}else t.connect(e),i.rawIndices[e.index]=!0,i.padIndices[r]=!0;else t.disconnect()}}}},setDeadZones:function(n){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=n},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._ongamepadconnected);window.removeEventListener("gamepaddisconnected",this._ongamepaddisconnected)},reset:function(){this.update();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].reset()},justPressed:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justPressed(n,t)===!0)return!0;return!1},justReleased:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justReleased(n,t)===!0)return!0;return!1},isDown:function(n){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(n)===!0)return!0;return!1}},n.Gamepad.prototype.constructor=n.Gamepad,Object.defineProperty(n.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(n.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(n.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(n.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(n.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(n.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(n.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),n.Gamepad.BUTTON_0=0,n.Gamepad.BUTTON_1=1,n.Gamepad.BUTTON_2=2,n.Gamepad.BUTTON_3=3,n.Gamepad.BUTTON_4=4,n.Gamepad.BUTTON_5=5,n.Gamepad.BUTTON_6=6,n.Gamepad.BUTTON_7=7,n.Gamepad.BUTTON_8=8,n.Gamepad.BUTTON_9=9,n.Gamepad.BUTTON_10=10,n.Gamepad.BUTTON_11=11,n.Gamepad.BUTTON_12=12,n.Gamepad.BUTTON_13=13,n.Gamepad.BUTTON_14=14,n.Gamepad.BUTTON_15=15,n.Gamepad.AXIS_0=0,n.Gamepad.AXIS_1=1,n.Gamepad.AXIS_2=2,n.Gamepad.AXIS_3=3,n.Gamepad.AXIS_4=4,n.Gamepad.AXIS_5=5,n.Gamepad.AXIS_6=6,n.Gamepad.AXIS_7=7,n.Gamepad.AXIS_8=8,n.Gamepad.AXIS_9=9,n.Gamepad.XBOX360_A=0,n.Gamepad.XBOX360_B=1,n.Gamepad.XBOX360_X=2,n.Gamepad.XBOX360_Y=3,n.Gamepad.XBOX360_LEFT_BUMPER=4,n.Gamepad.XBOX360_RIGHT_BUMPER=5,n.Gamepad.XBOX360_LEFT_TRIGGER=6,n.Gamepad.XBOX360_RIGHT_TRIGGER=7,n.Gamepad.XBOX360_BACK=8,n.Gamepad.XBOX360_START=9,n.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,n.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,n.Gamepad.XBOX360_DPAD_LEFT=14,n.Gamepad.XBOX360_DPAD_RIGHT=15,n.Gamepad.XBOX360_DPAD_UP=12,n.Gamepad.XBOX360_DPAD_DOWN=13,n.Gamepad.XBOX360_STICK_LEFT_X=0,n.Gamepad.XBOX360_STICK_LEFT_Y=1,n.Gamepad.XBOX360_STICK_RIGHT_X=2,n.Gamepad.XBOX360_STICK_RIGHT_Y=3,n.SinglePad=function(n,t){this.game=n;this._padParent=t;this._index=null;this._rawPad=null;this._connected=!1;this._prevTimestamp=null;this._rawButtons=[];this._buttons=[];this._axes=[];this._hotkeys=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26},n.SinglePad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback)},addButton:function(t){return this._hotkeys[t]=new n.GamepadButton(this.game,t),this._hotkeys[t]},pollStatus:function(){var n,t,u,i,r;if(!this._rawPad.timestamp||this._rawPad.timestamp!=this._prevTimestamp){for(n=0;n<this._rawPad.buttons.length;n+=1)t=this._rawPad.buttons[n],this._rawButtons[n]!==t&&(t===1?this.processButtonDown(n,t):t===0?this.processButtonUp(n,t):this.processButtonFloat(n,t),this._rawButtons[n]=t);for(u=this._rawPad.axes,i=0;i<u.length;i+=1)r=u[i],r>0&&r>this.deadZone||r<0&&r<-this.deadZone?this.processAxisChange({axis:i,value:r}):this.processAxisChange({axis:i,value:0});this._prevTimestamp=this._rawPad.timestamp}},connect:function(n){var t=!this._connected;this._index=n.index;this._connected=!0;this._rawPad=n;this._rawButtons=n.buttons;this._axes=n.axes;t&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this._index);t&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var n=this._connected,t;this._connected=!1;this._rawPad=undefined;this._rawButtons=[];this._buttons=[];t=this._index;this._index=null;n&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,t);n&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},processAxisChange:function(n){this.game.input.disabled||this.game.input.gamepad.disabled||this._axes[n.axis]!==n.value&&(this._axes[n.axis]=n.value,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,n,this._index),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,n))},processButtonDown:function(n,t){this.game.input.disabled||this.game.input.gamepad.disabled||(this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,n,t,this._index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,n,t),this._buttons[n]&&this._buttons[n].isDown?this._buttons[n].duration=this.game.time.now-this._buttons[n].timeDown:this._buttons[n]?(this._buttons[n].isDown=!0,this._buttons[n].timeDown=this.game.time.now,this._buttons[n].duration=0,this._buttons[n].value=t):this._buttons[n]={isDown:!0,timeDown:this.game.time.now,timeUp:0,duration:0,value:t},this._hotkeys[n]&&this._hotkeys[n].processButtonDown(t))},processButtonUp:function(n,t){this.game.input.disabled||this.game.input.gamepad.disabled||(this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,n,t,this._index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,n,t),this._hotkeys[n]&&this._hotkeys[n].processButtonUp(t),this._buttons[n]?(this._buttons[n].isDown=!1,this._buttons[n].timeUp=this.game.time.now,this._buttons[n].value=t):this._buttons[n]={isDown:!1,timeDown:this.game.time.now,timeUp:this.game.time.now,duration:0,value:t})},processButtonFloat:function(n,t){this.game.input.disabled||this.game.input.gamepad.disabled||(this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,n,t,this._index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,n,t),this._buttons[n]?this._buttons[n].value=t:this._buttons[n]={value:t},this._hotkeys[n]&&this._hotkeys[n].processButtonFloat(t))},axis:function(n){return this._axes[n]?this._axes[n]:!1},isDown:function(n){return this._buttons[n]?this._buttons[n].isDown:!1},justReleased:function(n,t){return typeof t=="undefined"&&(t=250),this._buttons[n]&&this._buttons[n].isDown===!1&&this.game.time.now-this._buttons[n].timeUp<t},justPressed:function(n,t){return typeof t=="undefined"&&(t=250),this._buttons[n]&&this._buttons[n].isDown&&this._buttons[n].duration<t},buttonValue:function(n){return this._buttons[n]?this._buttons[n].value:!1},reset:function(){for(var t,n=0;n<this._buttons.length;n++)this._buttons[n]=0;for(t=0;t<this._axes.length;t++)this._axes[t]=0}},n.SinglePad.prototype.constructor=n.SinglePad,Object.defineProperty(n.SinglePad.prototype,"connected",{get:function(){return this._connected}}),Object.defineProperty(n.SinglePad.prototype,"index",{get:function(){return this._index}}),n.GamepadButton=function(t,i){this.game=t;this.isDown=!1;this.isUp=!1;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=i;this.onDown=new n.Signal;this.onUp=new n.Signal;this.onFloat=new n.Signal},n.GamepadButton.prototype={processButtonDown:function(n){this.isDown?(this.duration=this.game.time.now-this.timeDown,this.repeats++):(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.value=n,this.onDown.dispatch(this,n))},processButtonUp:function(n){this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.now;this.value=n;this.onUp.dispatch(this,n)},processButtonFloat:function(n){this.value=n;this.onFloat.dispatch(this,n)},justPressed:function(n){return typeof n=="undefined"&&(n=250),this.isDown&&this.duration<n},justReleased:function(n){return typeof n=="undefined"&&(n=250),this.isDown===!1&&this.game.time.now-this.timeUp<n}},n.GamepadButton.prototype.constructor=n.GamepadButton,n.Events=function(t){this.parent=t;this.onAddedToGroup=new n.Signal;this.onRemovedFromGroup=new n.Signal;this.onKilled=new n.Signal;this.onRevived=new n.Signal;this.onOutOfBounds=new n.Signal;this.onInputOver=null;this.onInputOut=null;this.onInputDown=null;this.onInputUp=null;this.onDragStart=null;this.onDragStop=null;this.onAnimationStart=null;this.onAnimationComplete=null;this.onAnimationLoop=null;this.onBeginContact=null;this.onEndContact=null},n.Events.prototype={destroy:function(){this.parent=null;this.onAddedToGroup.dispose();this.onRemovedFromGroup.dispose();this.onKilled.dispose();this.onRevived.dispose();this.onOutOfBounds.dispose();this.onInputOver&&(this.onInputOver.dispose(),this.onInputOut.dispose(),this.onInputDown.dispose(),this.onInputUp.dispose(),this.onDragStart.dispose(),this.onDragStop.dispose());this.onAnimationStart&&(this.onAnimationStart.dispose(),this.onAnimationComplete.dispose(),this.onAnimationLoop.dispose())}},n.Events.prototype.constructor=n.Events,n.GameObjectFactory=function(n){this.game=n;this.world=this.game.world},n.GameObjectFactory.prototype={existing:function(n){return this.world.add(n)},sprite:function(n,t,i,r,u){return typeof u=="undefined"&&(u=this.world),u.create(n,t,i,r)},child:function(n,t,i,r,u){return n.create(t,i,r,u)},tween:function(n){return this.game.tweens.create(n)},group:function(t,i){return new n.Group(this.game,t,i)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},tileSprite:function(t,i,r,u,f,e){return typeof e=="undefined"&&(e=this.world),e.add(new n.TileSprite(this.game,t,i,r,u,f))},text:function(t,i,r,u,f){return typeof f=="undefined"&&(f=this.world),f.add(new n.Text(this.game,t,i,r,u))},button:function(t,i,r,u,f,e,o,s,h,c){return typeof c=="undefined"&&(c=this.world),c.add(new n.Button(this.game,t,i,r,u,f,e,o,s,h))},graphics:function(t,i,r){return typeof r=="undefined"&&(r=this.world),r.add(new n.Graphics(this.game,t,i))},emitter:function(t,i,r){return this.game.particles.add(new n.Particles.Arcade.Emitter(this.game,t,i,r))},bitmapText:function(t,i,r,u,f){return typeof f=="undefined"&&(f=this.world),this.world.add(new n.BitmapText(this.game,t,i,r,u))},tilemap:function(t,i){return new n.Tilemap(this.game,t,i)},renderTexture:function(t,i,r){var u=new n.RenderTexture(this.game,t,i,r);return this.game.cache.addRenderTexture(t,u),u},bitmapData:function(t,i){return new n.BitmapData(this.game,t,i)},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t}},n.GameObjectFactory.prototype.constructor=n.GameObjectFactory,n.BitmapData=function(i,r,u){typeof r=="undefined"&&(r=256);typeof u=="undefined"&&(u=256);this.game=i;this.name="";this.width=r;this.height=u;this.canvas=n.Canvas.create(r,u);this.context=this.canvas.getContext("2d");this.imageData=this.context.getImageData(0,0,r,u);this.pixels=this.imageData.data.buffer?this.imageData.data.buffer:this.imageData.data;this.baseTexture=new t.BaseTexture(this.canvas);this.texture=new t.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,r,u,"bitmapData",i.rnd.uuid());this.type=n.BITMAPDATA;this._dirty=!1},n.BitmapData.prototype={add:function(n){n.loadTexture(this)},addTo:function(n){for(var t=0;t<n.length;t++)n[t].texture&&n[t].loadTexture(this)},clear:function(){this.context.clearRect(0,0,this.width,this.height);this._dirty=!0},refreshBuffer:function(){this.imageData=this.context.getImageData(0,0,this.width,this.height);this.pixels=new Int32Array(this.imageData.data.buffer)},setPixel32:function(n,t,i,r,u,f){n>=0&&n<=this.width&&t>=0&&t<=this.height&&(this.pixels[t*this.width+n]=f<<24|u<<16|r<<8|i,this.context.putImageData(this.imageData,0,0),this._dirty=!0)},setPixel:function(n,t,i,r,u){this.setPixel32(n,t,i,r,u,255)},getPixel:function(n,t){if(n>=0&&n<=this.width&&t>=0&&t<=this.height)return this.data32[t*this.width+n]},getPixel32:function(n,t){if(n>=0&&n<=this.width&&t>=0&&t<=this.height)return this.data32[t*this.width+n]},getPixels:function(n){return this.context.getImageData(n.x,n.y,n.width,n.height)},arc:function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=!1),this._dirty=!0,this.context.arc(n,t,i,r,u,f),this},arcTo:function(n,t,i,r,u){return this._dirty=!0,this.context.arcTo(n,t,i,r,u),this},beginFill:function(n){return this.fillStyle(n),this},beginLinearGradientFill:function(n,t,i,r,u,f){for(var o=this.createLinearGradient(i,r,u,f),e=0,s=n.length;e<s;e++)o.addColorStop(t[e],n[e]);return this.fillStyle(o),this},beginLinearGradientStroke:function(n,t,i,r,u,f){for(var o=this.createLinearGradient(i,r,u,f),e=0,s=n.length;e<s;e++)o.addColorStop(t[e],n[e]);return this.strokeStyle(o),this},beginRadialGradientStroke:function(n,t,i,r,u,f,e,o){for(var h=this.createRadialGradient(i,r,u,f,e,o),s=0,c=n.length;s<c;s++)h.addColorStop(t[s],n[s]);return this.strokeStyle(h),this},beginPath:function(){return this.context.beginPath(),this},beginStroke:function(n){return this.strokeStyle(n),this},bezierCurveTo:function(n,t,i,r,u,f){return this._dirty=!0,this.context.bezierCurveTo(n,t,i,r,u,f),this},circle:function(n,t,i){return this.arc(n,t,i,0,Math.PI*2),this},clearRect:function(n,t,i,r){return this._dirty=!0,this.context.clearRect(n,t,i,r),this},clip:function(){return this._dirty=!0,this.context.clip(),this},closePath:function(){return this._dirty=!0,this.context.closePath(),this},createLinearGradient:function(n,t,i,r){return this.context.createLinearGradient(n,t,i,r)},createRadialGradient:function(n,t,i,r,u,f){return this.context.createRadialGradient(n,t,i,r,u,f)},ellipse:function(n,t,i,r){var c=.5522848,e=i/2*c,o=r/2*c,s=n+i,h=t+r,f=n+i/2,u=t+r/2;return this.moveTo(n,u),this.bezierCurveTo(n,u-o,f-e,t,f,t),this.bezierCurveTo(f+e,t,s,u-o,s,u),this.bezierCurveTo(s,u+o,f+e,h,f,h),this.bezierCurveTo(f-e,h,n,u+o,n,u),this},fill:function(){return this._dirty=!0,this.context.fill(),this},fillRect:function(n,t,i,r){return this._dirty=!0,this.context.fillRect(n,t,i,r),this},fillStyle:function(n){return this.context.fillStyle=n,this},font:function(n){return this.context.font=n,this},globalAlpha:function(n){return this.context.globalAlpha=n,this},globalCompositeOperation:function(n){return this.context.globalCompositeOperation=n,this},lineCap:function(n){return this.context.lineCap=n,this},lineDashOffset:function(n){return this.context.lineDashOffset=n,this},lineJoin:function(n){return this.context.lineJoin=n,this},lineWidth:function(n){return this.context.lineWidth=n,this},miterLimit:function(n){return this.context.miterLimit=n,this},lineTo:function(n,t){return this._dirty=!0,this.context.lineTo(n,t),this},moveTo:function(n,t){return this.context.moveTo(n,t),this},quadraticCurveTo:function(n,t,i,r){return this._dirty=!0,this.context.quadraticCurveTo(n,t,i,r),this},rect:function(n,t,i,r){return this._dirty=!0,this.context.rect(n,t,i,r),this},restore:function(){return this._dirty=!0,this.context.restore(),this},rotate:function(n){return this._dirty=!0,this.context.rotate(n),this},setStrokeStyle:function(n,t,i,r,u){return typeof n=="undefined"&&(n=1),typeof t=="undefined"&&(t="butt"),typeof i=="undefined"&&(i="miter"),typeof r=="undefined"&&(r=10),u=!1,this.lineWidth(n),this.lineCap(t),this.lineJoin(i),this.miterLimit(r),this},save:function(){return this._dirty=!0,this.context.save(),this},scale:function(n,t){return this._dirty=!0,this.context.scale(n,t),this},scrollPathIntoView:function(){return this._dirty=!0,this.context.scrollPathIntoView(),this},stroke:function(){return this._dirty=!0,this.context.stroke(),this},strokeRect:function(n,t,i,r){return this._dirty=!0,this.context.strokeRect(n,t,i,r),this},strokeStyle:function(n){return this.context.strokeStyle=n,this},render:function(){this._dirty&&(this.game.renderType==n.WEBGL&&t.texturesToUpdate.push(this.baseTexture),this._dirty=!1)}},n.BitmapData.prototype.constructor=n.BitmapData,n.BitmapData.prototype.mt=n.BitmapData.prototype.moveTo,n.BitmapData.prototype.lt=n.BitmapData.prototype.lineTo,n.BitmapData.prototype.at=n.BitmapData.prototype.arcTo,n.BitmapData.prototype.bt=n.BitmapData.prototype.bezierCurveTo,n.BitmapData.prototype.qt=n.BitmapData.prototype.quadraticCurveTo,n.BitmapData.prototype.a=n.BitmapData.prototype.arc,n.BitmapData.prototype.r=n.BitmapData.prototype.rect,n.BitmapData.prototype.cp=n.BitmapData.prototype.closePath,n.BitmapData.prototype.c=n.BitmapData.prototype.clear,n.BitmapData.prototype.f=n.BitmapData.prototype.beginFill,n.BitmapData.prototype.lf=n.BitmapData.prototype.beginLinearGradientFill,n.BitmapData.prototype.rf=n.BitmapData.prototype.beginRadialGradientFill,n.BitmapData.prototype.ef=n.BitmapData.prototype.endFill,n.BitmapData.prototype.ss=n.BitmapData.prototype.setStrokeStyle,n.BitmapData.prototype.s=n.BitmapData.prototype.beginStroke,n.BitmapData.prototype.ls=n.BitmapData.prototype.beginLinearGradientStroke,n.BitmapData.prototype.rs=n.BitmapData.prototype.beginRadialGradientStroke,n.BitmapData.prototype.dr=n.BitmapData.prototype.rect,n.BitmapData.prototype.dc=n.BitmapData.prototype.circle,n.BitmapData.prototype.de=n.BitmapData.prototype.ellipse,n.Sprite=function(i,r,u,f,e){r=r||0;u=u||0;f=f||null;e=e||null;this.game=i;this.exists=!0;this.alive=!0;this.group=null;this.name="";this.type=n.SPRITE;this.renderOrderID=-1;this.lifespan=0;this.events=new n.Events(this);this.animations=new n.AnimationManager(this);this.input=new n.InputHandler(this);this.key=f;this.currentFrame=null;f instanceof n.RenderTexture?(t.Sprite.call(this,f),this.currentFrame=this.game.cache.getTextureFrame(f.name)):f instanceof n.BitmapData?(t.Sprite.call(this,f.texture,f.textureFrame),this.currentFrame=f.textureFrame):f instanceof t.Texture?(t.Sprite.call(this,f),this.currentFrame=e):(f===null||typeof f=="undefined"?(f="__default",this.key=f):typeof f=="string"&&this.game.cache.checkImageKey(f)===!1&&(f="__missing",this.key=f),t.Sprite.call(this,t.TextureCache[f]),this.game.cache.isSpriteSheet(f)?(this.animations.loadFrameData(this.game.cache.getFrameData(f)),e!==null&&(typeof e=="string"?this.frameName=e:this.frame=e)):this.currentFrame=this.game.cache.getFrame(f));this.textureRegion=new n.Rectangle(this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height);this.anchor=new n.Point;this.x=r;this.y=u;this.position.x=r;this.position.y=u;this.world=new n.Point(r,u);this.autoCull=!1;this.scale=new n.Point(1,1);this._cache={fresh:!0,dirty:!1,a00:-1,a01:-1,a02:-1,a10:-1,a11:-1,a12:-1,id:-1,i01:-1,i10:-1,idi:-1,left:null,right:null,top:null,bottom:null,prevX:r,prevY:u,x:-1,y:-1,scaleX:1,scaleY:1,width:this.currentFrame.sourceSizeW,height:this.currentFrame.sourceSizeH,halfWidth:Math.floor(this.currentFrame.sourceSizeW/2),halfHeight:Math.floor(this.currentFrame.sourceSizeH/2),calcWidth:-1,calcHeight:-1,frameID:-1,frameWidth:this.currentFrame.width,frameHeight:this.currentFrame.height,cameraVisible:!0,cropX:0,cropY:0,cropWidth:this.currentFrame.sourceSizeW,cropHeight:this.currentFrame.sourceSizeH};this.offset=new n.Point;this.center=new n.Point(r+Math.floor(this._cache.width/2),u+Math.floor(this._cache.height/2));this.topLeft=new n.Point(r,u);this.topRight=new n.Point(r+this._cache.width,u);this.bottomRight=new n.Point(r+this._cache.width,u+this._cache.height);this.bottomLeft=new n.Point(r,u+this._cache.height);this.bounds=new n.Rectangle(r,u,this._cache.width,this._cache.height);this.body=new n.Physics.Arcade.Body(this);this.health=1;this.inWorld=n.Rectangle.intersects(this.bounds,this.game.world.bounds);this.inWorldThreshold=0;this.outOfBoundsKill=!1;this._outOfBoundsFired=!1;this.fixedToCamera=!1;this.cameraOffset=new n.Point(r,u);this.crop=new n.Rectangle(0,0,this._cache.width,this._cache.height);this.cropEnabled=!1;this.debug=!1;this.updateCache();this.updateBounds()},n.Sprite.prototype=Object.create(t.Sprite.prototype),n.Sprite.prototype.constructor=n.Sprite,n.Sprite.prototype.preUpdate=function(){if(this._cache.fresh){this.world.setTo(this.parent.position.x+this.x,this.parent.position.y+this.y);this.worldTransform[2]=this.world.x;this.worldTransform[5]=this.world.y;this._cache.fresh=!1;this.body&&(this.body.x=this.world.x-this.anchor.x*this.width+this.body.offset.x,this.body.y=this.world.y-this.anchor.y*this.height+this.body.offset.y,this.body.preX=this.body.x,this.body.preY=this.body.y);return}return!this.exists||this.group&&!this.group.exists?(this.renderOrderID=-1,!1):this.lifespan>0&&(this.lifespan-=this.game.time.elapsed,this.lifespan<=0)?(this.kill(),!1):(this._cache.dirty=!1,this.visible&&(this.renderOrderID=this.game.world.currentRenderOrderID++),this.updateCache(),this.updateAnimation(),this.updateCrop(),(this._cache.dirty||this.world.x!==this._cache.prevX||this.world.y!==this._cache.prevY)&&this.updateBounds(),this.body&&this.body.preUpdate(),!0)},n.Sprite.prototype.updateCache=function(){this._cache.prevX=this.world.x;this._cache.prevY=this.world.y;this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);(this.worldTransform[1]!=this._cache.i01||this.worldTransform[3]!=this._cache.i10||this.worldTransform[0]!=this._cache.a00||this.worldTransform[41]!=this._cache.a11)&&(this._cache.a00=this.worldTransform[0],this._cache.a01=this.worldTransform[1],this._cache.a10=this.worldTransform[3],this._cache.a11=this.worldTransform[4],this._cache.i01=this.worldTransform[1],this._cache.i10=this.worldTransform[3],this._cache.scaleX=Math.sqrt(this._cache.a00*this._cache.a00+this._cache.a01*this._cache.a01),this._cache.scaleY=Math.sqrt(this._cache.a10*this._cache.a10+this._cache.a11*this._cache.a11),this._cache.a01*=-1,this._cache.a10*=-1,this._cache.id=1/(this._cache.a00*this._cache.a11+this._cache.a01*-this._cache.a10),this._cache.idi=1/(this._cache.a00*this._cache.a11+this._cache.i01*-this._cache.i10),this._cache.dirty=!0);this._cache.a02=this.worldTransform[2];this._cache.a12=this.worldTransform[5]},n.Sprite.prototype.updateAnimation=function(){(this.animations.update()||this.currentFrame&&this.currentFrame.uuid!=this._cache.frameID)&&(this._cache.frameID=this.currentFrame.uuid,this._cache.frameWidth=this.texture.frame.width,this._cache.frameHeight=this.texture.frame.height,this._cache.width=this.currentFrame.width,this._cache.height=this.currentFrame.height,this._cache.halfWidth=Math.floor(this._cache.width/2),this._cache.halfHeight=Math.floor(this._cache.height/2),this._cache.dirty=!0)},n.Sprite.prototype.updateCrop=function(){this.cropEnabled&&(this.crop.width!=this._cache.cropWidth||this.crop.height!=this._cache.cropHeight||this.crop.x!=this._cache.cropX||this.crop.y!=this._cache.cropY)&&(this.crop.floorAll(),this._cache.cropX=this.crop.x,this._cache.cropY=this.crop.y,this._cache.cropWidth=this.crop.width,this._cache.cropHeight=this.crop.height,this.texture.frame=this.crop,this.texture.width=this.crop.width,this.texture.height=this.crop.height,this.texture.updateFrame=!0,t.Texture.frameUpdates.push(this.texture))},n.Sprite.prototype.updateBounds=function(){this.offset.setTo(this._cache.a02-this.anchor.x*this.width,this._cache.a12-this.anchor.y*this.height);this.getLocalPosition(this.center,this.offset.x+this.width/2,this.offset.y+this.height/2);this.getLocalPosition(this.topLeft,this.offset.x,this.offset.y);this.getLocalPosition(this.topRight,this.offset.x+this.width,this.offset.y);this.getLocalPosition(this.bottomLeft,this.offset.x,this.offset.y+this.height);this.getLocalPosition(this.bottomRight,this.offset.x+this.width,this.offset.y+this.height);this._cache.left=n.Math.min(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x);this._cache.right=n.Math.max(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x);this._cache.top=n.Math.min(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y);this._cache.bottom=n.Math.max(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y);this.bounds.setTo(this._cache.left,this._cache.top,this._cache.right-this._cache.left,this._cache.bottom-this._cache.top);this.updateFrame=!0;this.inWorld===!1?(this.inWorld=n.Rectangle.intersects(this.bounds,this.game.world.bounds,this.inWorldThreshold),this.inWorld&&(this._outOfBoundsFired=!1)):(this.inWorld=n.Rectangle.intersects(this.bounds,this.game.world.bounds,this.inWorldThreshold),this.inWorld===!1&&(this.events.onOutOfBounds.dispatch(this),this._outOfBoundsFired=!0,this.outOfBoundsKill&&this.kill()));this._cache.cameraVisible=n.Rectangle.intersects(this.game.world.camera.screenView,this.bounds,0);this.autoCull&&(this.renderable=this._cache.cameraVisible)},n.Sprite.prototype.getLocalPosition=function(n,t,i){return n.x=(this._cache.a11*this._cache.id*t+-this._cache.a01*this._cache.id*i+(this._cache.a12*this._cache.a01-this._cache.a02*this._cache.a11)*this._cache.id)*this.scale.x+this._cache.a02,n.y=(this._cache.a00*this._cache.id*i+-this._cache.a10*this._cache.id*t+(-this._cache.a12*this._cache.a00+this._cache.a02*this._cache.a10)*this._cache.id)*this.scale.y+this._cache.a12,n},n.Sprite.prototype.getLocalUnmodifiedPosition=function(n,t,i){return n.x=this._cache.a11*this._cache.idi*t+-this._cache.i01*this._cache.idi*i+(this._cache.a12*this._cache.i01-this._cache.a02*this._cache.a11)*this._cache.idi+this.anchor.x*this._cache.width,n.y=this._cache.a00*this._cache.idi*i+-this._cache.i10*this._cache.idi*t+(-this._cache.a12*this._cache.a00+this._cache.a02*this._cache.i10)*this._cache.idi+this.anchor.y*this._cache.height,n},n.Sprite.prototype.resetCrop=function(){this.crop=new n.Rectangle(0,0,this._cache.width,this._cache.height);this.texture.setFrame(this.crop);this.cropEnabled=!1},n.Sprite.prototype.postUpdate=function(){this.key instanceof n.BitmapData&&this.key._dirty&&this.key.render();this.exists&&(this.body&&this.body.postUpdate(),this.fixedToCamera?(this._cache.x=this.game.camera.view.x+this.cameraOffset.x,this._cache.y=this.game.camera.view.y+this.cameraOffset.y):(this._cache.x=this.x,this._cache.y=this.y),this.position.x=this._cache.x,this.position.y=this._cache.y)},n.Sprite.prototype.loadTexture=function(i,r){this.key=i;i instanceof n.RenderTexture?this.currentFrame=this.game.cache.getTextureFrame(i.name):i instanceof n.BitmapData?(this.setTexture(i.texture),this.currentFrame=i.textureFrame):i instanceof t.Texture?this.currentFrame=r:((typeof i=="undefined"||this.game.cache.checkImageKey(i)===!1)&&(i="__default",this.key=i),this.game.cache.isSpriteSheet(i)?(this.animations.loadFrameData(this.game.cache.getFrameData(i)),typeof r!="undefined"&&(typeof r=="string"?this.frameName=r:this.frame=r)):(this.currentFrame=this.game.cache.getFrame(i),this.setTexture(t.TextureCache[i])))},n.Sprite.prototype.centerOn=function(n,t){return this.fixedToCamera?(this.cameraOffset.x=n+(this.cameraOffset.x-this.center.x),this.cameraOffset.y=t+(this.cameraOffset.y-this.center.y)):(this.x=n+(this.x-this.center.x),this.y=t+(this.y-this.center.y)),this},n.Sprite.prototype.revive=function(n){return typeof n=="undefined"&&(n=1),this.alive=!0,this.exists=!0,this.visible=!0,this.health=n,this.events&&this.events.onRevived.dispatch(this),this},n.Sprite.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this},n.Sprite.prototype.destroy=function(){this.filters&&(this.filters=null);this.group&&this.group.remove(this);this.input&&this.input.destroy();this.events&&this.events.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.alive=!1;this.exists=!1;this.visible=!1;this.game=null},n.Sprite.prototype.damage=function(n){return this.alive&&(this.health-=n,this.health<0&&this.kill()),this},n.Sprite.prototype.reset=function(n,t,i){return typeof i=="undefined"&&(i=1),this.x=n,this.y=t,this.world.setTo(n,t),this.position.x=this.x,this.position.y=this.y,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=i,this.body&&this.body.reset(!1),this},n.Sprite.prototype.bringToTop=function(){return this.group?this.group.bringToTop(this):this.game.world.bringToTop(this),this},n.Sprite.prototype.play=function(n,t,i,r){if(this.animations)return this.animations.play(n,t,i,r)},Object.defineProperty(n.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache.prevX}}),Object.defineProperty(n.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache.prevY}}),Object.defineProperty(n.Sprite.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}}),Object.defineProperty(n.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(n){this.animations.frame=n}}),Object.defineProperty(n.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(n){this.animations.frameName=n}}),Object.defineProperty(n.Sprite.prototype,"inCamera",{get:function(){return this._cache.cameraVisible}}),Object.defineProperty(n.Sprite.prototype,"worldCenterX",{get:function(){return this.game.camera.x+this.center.x}}),Object.defineProperty(n.Sprite.prototype,"worldCenterY",{get:function(){return this.game.camera.y+this.center.y}}),Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.currentFrame.width},set:function(n){this.scale.x=n/this.currentFrame.width;this._cache.scaleX=n/this.currentFrame.width;this._width=n}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.currentFrame.height},set:function(n){this.scale.y=n/this.currentFrame.height;this._cache.scaleY=n/this.currentFrame.height;this._height=n}}),Object.defineProperty(n.Sprite.prototype,"inputEnabled",{get:function(){return this.input.enabled},set:function(n){n?this.input.enabled===!1&&this.input.start():this.input.enabled&&this.input.stop()}}),n.TileSprite=function(i,r,u,f,e,o){r=r||0;u=u||0;f=f||256;e=e||256;o=o||null;n.Sprite.call(this,i,r,u,o);this.texture=t.TextureCache[o];t.TilingSprite.call(this,this.texture,f,e);this.type=n.TILESPRITE;this.tileScale=new n.Point(1,1);this.tilePosition=new n.Point(0,0);this.body.width=f;this.body.height=e},n.TileSprite.prototype=n.Utils.extend(!0,t.TilingSprite.prototype,n.Sprite.prototype),n.TileSprite.prototype.constructor=n.TileSprite,Object.defineProperty(n.TileSprite.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}}),Object.defineProperty(n.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(n){this.animations.frame=n}}),Object.defineProperty(n.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(n){this.animations.frameName=n}}),Object.defineProperty(n.TileSprite.prototype,"inCamera",{get:function(){return this._cache.cameraVisible}}),Object.defineProperty(n.TileSprite.prototype,"inputEnabled",{get:function(){return this.input.enabled},set:function(n){n?this.input.enabled===!1&&this.input.start():this.input.enabled&&this.input.stop()}}),n.Text=function(i,r,u,f,e){r=r||0;u=u||0;f=f||"";e=e||"";this.game=i;this.exists=!0;this.alive=!0;this.group=null;this.name="";this.type=n.TEXT;this._text=f;this._style=e;t.Text.call(this,f,e);this.position.x=this.x=r;this.position.y=this.y=u;this.anchor=new n.Point;this.scale=new n.Point(1,1);this.fixedToCamera=!1;this.cameraOffset=new n.Point(r,u);this._cache={dirty:!1,a00:1,a01:0,a02:r,a10:0,a11:1,a12:u,id:1,x:-1,y:-1,scaleX:1,scaleY:1};this._cache.x=this.x;this._cache.y=this.y;this.renderable=!0},n.Text.prototype=Object.create(t.Text.prototype),n.Text.prototype.constructor=n.Text,n.Text.prototype.update=function(){this.exists&&(this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y),this._cache.dirty=!1,this._cache.x=this.x,this._cache.y=this.y,(this.position.x!=this._cache.x||this.position.y!=this._cache.y)&&(this.position.x=this._cache.x,this.position.y=this._cache.y,this._cache.dirty=!0))},n.Text.prototype.destroy=function(){this.group&&this.group.remove(this);this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);this.exists=!1;this.group=null},Object.defineProperty(n.Text.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}}),Object.defineProperty(n.Text.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}}),Object.defineProperty(n.Text.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}}),Object.defineProperty(n.Text.prototype,"content",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n,this.setText(n))}}),Object.defineProperty(n.Text.prototype,"font",{get:function(){return this._style},set:function(n){n!==this._style&&(this._style=n,this.setStyle(n))}}),n.BitmapText=function(i,r,u,f,e){r=r||0;u=u||0;f=f||"";e=e||"";this.game=i;this.exists=!0;this.alive=!0;this.group=null;this.name="";this.type=n.BITMAPTEXT;t.BitmapText.call(this,f,e);this.position.x=r;this.position.y=u;this.anchor=new n.Point;this.scale=new n.Point(1,1);this._cache={dirty:!1,a00:1,a01:0,a02:r,a10:0,a11:1,a12:u,id:1,x:-1,y:-1,scaleX:1,scaleY:1};this._cache.x=this.x;this._cache.y=this.y},n.BitmapText.prototype=Object.create(t.BitmapText.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.BitmapText.prototype.update=function(){this.exists&&(this._cache.dirty=!1,this._cache.x=this.x,this._cache.y=this.y,(this.position.x!=this._cache.x||this.position.y!=this._cache.y)&&(this.position.x=this._cache.x,this.position.y=this._cache.y,this._cache.dirty=!0),this.pivot.x=this.anchor.x*this.width,this.pivot.y=this.anchor.y*this.height)},n.BitmapText.prototype.destroy=function(){this.group&&this.group.remove(this);this.canvas&&this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);this.exists=!1;this.group=null},Object.defineProperty(n.BitmapText.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}}),Object.defineProperty(n.BitmapText.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}}),Object.defineProperty(n.BitmapText.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}}),n.Button=function(t,i,r,u,f,e,o,s,h,c){i=i||0;r=r||0;u=u||null;f=f||null;e=e||this;n.Sprite.call(this,t,i,r,u,s);this.type=n.BUTTON;this._onOverFrameName=null;this._onOutFrameName=null;this._onDownFrameName=null;this._onUpFrameName=null;this._onOverFrameID=null;this._onOutFrameID=null;this._onDownFrameID=null;this._onUpFrameID=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new n.Signal;this.onInputOut=new n.Signal;this.onInputDown=new n.Signal;this.onInputUp=new n.Signal;this.freezeFrames=!1;this.forceOut=!1;this.setFrames(o,s,h,c);f!==null&&this.onInputUp.add(f,e);this.input.start(0,!0);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this)},n.Button.prototype=Object.create(n.Sprite.prototype),n.Button.prototype=n.Utils.extend(!0,n.Button.prototype,n.Sprite.prototype,t.Sprite.prototype),n.Button.prototype.constructor=n.Button,n.Button.prototype.clearFrames=function(){this._onOverFrameName=null;this._onOverFrameID=null;this._onOutFrameName=null;this._onOutFrameID=null;this._onDownFrameName=null;this._onDownFrameID=null;this._onUpFrameName=null;this._onUpFrameID=null},n.Button.prototype.setFrames=function(n,t,i,r){this.clearFrames();n!==null&&(typeof n=="string"?(this._onOverFrameName=n,this.input.pointerOver()&&(this.frameName=n)):(this._onOverFrameID=n,this.input.pointerOver()&&(this.frame=n)));t!==null&&(typeof t=="string"?(this._onOutFrameName=t,this.input.pointerOver()===!1&&(this.frameName=t)):(this._onOutFrameID=t,this.input.pointerOver()===!1&&(this.frame=t)));i!==null&&(typeof i=="string"?(this._onDownFrameName=i,this.input.pointerDown()&&(this.frameName=i)):(this._onDownFrameID=i,this.input.pointerDown()&&(this.frame=i)));r!==null&&(typeof r=="string"?(this._onUpFrameName=r,this.input.pointerUp()&&(this.frameName=r)):(this._onUpFrameID=r,this.input.pointerUp()&&(this.frame=r)))},n.Button.prototype.setSounds=function(n,t,i,r,u,f,e,o){this.setOverSound(n,t);this.setOutSound(u,f);this.setDownSound(i,r);this.setUpSound(e,o)},n.Button.prototype.setOverSound=function(t,i){this.onOverSound=null;this.onOverSoundMarker="";t instanceof n.Sound&&(this.onOverSound=t);typeof i=="string"&&(this.onOverSoundMarker=i)},n.Button.prototype.setOutSound=function(t,i){this.onOutSound=null;this.onOutSoundMarker="";t instanceof n.Sound&&(this.onOutSound=t);typeof i=="string"&&(this.onOutSoundMarker=i)},n.Button.prototype.setDownSound=function(t,i){this.onDownSound=null;this.onDownSoundMarker="";t instanceof n.Sound&&(this.onDownSound=t);typeof i=="string"&&(this.onDownSoundMarker=i)},n.Button.prototype.setUpSound=function(t,i){this.onUpSound=null;this.onUpSoundMarker="";t instanceof n.Sound&&(this.onUpSound=t);typeof i=="string"&&(this.onUpSoundMarker=i)},n.Button.prototype.onInputOverHandler=function(n,t){this.freezeFrames===!1&&this.setState(1);this.onOverSound&&this.onOverSound.play(this.onOverSoundMarker);this.onInputOver&&this.onInputOver.dispatch(this,t)},n.Button.prototype.onInputOutHandler=function(n,t){this.freezeFrames===!1&&this.setState(2);this.onOutSound&&this.onOutSound.play(this.onOutSoundMarker);this.onInputOut&&this.onInputOut.dispatch(this,t)},n.Button.prototype.onInputDownHandler=function(n,t){this.freezeFrames===!1&&this.setState(3);this.onDownSound&&this.onDownSound.play(this.onDownSoundMarker);this.onInputDown&&this.onInputDown.dispatch(this,t)},n.Button.prototype.onInputUpHandler=function(n,t,i){(this.onUpSound&&this.onUpSound.play(this.onUpSoundMarker),this.onInputUp&&this.onInputUp.dispatch(this,t,i),this.freezeFrames)||(this.forceOut?this.setState(2):this._onUpFrameName||this._onUpFrameID?this.setState(4):i?this.setState(1):this.setState(2))},n.Button.prototype.setState=function(n){n===1?this._onOverFrameName!=null?this.frameName=this._onOverFrameName:this._onOverFrameID!=null&&(this.frame=this._onOverFrameID):n===2?this._onOutFrameName!=null?this.frameName=this._onOutFrameName:this._onOutFrameID!=null&&(this.frame=this._onOutFrameID):n===3?this._onDownFrameName!=null?this.frameName=this._onDownFrameName:this._onDownFrameID!=null&&(this.frame=this._onDownFrameID):n===4&&(this._onUpFrameName!=null?this.frameName=this._onUpFrameName:this._onUpFrameID!=null&&(this.frame=this._onUpFrameID))},n.Graphics=function(i,r,u){this.game=i;t.Graphics.call(this);this.type=n.GRAPHICS;this.position.x=r;this.position.y=u},n.Graphics.prototype=Object.create(t.Graphics.prototype),n.Graphics.prototype.constructor=n.Graphics,n.Graphics.prototype.destroy=function(){this.clear();this.group&&this.group.remove(this);this.game=null},n.Graphics.prototype.drawPolygon=function(n){this.moveTo(n.points[0].x,n.points[0].y);for(var t=1;t<n.points.length;t+=1)this.lineTo(n.points[t].x,n.points[t].y);this.lineTo(n.points[0].x,n.points[0].y)},Object.defineProperty(n.Graphics.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}}),Object.defineProperty(n.Graphics.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}}),Object.defineProperty(n.Graphics.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}}),n.RenderTexture=function(i,r,u,f){this.game=i;this.name=r;t.EventTarget.call(this);this.width=u||100;this.height=f||100;this.indetityMatrix=t.mat3.create();this.frame=new t.Rectangle(0,0,this.width,this.height);this.type=n.RENDERTEXTURE;this._tempPoint={x:0,y:0};t.gl?this.initWebGL():this.initCanvas()},n.RenderTexture.prototype=Object.create(t.Texture.prototype),n.RenderTexture.prototype.constructor=t.RenderTexture,n.RenderTexture.prototype.render=function(i,r,u,f){typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=!1);i instanceof n.Group&&(i=i._container);t.gl?this.renderWebGL(i,r,u,f):this.renderCanvas(i,r,u,f)},n.RenderTexture.prototype.renderXY=function(n,t,i,r,u){this._tempPoint.x=t;this._tempPoint.y=i;this.render(n,this._tempPoint,r,u)},n.RenderTexture.prototype.initWebGL=function(){var n=t.gl;this.glFramebuffer=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,this.glFramebuffer);this.glFramebuffer.width=this.width;this.glFramebuffer.height=this.height;this.baseTexture=new t.BaseTexture;this.baseTexture.width=this.width;this.baseTexture.height=this.height;this.baseTexture._glTexture=n.createTexture();n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);this.baseTexture.isRender=!0;n.bindFramebuffer(n.FRAMEBUFFER,this.glFramebuffer);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.baseTexture._glTexture,0);this.projection=new t.Point(this.width/2,-this.height/2)},n.RenderTexture.prototype.resize=function(n,i){if(this.width=n,this.height=i,t.gl){this.projection.x=this.width/2;this.projection.y=-this.height/2;var r=t.gl;r.bindTexture(r.TEXTURE_2D,this.baseTexture._glTexture);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},n.RenderTexture.prototype.initCanvas=function(){this.renderer=new t.CanvasRenderer(this.width,this.height,null,0);this.baseTexture=new t.BaseTexture(this.renderer.view);this.frame=new t.Rectangle(0,0,this.width,this.height)},n.RenderTexture.prototype.renderWebGL=function(n,i,r){var u=t.gl,o,s,e,h,f;for(u.colorMask(!0,!0,!0,!0),u.viewport(0,0,this.width,this.height),u.bindFramebuffer(u.FRAMEBUFFER,this.glFramebuffer),r&&(u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),o=n.children,s=n.worldTransform,n.worldTransform=t.mat3.create(),n.worldTransform[4]=-1,n.worldTransform[5]=this.projection.y*-2,i&&(n.worldTransform[2]=i.x,n.worldTransform[5]-=i.y),t.visibleCount++,n.vcount=t.visibleCount,e=0,h=o.length;e<h;e++)o[e].updateTransform();f=n.__renderGroup;f?n==f.root?f.render(this.projection,this.glFramebuffer):f.renderSpecific(n,this.projection,this.glFramebuffer):(this.renderGroup||(this.renderGroup=new t.WebGLRenderGroup(u)),this.renderGroup.setRenderable(n),this.renderGroup.render(this.projection,this.glFramebuffer));n.worldTransform=s},n.RenderTexture.prototype.renderCanvas=function(n,i,r,u){var e=n.children,f,o;for(n.worldTransform=t.mat3.create(),i&&(n.worldTransform[2]=i.x,n.worldTransform[5]=i.y),f=0,o=e.length;f<o;f++)e[f].updateTransform();r&&this.renderer.context.clearRect(0,0,this.width,this.height);this.renderer.renderDisplayObject(n,u);this.renderer.context.setTransform(1,0,0,1,0,0)},n.Canvas={create:function(n,t,i){n=n||256;t=t||256;var r=document.createElement("canvas");return typeof i=="string"&&(r.id=i),r.width=n,r.height=t,r.style.display="block",r},getOffset:function(t,i){i=i||new n.Point;var f=t.getBoundingClientRect(),e=t.clientTop||document.body.clientTop||0,o=t.clientLeft||document.body.clientLeft||0,r=0,u=0;return document.compatMode==="CSS1Compat"?(r=window.pageYOffset||document.documentElement.scrollTop||t.scrollTop||0,u=window.pageXOffset||document.documentElement.scrollLeft||t.scrollLeft||0):(r=window.pageYOffset||document.body.scrollTop||t.scrollTop||0,u=window.pageXOffset||document.body.scrollLeft||t.scrollLeft||0),i.x=f.left+u-o,i.y=f.top+r-e,i},getAspectRatio:function(n){return n.width/n.height},setBackgroundColor:function(n,t){return t=t||"rgb(0,0,0)",n.style.backgroundColor=t,n},setTouchAction:function(n,t){return t=t||"none",n.style.msTouchAction=t,n.style["ms-touch-action"]=t,n.style["touch-action"]=t,n},setUserSelect:function(n,t){return t=t||"none",n.style["-webkit-touch-callout"]=t,n.style["-webkit-user-select"]=t,n.style["-khtml-user-select"]=t,n.style["-moz-user-select"]=t,n.style["-ms-user-select"]=t,n.style["user-select"]=t,n.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",n},addToDOM:function(n,t,i){var r;return typeof i=="undefined"&&(i=!0),t&&(typeof t=="string"?r=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(r=t)),r||(r=document.body),i&&r.style&&(r.style.overflow="hidden"),r.appendChild(n),n},setTransform:function(n,t,i,r,u,f,e){return n.setTransform(r,f,e,u,t,i),n},setSmoothingEnabled:function(n,t){return n.imageSmoothingEnabled=t,n.mozImageSmoothingEnabled=t,n.oImageSmoothingEnabled=t,n.webkitImageSmoothingEnabled=t,n.msImageSmoothingEnabled=t,n},setImageRenderingCrisp:function(n){return n.style["image-rendering"]="optimizeSpeed",n.style["image-rendering"]="crisp-edges",n.style["image-rendering"]="-moz-crisp-edges",n.style["image-rendering"]="-webkit-optimize-contrast",n.style["image-rendering"]="optimize-contrast",n.style.msInterpolationMode="nearest-neighbor",n},setImageRenderingBicubic:function(n){return n.style["image-rendering"]="auto",n.style.msInterpolationMode="bicubic",n}},n.StageScaleMode=function(t,i,r){this.game=t;this.width=i;this.height=r;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this._startHeight=0;this.forceLandscape=!1;this.forcePortrait=!1;this.incorrectOrientation=!1;this.pageAlignHorizontally=!1;this.pageAlignVertically=!1;this._width=0;this._height=0;this.maxIterations=5;this.orientationSprite=null;this.enterLandscape=new n.Signal;this.enterPortrait=new n.Signal;this.enterIncorrectOrientation=new n.Signal;this.leaveIncorrectOrientation=new n.Signal;this.hasResized=new n.Signal;this.orientation=window.orientation?window.orientation:window.outerWidth>window.outerHeight?90:0;this.scaleFactor=new n.Point(1,1);this.scaleFactorInversed=new n.Point(1,1);this.margin=new n.Point(0,0);this.aspectRatio=0;this.event=null;var u=this;window.addEventListener("orientationchange",function(n){return u.checkOrientation(n)},!1);window.addEventListener("resize",function(n){return u.checkResize(n)},!1);document.addEventListener("webkitfullscreenchange",function(n){return u.fullScreenChange(n)},!1);document.addEventListener("mozfullscreenchange",function(n){return u.fullScreenChange(n)},!1);document.addEventListener("fullscreenchange",function(n){return u.fullScreenChange(n)},!1)},n.StageScaleMode.EXACT_FIT=0,n.StageScaleMode.NO_SCALE=1,n.StageScaleMode.SHOW_ALL=2,n.StageScaleMode.prototype={startFullScreen:function(t){if(!this.isFullScreen){typeof t!="undefined"&&n.Canvas.setSmoothingEnabled(this.game.context,t);var i=this.game.canvas;this._width=this.width;this._height=this.height;i.requestFullScreen?i.requestFullScreen():i.mozRequestFullScreen?i.parentNode.mozRequestFullScreen():i.webkitRequestFullScreen&&i.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}},stopFullScreen:function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},fullScreenChange:function(t){this.event=t;this.isFullScreen?this.game.stage.fullScreenScaleMode===n.StageScaleMode.EXACT_FIT?(this.game.stage.canvas.style.width="100%",this.game.stage.canvas.style.height="100%",this.setMaximum(),this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height):this.game.stage.fullScreenScaleMode===n.StageScaleMode.SHOW_ALL&&(this.game.stage.scale.setShowAll(),this.game.stage.scale.refresh()):(this.game.stage.canvas.style.width=this.game.width+"px",this.game.stage.canvas.style.height=this.game.height+"px",this.width=this._width,this.height=this._height,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height)},forceOrientation:function(n,i,r){typeof i=="undefined"&&(i=!1);this.forceLandscape=n;this.forcePortrait=i;typeof r!="undefined"&&((r==null||this.game.cache.checkImageKey(r)===!1)&&(r="__default"),this.orientationSprite=new t.Sprite(t.TextureCache[r]),this.orientationSprite.anchor.x=.5,this.orientationSprite.anchor.y=.5,this.orientationSprite.position.x=this.game.width/2,this.orientationSprite.position.y=this.game.height/2,this.checkOrientationState(),this.incorrectOrientation?(this.orientationSprite.visible=!0,this.game.world.visible=!1):(this.orientationSprite.visible=!1,this.game.world.visible=!0),this.game.stage._stage.addChild(this.orientationSprite))},checkOrientationState:function(){this.incorrectOrientation?(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth)&&(this.game.paused=!1,this.incorrectOrientation=!1,this.leaveIncorrectOrientation.dispatch(),this.orientationSprite&&(this.orientationSprite.visible=!1,this.game.world.visible=!0),this.refresh()):(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth)&&(this.game.paused=!0,this.incorrectOrientation=!0,this.enterIncorrectOrientation.dispatch(),this.orientationSprite&&this.orientationSprite.visible===!1&&(this.orientationSprite.visible=!0,this.game.world.visible=!1),this.refresh())},checkOrientation:function(t){this.event=t;this.orientation=window.orientation;this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0);this.game.stage.scaleMode!==n.StageScaleMode.NO_SCALE&&this.refresh()},checkResize:function(t){this.event=t;this.orientation=window.outerWidth>window.outerHeight?90:0;this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0);this.game.stage.scaleMode!==n.StageScaleMode.NO_SCALE&&this.refresh();this.checkOrientationState()},refresh:function(){if(this.game.device.iPad===!1&&this.game.device.webApp===!1&&this.game.device.desktop===!1&&(this.game.device.android&&this.game.device.chrome===!1?window.scrollTo(0,1):window.scrollTo(0,0)),this._check==null&&this.maxIterations>0){this._iterations=this.maxIterations;var n=this;this._check=window.setInterval(function(){return n.setScreenSize()},10);this.setScreenSize()}},setScreenSize:function(t){typeof t=="undefined"&&(t=!1);this.game.device.iPad===!1&&this.game.device.webApp===!1&&this.game.device.desktop===!1&&(this.game.device.android&&this.game.device.chrome===!1?window.scrollTo(0,1):window.scrollTo(0,0));this._iterations--;(t||window.innerHeight>this._startHeight||this._iterations<0)&&(document.documentElement.style.minHeight=window.innerHeight+"px",this.incorrectOrientation===!0?this.setMaximum():this.isFullScreen?this.game.stage.fullScreenScaleMode==n.StageScaleMode.EXACT_FIT?this.setExactFit():this.game.stage.fullScreenScaleMode==n.StageScaleMode.SHOW_ALL&&this.setShowAll():this.game.stage.scaleMode==n.StageScaleMode.EXACT_FIT?this.setExactFit():this.game.stage.scaleMode==n.StageScaleMode.SHOW_ALL&&this.setShowAll(),this.setSize(),clearInterval(this._check),this._check=null)},setSize:function(){this.incorrectOrientation===!1&&(this.maxWidth&&this.width>this.maxWidth&&(this.width=this.maxWidth),this.maxHeight&&this.height>this.maxHeight&&(this.height=this.maxHeight),this.minWidth&&this.width<this.minWidth&&(this.width=this.minWidth),this.minHeight&&this.height<this.minHeight&&(this.height=this.minHeight));this.game.canvas.style.width=this.width+"px";this.game.canvas.style.height=this.height+"px";this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.pageAlignHorizontally&&(this.width<window.innerWidth&&this.incorrectOrientation===!1?(this.margin.x=Math.round((window.innerWidth-this.width)/2),this.game.canvas.style.marginLeft=this.margin.x+"px"):(this.margin.x=0,this.game.canvas.style.marginLeft="0px"));this.pageAlignVertically&&(this.height<window.innerHeight&&this.incorrectOrientation===!1?(this.margin.y=Math.round((window.innerHeight-this.height)/2),this.game.canvas.style.marginTop=this.margin.y+"px"):(this.margin.y=0,this.game.canvas.style.marginTop="0px"));n.Canvas.getOffset(this.game.canvas,this.game.stage.offset);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.hasResized.dispatch(this.width,this.height);this.checkOrientationState()},setMaximum:function(){this.width=window.innerWidth;this.height=window.innerHeight},setShowAll:function(){var n=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*n);this.height=Math.round(this.game.height*n)},setExactFit:function(){var n=window.innerWidth,t=window.innerHeight;this.width=this.maxWidth&&n>this.maxWidth?this.maxWidth:n;this.height=this.maxHeight&&t>this.maxHeight?this.maxHeight:t}},n.StageScaleMode.prototype.constructor=n.StageScaleMode,Object.defineProperty(n.StageScaleMode.prototype,"isFullScreen",{get:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(n.StageScaleMode.prototype,"isPortrait",{get:function(){return this.orientation===0||this.orientation==180}}),Object.defineProperty(n.StageScaleMode.prototype,"isLandscape",{get:function(){return this.orientation===90||this.orientation===-90}}),n.Device=function(){this.patchAndroidClearRectBug=!1;this.desktop=!1;this.iOS=!1;this.cocoonJS=!1;this.ejecta=!1;this.android=!1;this.chromeOS=!1;this.linux=!1;this.macOS=!1;this.windows=!1;this.canvas=!1;this.file=!1;this.fileSystem=!1;this.localStorage=!1;this.webGL=!1;this.worker=!1;this.touch=!1;this.mspointer=!1;this.css3D=!1;this.pointerLock=!1;this.typedArray=!1;this.vibration=!1;this.quirksMode=!1;this.arora=!1;this.chrome=!1;this.epiphany=!1;this.firefox=!1;this.ie=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.mobileSafari=!1;this.midori=!1;this.opera=!1;this.safari=!1;this.webApp=!1;this.silk=!1;this.audioData=!1;this.webAudio=!1;this.ogg=!1;this.opus=!1;this.mp3=!1;this.wav=!1;this.m4a=!1;this.webm=!1;this.iPhone=!1;this.iPhone4=!1;this.iPad=!1;this.pixelRatio=0;this.littleEndian=!1;this._checkAudio();this._checkBrowser();this._checkCSS3D();this._checkDevice();this._checkFeatures();this._checkOS()},n.Device.prototype={_checkOS:function(){var n=navigator.userAgent;/Android/.test(n)?this.android=!0:/CrOS/.test(n)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(n)?this.iOS=!0:/Linux/.test(n)?this.linux=!0:/Mac OS/.test(n)?this.macOS=!0:/Windows/.test(n)&&(this.windows=!0);(this.windows||this.macOS||this.linux&&this.silk===!1)&&(this.desktop=!0)},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D;try{this.localStorage=!!localStorage.getItem}catch(n){this.localStorage=!1}this.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;this.fileSystem=!!window.requestFileSystem;this.webGL=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}();this.webGL=this.webGL===null||this.webGL===!1?!1:!0;this.worker=!!window.Worker;("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)&&(this.touch=!0);(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(this.mspointer=!0);this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;this.quirksMode=document.compatMode==="CSS1Compat"?!1:!0},_checkBrowser:function(){var n=navigator.userAgent;/Arora/.test(n)?this.arora=!0:/Chrome/.test(n)?this.chrome=!0:/Epiphany/.test(n)?this.epiphany=!0:/Firefox/.test(n)?this.firefox=!0:/Mobile Safari/.test(n)?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(n)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(n)?this.midori=!0:/Opera/.test(n)?this.opera=!0:/Safari/.test(n)?this.safari=!0:/Silk/.test(n)?this.silk=!0:/Trident\/(\d+\.\d+);/.test(n)&&(this.ie=!0,this.trident=!0,this.tridentVersion=parseInt(RegExp.$1,10));navigator.standalone&&(this.webApp=!0);navigator.isCocoonJS&&(this.cocoonJS=!0);typeof ejecta!="undefined"&&(this.ejecta=!0)},_checkAudio:function(){this.audioData=!!window.Audio;this.webAudio=!!(window.webkitAudioContext||window.AudioContext);var n=document.createElement("audio"),t=!1;try{(t=!!n.canPlayType)&&(n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")&&(this.opus=!0),n.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0),n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.webm=!0))}catch(i){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1;this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.iPhone4=this.pixelRatio==2&&this.iPhone;this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;typeof Int8Array!="undefined"?(this.littleEndian=new Int8Array(new Int16Array([1]).buffer)[0]>0,this.typedArray=!0):(this.littleEndian=!1,this.typedArray=!1);navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(this.vibration=!0)},_checkCSS3D:function(){var n=document.createElement("p"),t,r={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},i;document.body.insertBefore(n,null);for(i in r)n.style[i]!==undefined&&(n.style[i]="translate3d(1px,1px,1px)",t=window.getComputedStyle(n).getPropertyValue(r[i]));document.body.removeChild(n);this.css3D=t!==undefined&&t.length>0&&t!=="none"},canPlayAudio:function(n){return n=="mp3"&&this.mp3?!0:n=="ogg"&&(this.ogg||this.opus)||n=="m4a"&&this.m4a||n=="wav"&&this.wav||n=="webm"&&this.webm?!0:!1},isConsoleOpen:function(){return window.console&&window.console.firebug?!0:window.console?(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles.length>0):!1}},n.Device.prototype.constructor=n.Device,n.RequestAnimationFrame=function(n){var i,t;for(this.game=n,this.isRunning=!1,i=["ms","moz","webkit","o"],t=0;t<i.length&&!window.requestAnimationFrame;t++)window.requestAnimationFrame=window[i[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[t]+"CancelAnimationFrame"];this._isSetTimeOut=!1;this._onLoop=null;this._timeOutID=null},n.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var n=this;window.requestAnimationFrame?(this._isSetTimeOut=!1,this._onLoop=function(t){return n.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop)):(this._isSetTimeOut=!0,this._onLoop=function(){return n.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0))},updateRAF:function(n){this.game.update(n);this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},n.RequestAnimationFrame.prototype.constructor=n.RequestAnimationFrame,n.RandomDataGenerator=function(n){typeof n=="undefined"&&(n=[]);this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(n)},n.RandomDataGenerator.prototype={rnd:function(){var n=2091639*this.s0+this.c*23283064365386963e-26;return this.c=n|0,this.s0=this.s1,this.s1=this.s2,this.s2=n-this.c,this.s2},sow:function(n){var t,i;for(typeof n=="undefined"&&(n=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,i=0;t=n[i++];)this.s0-=this.hash(t),this.s0+=~~(this.s0<0),this.s1-=this.hash(t),this.s1+=~~(this.s1<0),this.s2-=this.hash(t),this.s2+=~~(this.s2<0)},hash:function(n){var i,r,t;for(t=4022871197,n=n.toString(),r=0;r<n.length;r++)t+=n.charCodeAt(r),i=.025196032824169379*t,t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296;return(t>>>0)*23283064365386963e-26},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*11102230246251565e-32},real:function(){return this.integer()+this.frac()},integerInRange:function(n,t){return Math.floor(this.realInRange(n,t))},realInRange:function(n,t){return this.frac()*(t-n)+n},normal:function(){return 1-2*this.frac()},uuid:function(){for(var n="",t="",t=n="";n++<36;t+=~n%5|n*3&4?(n^15?8^this.frac()*(n^20?16:4):4).toString(16):"-");return t},pick:function(n){return n[this.integerInRange(0,n.length)]},weightedPick:function(n){return n[~~(Math.pow(this.frac(),2)*n.length)]},timestamp:function(n,t){return this.realInRange(n||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)}},n.RandomDataGenerator.prototype.constructor=n.RandomDataGenerator,n.Math={PI2:Math.PI*2,fuzzyEqual:function(n,t,i){return typeof i=="undefined"&&(i=.0001),Math.abs(n-t)<i},fuzzyLessThan:function(n,t,i){return typeof i=="undefined"&&(i=.0001),n<t+i},fuzzyGreaterThan:function(n,t,i){return typeof i=="undefined"&&(i=.0001),n>t-i},fuzzyCeil:function(n,t){return typeof t=="undefined"&&(t=.0001),Math.ceil(n-t)},fuzzyFloor:function(n,t){return typeof t=="undefined"&&(t=.0001),Math.floor(n+t)},average:function(){for(var r,i,n=[],t=0;t<arguments.length-0;t++)n[t]=arguments[t+0];for(r=0,i=0;i<n.length;i++)r+=n[i];return r/n.length},truncate:function(n){return n>0?Math.floor(n):Math.ceil(n)},shear:function(n){return n%1},snapTo:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.round(n/t),i+n)},snapToFloor:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.floor(n/t),i+n)},snapToCeil:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.ceil(n/t),i+n)},snapToInArray:function(n,t,i){var r,u,f;if(typeof i=="undefined"&&(i=!0),i&&t.sort(),n<t[0])return t[0];for(r=1;t[r]<n;)r++;return u=t[r-1],f=r<t.length?t[r]:Number.POSITIVE_INFINITY,f-n<=n-u?f:u},roundTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.round(n*r)/r},floorTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.floor(n*r)/r},ceilTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.ceil(n*r)/r},interpolateFloat:function(n,t,i){return(t-n)*i+n},angleBetween:function(n,t,i,r){return Math.atan2(r-t,i-n)},reverseAngle:function(n){return this.normalizeAngle(n+Math.PI,!0)},normalizeAngle:function(n){return n=n%(2*Math.PI),n>=0?n:n+2*Math.PI},normalizeLatitude:function(n){return Math.max(-90,Math.min(90,n))},normalizeLongitude:function(n){return n%360==180?180:(n=n%360,n<-180?n+360:n>180?n-360:n)},nearestAngleBetween:function(n,t,i){typeof i=="undefined"&&(i=!0);var r=i?Math.PI:180;return n=this.normalizeAngle(n,i),t=this.normalizeAngle(t,i),n<-r/2&&t>r/2&&(n+=r*2),t<-r/2&&n>r/2&&(t+=r*2),t-n},interpolateAngles:function(n,t,i,r,u){return typeof r=="undefined"&&(r=!0),typeof u=="undefined"&&(u=null),n=this.normalizeAngle(n,r),t=this.normalizeAngleToAnother(t,n,r),typeof u=="function"?u(i,n,t-n,1):this.interpolateFloat(n,t,i)},chanceRoll:function(n){return typeof n=="undefined"&&(n=50),n<=0?!1:n>=100?!0:Math.random()*100>=n?!1:!0},numberArray:function(n,t){for(var r=[],i=n;i<=t;i++)r.push(i);return r},maxAdd:function(n,t,i){return n+=t,n>i&&(n=i),n},minSub:function(n,t,i){return n-=t,n<i&&(n=i),n},wrap:function(n,t,i){var u=i-t,r;return u<=0?0:(r=(n-t)%u,r<0&&(r+=u),r+t)},wrapValue:function(n,t,i){return n=Math.abs(n),t=Math.abs(t),i=Math.abs(i),(n+t)%i},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(n){return n&1},isEven:function(n){return n&1?!1:!0},max:function(){for(var n=1,t=0,i=arguments.length;n<i;n++)arguments[t]<arguments[n]&&(t=n);return arguments[t]},min:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]<n[i]&&(i=t);return n[i]},max:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]>n[i]&&(i=t);return n[i]},minProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]<t[r][n]&&(r=i);return t[r][n]},maxProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]>t[r][n]&&(r=i);return t[r][n]},wrapAngle:function(n){return this.wrap(n,-180,180)},angleLimit:function(n,t,i){var r=n;return n>i?r=i:n<t&&(r=t),r},linearInterpolation:function(n,t){var i=n.length-1,r=i*t,u=Math.floor(r);return t<0?this.linear(n[0],n[1],r):t>1?this.linear(n[i],n[i-1],i-r):this.linear(n[u],n[u+1>i?i:u+1],r-u)},bezierInterpolation:function(n,t){for(var u=0,r=n.length-1,i=0;i<=r;i++)u+=Math.pow(1-t,r-i)*Math.pow(t,i)*n[i]*this.bernstein(r,i);return u},catmullRomInterpolation:function(n,t){var i=n.length-1,u=i*t,r=Math.floor(u);return n[0]===n[i]?(t<0&&(r=Math.floor(u=i*(1+t))),this.catmullRom(n[(r-1+i)%i],n[r],n[(r+1)%i],n[(r+2)%i],u-r)):t<0?n[0]-(this.catmullRom(n[0],n[0],n[1],n[1],-u)-n[0]):t>1?n[i]-(this.catmullRom(n[i],n[i],n[i-1],n[i-1],u-i)-n[i]):this.catmullRom(n[r?r-1:0],n[r],n[i<r+1?i:r+1],n[i<r+2?i:r+2],u-r)},linear:function(n,t,i){return(t-n)*i+n},bernstein:function(n,t){return this.factorial(n)/this.factorial(t)/this.factorial(n-t)},catmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t},difference:function(n,t){return Math.abs(n-t)},getRandom:function(n,t,i){if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=0),n!=null){var r=i;if((r===0||r>n.length-t)&&(r=n.length-t),r>0)return n[t+Math.floor(Math.random()*r)]}return null},floor:function(n){var t=n|0;return n>0?t:t!=n?t-1:t},ceil:function(n){var t=n|0;return n>0?t!=n?t+1:t:t},sinCosGenerator:function(n,t,i,r){var u;typeof t=="undefined"&&(t=1);typeof i=="undefined"&&(i=1);typeof r=="undefined"&&(r=1);var f=t,e=i,o=r*Math.PI/n,s=[],h=[];for(u=0;u<n;u++)e-=f*o,f+=e*o,s[u]=e,h[u]=f;return{sin:h,cos:s,length:n}},shift:function(n){var t=n.shift();return n.push(t),t},shuffleArray:function(n){for(var i,r,t=n.length-1;t>0;t--)i=Math.floor(Math.random()*(t+1)),r=n[t],n[t]=n[i],n[i]=r;return n},distance:function(n,t,i,r){var u=n-i,f=t-r;return Math.sqrt(u*u+f*f)},distancePow:function(n,t,i,r,u){return typeof u=="undefined"&&(u=2),Math.sqrt(Math.pow(i-n,u)+Math.pow(r-t,u))},distanceRounded:function(t,i,r,u){return Math.round(n.Math.distance(t,i,r,u))},clamp:function(n,t,i){return n<t?t:n>i?i:n},clampBottom:function(n,t){return n<t?t:n},within:function(n,t,i){return Math.abs(n-t)<=i},mapLinear:function(n,t,i,r,u){return r+(n-t)*(u-r)/(i-t)},smoothstep:function(n,t,i){return n<=t?0:n>=i?1:(n=(n-t)/(i-t),n*n*(3-2*n))},smootherstep:function(n,t,i){return n<=t?0:n>=i?1:(n=(n-t)/(i-t),n*n*n*(n*(n*6-15)+10))},sign:function(n){return n<0?-1:n>0?1:0},degToRad:function(){var n=Math.PI/180;return function(t){return t*n}}(),radToDeg:function(){var n=180/Math.PI;return function(t){return t*n}}()},n.QuadTree=function(n,t,i,r,u,f,e){this.maxObjects=u||10;this.maxLevels=f||4;this.level=e||0;this.bounds={x:Math.round(n),y:Math.round(t),width:i,height:r,subWidth:Math.floor(i/2),subHeight:Math.floor(r/2),right:Math.round(n)+Math.floor(i/2),bottom:Math.round(t)+Math.floor(r/2)};this.objects=[];this.nodes=[]},n.QuadTree.prototype={populate:function(n){n.forEach(this.populateHandler,this,!0)},populateHandler:function(n){n.body&&n.body.checkCollision.none===!1&&n.alive&&this.insert(n.body)},split:function(){this.level++;this.nodes[0]=new n.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[1]=new n.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[2]=new n.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[3]=new n.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level)},insert:function(n){var i=0,t;if(this.nodes[0]!=null&&(t=this.getIndex(n),t!==-1)){this.nodes[t].insert(n);return}if(this.objects.push(n),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(this.nodes[0]==null&&this.split();i<this.objects.length;)t=this.getIndex(this.objects[i]),t!==-1?this.nodes[t].insert(this.objects.splice(i,1)[0]):i++},getIndex:function(n){var t=-1;return n.x<this.bounds.right&&n.right<this.bounds.right?n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=1:n.y>this.bounds.bottom&&(t=2):n.x>this.bounds.right&&(n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=0:n.y>this.bounds.bottom&&(t=3)),t},retrieve:function(n){var t=this.objects;return n.body.quadTreeIndex=this.getIndex(n.body),this.nodes[0]&&(n.body.quadTreeIndex!==-1?t=t.concat(this.nodes[n.body.quadTreeIndex].retrieve(n)):(t=t.concat(this.nodes[0].retrieve(n)),t=t.concat(this.nodes[1].retrieve(n)),t=t.concat(this.nodes[2].retrieve(n)),t=t.concat(this.nodes[3].retrieve(n)))),t},clear:function(){this.objects=[];for(var n=0,t=this.nodes.length;n<t;n++)this.nodes[n]&&(this.nodes[n].clear(),delete this.nodes[n])}},n.QuadTree.prototype.constructor=n.QuadTree,n.Circle=function(n,t,i){n=n||0;t=t||0;i=i||0;this.x=n;this.y=t;this._diameter=i;this._radius=i>0?i*.5:0},n.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},setTo:function(n,t,i){return this.x=n,this.y=t,this._diameter=i,this._radius=i*.5,this},copyFrom:function(n){return this.setTo(n.x,n.y,n.diameter)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.diameter=this._diameter,n},distance:function(t,i){return typeof i=="undefined"&&(i=!1),i?n.Math.distanceRound(this.x,this.y,t.x,t.y):n.Math.distance(this.x,this.y,t.x,t.y)},clone:function(t){return typeof t=="undefined"&&(t=new n.Circle),t.setTo(this.x,this.y,this.diameter)},contains:function(t,i){return n.Circle.contains(this,t,i)},circumferencePoint:function(t,i,r){return n.Circle.circumferencePoint(this,t,i,r)},offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},n.Circle.prototype.constructor=n.Circle,Object.defineProperty(n.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(n){n>0&&(this._diameter=n,this._radius=n*.5)}}),Object.defineProperty(n.Circle.prototype,"radius",{get:function(){return this._radius},set:function(n){n>0&&(this._radius=n,this._diameter=n*2)}}),Object.defineProperty(n.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(n){n>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-n}}),Object.defineProperty(n.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(n){n<this.x?(this._radius=0,this._diameter=0):this.radius=n-this.x}}),Object.defineProperty(n.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(n){n>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-n}}),Object.defineProperty(n.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(n){n<this.y?(this._radius=0,this._diameter=0):this.radius=n-this.y}}),Object.defineProperty(n.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(n.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(n){n===!0&&this.setTo(0,0,0)}}),n.Circle.contains=function(n,t,i){if(t>=n.left&&t<=n.right&&i>=n.top&&i<=n.bottom){var r=(n.x-t)*(n.x-t),u=(n.y-i)*(n.y-i);return r+u<=n.radius*n.radius}return!1},n.Circle.equals=function(n,t){return n.x==t.x&&n.y==t.y&&n.diameter==t.diameter},n.Circle.intersects=function(t,i){return n.Math.distance(t.x,t.y,i.x,i.y)<=t.radius+i.radius},n.Circle.circumferencePoint=function(t,i,r,u){return typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=new n.Point),r===!0&&(i=n.Math.radToDeg(i)),u.x=t.x+t.radius*Math.cos(i),u.y=t.y+t.radius*Math.sin(i),u},n.Circle.intersectsRectangle=function(n,t){var r=Math.abs(n.x-t.x-t.halfWidth),o=t.halfWidth+n.radius,i,u;if(r>o||(i=Math.abs(n.y-t.y-t.halfHeight),u=t.halfHeight+n.radius,i>u))return!1;if(r<=t.halfWidth||i<=t.halfHeight)return!0;var f=r-t.halfWidth,e=i-t.halfHeight,s=f*f,h=e*e,c=n.radius*n.radius;return s+h<=c},n.Point=function(n,t){n=n||0;t=t||0;this.x=n;this.y=t},n.Point.prototype={copyFrom:function(n){return this.setTo(n.x,n.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(n,t){return this.x=n,this.y=t,this},add:function(n,t){return this.x+=n,this.y+=t,this},subtract:function(n,t){return this.x-=n,this.y-=t,this},multiply:function(n,t){return this.x*=n,this.y*=t,this},divide:function(n,t){return this.x/=n,this.y/=t,this},clampX:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this},clampY:function(t,i){return this.y=n.Math.clamp(this.y,t,i),this},clamp:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this.y=n.Math.clamp(this.y,t,i),this},clone:function(t){return typeof t=="undefined"&&(t=new n.Point),t.setTo(this.x,this.y)},copyTo:function(n){return n.x=this.x,n.y=this.y,n},distance:function(t,i){return n.Point.distance(this,t,i)},equals:function(n){return n.x==this.x&&n.y==this.y},rotate:function(t,i,r,u,f){return n.Point.rotate(this,t,i,r,u,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setMagnitude:function(n){return this.normalize().multiply(n,n)},normalize:function(){if(!this.isZero()){var n=this.getMagnitude();this.x/=n;this.y/=n}return this},isZero:function(){return this.x===0&&this.y===0},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},n.Point.prototype.constructor=n.Point,n.Point.add=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x+i.x,r.y=t.y+i.y,r},n.Point.subtract=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x-i.x,r.y=t.y-i.y,r},n.Point.multiply=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x*i.x,r.y=t.y*i.y,r},n.Point.divide=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x/i.x,r.y=t.y/i.y,r},n.Point.equals=function(n,t){return n.x==t.x&&n.y==t.y},n.Point.distance=function(t,i,r){return typeof r=="undefined"&&(r=!1),r?n.Math.distanceRound(t.x,t.y,i.x,i.y):n.Math.distance(t.x,t.y,i.x,i.y)},n.Point.rotate=function(t,i,r,u,f,e){return f=f||!1,e=e||null,f&&(u=n.Math.degToRad(u)),e===null&&(e=Math.sqrt((i-t.x)*(i-t.x)+(r-t.y)*(r-t.y))),t.setTo(i+e*Math.cos(u),r+e*Math.sin(u))},n.Rectangle=function(n,t,i,r){n=n||0;t=t||0;i=i||0;r=r||0;this.x=n;this.y=t;this.width=i;this.height=r},n.Rectangle.prototype={offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},inflate:function(t,i){return n.Rectangle.inflate(this,t,i)},size:function(t){return n.Rectangle.size(this,t)},clone:function(t){return n.Rectangle.clone(this,t)},contains:function(t,i){return n.Rectangle.contains(this,t,i)},containsRect:function(t){return n.Rectangle.containsRect(this,t)},equals:function(t){return n.Rectangle.equals(this,t)},intersection:function(t,i){return n.Rectangle.intersection(this,t,i)},intersects:function(t,i){return n.Rectangle.intersects(this,t,i)},intersectsRaw:function(t,i,r,u,f){return n.Rectangle.intersectsRaw(this,t,i,r,u,f)},union:function(t,i){return n.Rectangle.union(this,t,i)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},n.Rectangle.prototype.constructor=n.Rectangle,Object.defineProperty(n.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(n.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(n.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<=this.y?0:this.y-n}}),Object.defineProperty(n.Rectangle.prototype,"bottomRight",{get:function(){return new n.Point(this.right,this.bottom)},set:function(n){this.right=n.x;this.bottom=n.y}}),Object.defineProperty(n.Rectangle.prototype,"left",{get:function(){return this.x},set:function(n){this.width=n>=this.right?0:this.right-n;this.x=n}}),Object.defineProperty(n.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<=this.x?0:this.x+n}}),Object.defineProperty(n.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(n.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}}),Object.defineProperty(n.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(n){this.x=n-this.halfWidth}}),Object.defineProperty(n.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(n){this.y=n-this.halfHeight}}),Object.defineProperty(n.Rectangle.prototype,"top",{get:function(){return this.y},set:function(n){n>=this.bottom?(this.height=0,this.y=n):this.height=this.bottom-n}}),Object.defineProperty(n.Rectangle.prototype,"topLeft",{get:function(){return new n.Point(this.x,this.y)},set:function(n){this.x=n.x;this.y=n.y}}),Object.defineProperty(n.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(n){n===!0&&this.setTo(0,0,0,0)}}),n.Rectangle.inflate=function(n,t,i){return n.x-=t,n.width+=2*t,n.y-=i,n.height+=2*i,n},n.Rectangle.inflatePoint=function(t,i){return n.Rectangle.inflate(t,i.x,i.y)},n.Rectangle.size=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(t.width,t.height)},n.Rectangle.clone=function(t,i){return typeof i=="undefined"&&(i=new n.Rectangle),i.setTo(t.x,t.y,t.width,t.height)},n.Rectangle.contains=function(n,t,i){return t>=n.x&&t<=n.right&&i>=n.y&&i<=n.bottom},n.Rectangle.containsRaw=function(n,t,i,r,u,f){return u>=n&&u<=n+i&&f>=t&&f<=t+r},n.Rectangle.containsPoint=function(t,i){return n.Rectangle.contains(t,i.x,i.y)},n.Rectangle.containsRect=function(n,t){return n.volume>t.volume?!1:n.x>=t.x&&n.y>=t.y&&n.right<=t.right&&n.bottom<=t.bottom},n.Rectangle.equals=function(n,t){return n.x==t.x&&n.y==t.y&&n.width==t.width&&n.height==t.height},n.Rectangle.intersection=function(t,i,r){return r=r||new n.Rectangle,n.Rectangle.intersects(t,i)&&(r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r.width=Math.min(t.right,i.right)-r.x,r.height=Math.min(t.bottom,i.bottom)-r.y),r},n.Rectangle.intersects=function(n,t){return n.width<=0||n.height<=0||t.width<=0||t.height<=0?!1:!(n.right<t.x||n.bottom<t.y||n.x>t.right||n.y>t.bottom)},n.Rectangle.intersectsRaw=function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=0),!(t>n.right+f||i<n.left-f||r>n.bottom+f||u<n.top-f)},n.Rectangle.union=function(t,i,r){return typeof r=="undefined"&&(r=new n.Rectangle),r.setTo(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.max(t.right,i.right)-Math.min(t.left,i.left),Math.max(t.bottom,i.bottom)-Math.min(t.top,i.top))},n.Polygon=function(i){t.Polygon.call(this,i);this.type=n.POLYGON},n.Polygon.prototype=Object.create(t.Polygon.prototype),n.Polygon.prototype.constructor=n.Polygon,n.Line=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.start=new n.Point(t,i);this.end=new n.Point(r,u)},n.Line.prototype={setTo:function(n,t,i,r){return this.start.setTo(n,t),this.end.setTo(i,r),this},fromSprite:function(n,t,i){return typeof i=="undefined"&&(i=!0),i?this.setTo(n.center.x,n.center.y,t.center.x,t.center.y):this.setTo(n.x,n.y,t.x,t.y)},intersects:function(t,i,r){return n.Line.intersectsPoints(this.start,this.end,t.start,t.end,i,r)},pointOnLine:function(n,t){return(n-this.start.x)*(this.end.y-this.end.y)==(this.end.x-this.start.x)*(t-this.end.y)},pointOnSegment:function(n,t){var i=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),u=Math.min(this.start.y,this.end.y),f=Math.max(this.start.y,this.end.y);return this.pointOnLine(n,t)&&n>=i&&n<=r&&t>=u&&t<=f}},Object.defineProperty(n.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(n.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.x-this.start.x,this.end.y-this.start.y)}}),Object.defineProperty(n.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(n.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),n.Line.intersectsPoints=function(t,i,r,u,f,e){typeof f=="undefined"&&(f=!0);typeof e=="undefined"&&(e=new n.Point);var s=i.y-t.y,h=u.y-r.y,c=t.x-i.x,l=r.x-u.x,a=i.x*t.y-t.x*i.y,v=u.x*r.y-r.x*u.y,o=s*l-h*c;return o===0?null:(e.x=(c*v-l*a)/o,e.y=(h*a-s*v)/o,f&&(Math.pow(e.x-i.x+(e.y-i.y),2)>Math.pow(t.x-i.x+(t.y-i.y),2)||Math.pow(e.x-t.x+(e.y-t.y),2)>Math.pow(t.x-i.x+(t.y-i.y),2)||Math.pow(e.x-u.x+(e.y-u.y),2)>Math.pow(r.x-u.x+(r.y-u.y),2)||Math.pow(e.x-r.x+(e.y-r.y),2)>Math.pow(r.x-u.x+(r.y-u.y),2)))?null:e},n.Line.intersects=function(t,i,r,u){return n.Line.intersectsPoints(t.start,t.end,i.start,i.end,r,u)},n.Net=function(n){this.game=n},n.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(n){return window.location.hostname.indexOf(n)!==-1},updateQueryString:function(n,t,i,r){var u,f,o,e;if(typeof i=="undefined"&&(i=!1),(typeof r=="undefined"||r==="")&&(r=window.location.href),u="",f=new RegExp("([?|&])"+n+"=.*?(&|#|$)(.*)","gi"),f.test(r)?u=typeof t!="undefined"&&t!==null?r.replace(f,"$1"+n+"="+t+"$2$3"):r.replace(f,"$1$3").replace(/(&|\?)$/,""):typeof t!="undefined"&&t!==null?(o=r.indexOf("?")!==-1?"&":"?",e=r.split("#"),r=e[0]+o+n+"="+t,e[1]&&(r+="#"+e[1]),u=r):u=r,i)window.location.href=u;else return u},getQueryString:function(n){var i,r,u,t;typeof n=="undefined"&&(n="");i={};r=location.search.substring(1).split("&");for(u in r)if(t=r[u].split("="),t.length>1){if(n&&n==this.decodeURI(t[0]))return this.decodeURI(t[1]);i[this.decodeURI(t[0])]=this.decodeURI(t[1])}return i},decodeURI:function(n){return decodeURIComponent(n.replace(/\+/g," "))}},n.Net.prototype.constructor=n.Net,n.TweenManager=function(n){this.game=n;this._tweens=[];this._add=[];this.game.onPause.add(this.pauseAll,this);this.game.onResume.add(this.resumeAll,this)},n.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var n=0;n<this._tweens.length;n++)this._tweens[n].pendingDelete=!0;this._add=[]},add:function(n){this._add.push(n)},create:function(t){return new n.Tween(t,this.game)},remove:function(n){var t=this._tweens.indexOf(n);t!==-1&&(this._tweens[t].pendingDelete=!0)},update:function(){if(this._tweens.length===0&&this._add.length===0)return!1;for(var n=0,t=this._tweens.length;n<t;)this._tweens[n].update(this.game.time.now)?n++:(this._tweens.splice(n,1),t--);return this._add.length>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(n){return this._tweens.some(function(t){return t._object===n})},pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].pause()},resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].resume()}},n.TweenManager.prototype.constructor=n.TweenManager,n.Tween=function(t,i){this._object=t;this.game=i;this._manager=this.game.tweens;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1e3;this._repeat=0;this._yoyo=!1;this._reversed=!1;this._delayTime=0;this._startTime=null;this._easingFunction=n.Easing.Linear.None;this._interpolationFunction=n.Math.linearInterpolation;this._chainedTweens=[];this._onStartCallbackFired=!1;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this.pendingDelete=!1;for(var r in t)this._valuesStart[r]=parseFloat(t[r],10);this.onStart=new n.Signal;this.onLoop=new n.Signal;this.onComplete=new n.Signal;this.isRunning=!1},n.Tween.prototype={to:function(n,t,i,r,u,f,e){t=t||1e3;i=i||null;r=r||!1;u=u||0;f=f||0;e=e||!1;var o;return this._parent?(o=this._manager.create(this._object),this._lastChild.chain(o),this._lastChild=o):(o=this,this._parent=this,this._lastChild=this),o._repeat=f,o._duration=t,o._valuesEnd=n,i!==null&&(o._easingFunction=i),u>0&&(o._delayTime=u),o._yoyo=e,r?this.start():this},start:function(){if(this.game!==null&&this._object!==null){this._manager.add(this);this.isRunning=!0;this._onStartCallbackFired=!1;this._startTime=this.game.time.now+this._delayTime;for(var n in this._valuesEnd){if(this._valuesEnd[n]instanceof Array){if(this._valuesEnd[n].length===0)continue;this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}this._valuesStart[n]=this._object[n];this._valuesStart[n]instanceof Array==!1&&(this._valuesStart[n]*=1);this._valuesStartRepeat[n]=this._valuesStart[n]||0}return this}},stop:function(){return this.isRunning=!1,this._onUpdateCallback=null,this._manager.remove(this),this},delay:function(n){return this._delayTime=n,this},repeat:function(n){return this._repeat=n,this},yoyo:function(n){return this._yoyo=n,this},easing:function(n){return this._easingFunction=n,this},interpolation:function(n){return this._interpolationFunction=n,this},chain:function(){return this._chainedTweens=arguments,this},loop:function(){return this._lastChild.chain(this),this},onUpdateCallback:function(n,t){return this._onUpdateCallback=n,this._onUpdateCallbackContext=t,this},pause:function(){this._paused=!0;this._pausedTime=this.game.time.now},resume:function(){this._paused=!1;this._startTime+=this.game.time.now-this._pausedTime},update:function(n){var t,r,u,f,i,o,e,s;if(this.pendingDelete)return!1;if(this._paused||n<this._startTime||n<this._startTime)return!0;this._onStartCallbackFired===!1&&(this.onStart.dispatch(this._object),this._onStartCallbackFired=!0);r=(n-this._startTime)/this._duration;r=r>1?1:r;u=this._easingFunction(r);for(t in this._valuesEnd)f=this._valuesStart[t]||0,i=this._valuesEnd[t],i instanceof Array?this._object[t]=this._interpolationFunction(i,u):(typeof i=="string"&&(i=f+parseFloat(i,10)),typeof i=="number"&&(this._object[t]=f+(i-f)*u));if(this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,u),r==1){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat)typeof this._valuesEnd[t]=="string"&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t],10)),this._yoyo&&(o=this._valuesStartRepeat[t],this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o,this._reversed=!this._reversed),this._valuesStart[t]=this._valuesStartRepeat[t];return this._startTime=n+this._delayTime,this.onLoop.dispatch(this._object),!0}for(this.isRunning=!1,this.onComplete.dispatch(this._object),e=0,s=this._chainedTweens.length;e<s;e++)this._chainedTweens[e].start(n);return!1}return!0}},n.Tween.prototype.constructor=n.Tween,n.Easing={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},Out:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},InOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(t){return t<.5?n.Easing.Bounce.In(t*2)*.5:n.Easing.Bounce.Out(t*2-1)*.5+.5}}},n.Time=function(t){this.game=t;this.time=0;this.now=0;this.elapsed=0;this.pausedTime=0;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.physicsElapsed=0;this.frames=0;this.pauseDuration=0;this.timeToCall=0;this.lastTime=0;this.events=new n.Timer(this.game,!1);this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=!1;this._timers=[];this._len=0;this._i=0;this.game.onPause.add(this.gamePaused,this);this.game.onResume.add(this.gameResumed,this)},n.Time.prototype={boot:function(){this.events.start()},create:function(t){typeof t=="undefined"&&(t=!0);var i=new n.Timer(this.game,t);return this._timers.push(i),i},removeAll:function(){for(var n=0;n<this._timers.length;n++)this._timers[n].destroy();this._timers=[]},update:function(n){if(this.now=n,this._justResumed){this.time=this.now;this._justResumed=!1;this.events.resume();for(var t=0;t<this._timers.length;t++)this._timers[t].resume()}if(this.timeToCall=this.game.math.max(0,16-(n-this.lastTime)),this.elapsed=this.now-this.time,this.msMin=this.game.math.min(this.msMin,this.elapsed),this.msMax=this.game.math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond)),this.fpsMin=this.game.math.min(this.fpsMin,this.fps),this.fpsMax=this.game.math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0),this.time=this.now,this.lastTime=n+this.timeToCall,this.physicsElapsed=this.elapsed/1e3,this.physicsElapsed>.05&&(this.physicsElapsed=.05),this.game.paused)this.pausedTime=this.now-this._pauseStarted;else for(this.events.update(this.now),this._i=0,this._len=this._timers.length;this._i<this._len;)this._timers[this._i].update(this.now)?this._i++:(this._timers.splice(this._i,1),this._len--)},gamePaused:function(){this._pauseStarted=this.now;this.events.pause();for(var n=0;n<this._timers.length;n++)this._timers[n].pause()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.pausedTime;this._justResumed=!0},totalElapsedSeconds:function(){return(this.now-this._started)*.001},elapsedSince:function(n){return this.now-n},elapsedSecondsSince:function(n){return(this.now-n)*.001},reset:function(){this._started=this.now}},n.Time.prototype.constructor=n.Time,n.Timer=function(t,i){typeof i=="undefined"&&(i=!0);this.game=t;this.running=!1;this.autoDestroy=i;this.expired=!1;this.events=[];this.onComplete=new n.Signal;this.nextTick=0;this.paused=!1;this._started=0;this._pauseStarted=0;this._now=0;this._len=0;this._i=0},n.Timer.MINUTE=6e4,n.Timer.SECOND=1e3,n.Timer.HALF=500,n.Timer.QUARTER=250,n.Timer.prototype={create:function(t,i,r,u,f,e){var s=t,o;return this.running&&(s+=this._now),o=new n.TimerEvent(this,t,s,r,i,u,f,e),this.events.push(o),this.order(),this.expired=!1,o},add:function(n,t,i){return this.create(n,!1,0,t,i,Array.prototype.splice.call(arguments,3))},repeat:function(n,t,i,r){return this.create(n,!1,t,i,r,Array.prototype.splice.call(arguments,4))},loop:function(n,t,i){return this.create(n,!0,0,t,i,Array.prototype.splice.call(arguments,3))},start:function(){this._started=this.game.time.now;this.running=!0},stop:function(){this.running=!1;this.events.length=0},remove:function(n){for(var t=0;t<this.events.length;t++)if(this.events[t]===n)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(n,t){return n.tick<t.tick?-1:n.tick>t.tick?1:0},update:function(n){if(this.paused)return!0;for(this._now=n-this._started,this._len=this.events.length,this._i=0;this._i<this._len;)this.events[this._i].pendingDelete&&(this.events.splice(this._i,1),this._len--),this._i++;if(this._len=this.events.length,this.running&&this._now>=this.nextTick&&this._len>0){for(this._i=0;this._i<this._len;)if(this._now>=this.events[this._i].tick)this.events[this._i].loop===!0?(this.events[this._i].tick+=this.events[this._i].delay-(this._now-this.events[this._i].tick),this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick+=this.events[this._i].delay-(this._now-this.events[this._i].tick),this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args),this.events.splice(this._i,1),this._len--),this._i++;else break;this.events.length>0?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&!this.expired&&(this._pauseStarted=this.game.time.now,this.paused=!0)},resume:function(){var t,n;if(this.running&&!this.expired){for(t=this.game.time.now-this._pauseStarted,n=0;n<this.events.length;n++)this.events[n].tick+=t;this.nextTick+=t;this.paused=!1}},destroy:function(){this.onComplete.removeAll();this.running=!1;this.events=[];this._i=this._len}},Object.defineProperty(n.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(n.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(n.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(n.Timer.prototype,"ms",{get:function(){return this._now}}),Object.defineProperty(n.Timer.prototype,"seconds",{get:function(){return this._now*.001}}),n.Timer.prototype.constructor=n.Timer,n.TimerEvent=function(n,t,i,r,u,f,e,o){this.timer=n;this.delay=t;this.tick=i;this.repeatCount=r-1;this.loop=u;this.callback=f;this.callbackContext=e;this.args=o;this.pendingDelete=!1},n.TimerEvent.prototype.constructor=n.TimerEvent,n.AnimationManager=function(n){this.sprite=n;this.game=n.game;this.currentFrame=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]},n.AnimationManager.prototype={loadFrameData:function(n){this._frameData=n;this.frame=0;this.isLoaded=!0},add:function(i,r,u,f,e){if(this._frameData==null){console.warn("No FrameData available for Phaser.Animation "+i);return}return u=u||60,typeof f=="undefined"&&(f=!1),typeof e=="undefined"&&(e=r&&typeof r[0]=="number"?!0:!1),this.sprite.events.onAnimationStart==null&&(this.sprite.events.onAnimationStart=new n.Signal,this.sprite.events.onAnimationComplete=new n.Signal,this.sprite.events.onAnimationLoop=new n.Signal),this._outputFrames.length=0,this._frameData.getFrameIndexes(r,e,this._outputFrames),this._anims[i]=new n.Animation(this.game,this.sprite,i,this._frameData,this._outputFrames,u,f),this.currentAnim=this._anims[i],this.currentFrame=this.currentAnim.currentFrame,this.sprite.setTexture(t.TextureCache[this.currentFrame.uuid]),this._anims[i]},validateFrames:function(n,t){typeof t=="undefined"&&(t=!0);for(var i=0;i<n.length;i++)if(t===!0){if(n[i]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(n[i])===!1)return!1;return!0},play:function(n,t,i,r){if(this._anims[n])if(this.currentAnim==this._anims[n]){if(this.currentAnim.isPlaying===!1)return this.currentAnim.paused=!1,this.currentAnim.play(t,i,r)}else return this.currentAnim=this._anims[n],this.currentAnim.paused=!1,this.currentAnim.play(t,i,r)},stop:function(n,t){typeof t=="undefined"&&(t=!1);typeof n=="string"?this._anims[n]&&(this.currentAnim=this._anims[n],this.currentAnim.stop(t)):this.currentAnim&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&this.sprite.visible===!1?!1:this.currentAnim&&this.currentAnim.update()===!0?(this.currentFrame=this.currentAnim.currentFrame,this.sprite.currentFrame=this.currentFrame,!0):!1},getAnimation:function(n){return typeof n=="string"&&this._anims[n]?this._anims[n]:null},refreshFrame:function(){this.sprite.currentFrame=this.currentFrame;this.sprite.setTexture(t.TextureCache[this.currentFrame.uuid])},destroy:function(){this._anims={};this._frameData=null;this._frameIndex=0;this.currentAnim=null;this.currentFrame=null}},n.AnimationManager.prototype.constructor=n.AnimationManager,Object.defineProperty(n.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(n.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData?this._frameData.total:-1}}),Object.defineProperty(n.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(n){this.currentAnim.paused=n}}),Object.defineProperty(n.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this._frameIndex},set:function(n){typeof n=="number"&&this._frameData&&this._frameData.getFrame(n)!==null&&(this.currentFrame=this._frameData.getFrame(n),this._frameIndex=n,this.sprite.currentFrame=this.currentFrame,this.sprite.setTexture(t.TextureCache[this.currentFrame.uuid]))}}),Object.defineProperty(n.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(n){typeof n=="string"&&this._frameData&&this._frameData.getFrameByName(n)!==null?(this.currentFrame=this._frameData.getFrameByName(n),this._frameIndex=this.currentFrame.index,this.sprite.currentFrame=this.currentFrame,this.sprite.setTexture(t.TextureCache[this.currentFrame.uuid])):console.warn("Cannot set frameName: "+n)}}),n.Animation=function(n,t,i,r,u,f,e){this.game=n;this._parent=t;this._frameData=r;this.name=i;this._frames=[];this._frames=this._frames.concat(u);this.delay=1e3/f;this.looped=e;this.killOnComplete=!1;this.isFinished=!1;this.isPlaying=!1;this.isPaused=!1;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex])},n.Animation.prototype={play:function(n,i,r){return typeof n=="number"&&(this.delay=1e3/n),typeof i=="boolean"&&(this.looped=i),typeof r!="undefined"&&(this.killOnComplete=r),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setTexture(t.TextureCache[this.currentFrame.uuid]),this._parent.events&&this._parent.events.onAnimationStart.dispatch(this._parent,this),this},restart:function(){this.isPlaying=!0;this.isFinished=!1;this.paused=!1;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex])},stop:function(n){typeof n=="undefined"&&(n=!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;n&&(this.currentFrame=this._frameData.getFrame(this._frames[0]))},update:function(){return this.isPaused?!1:this.isPlaying===!0&&this.game.time.now>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.now-this._timeNextFrame,this._timeLastFrame=this.game.time.now,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.looped?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setTexture(t.TextureCache[this.currentFrame.uuid]),this._parent.events.onAnimationLoop.dispatch(this._parent,this)):this.onComplete():(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setTexture(t.TextureCache[this.currentFrame.uuid])),!0):!1},destroy:function(){this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=!1},onComplete:function(){this.isPlaying=!1;this.isFinished=!0;this.paused=!1;this._parent.events&&this._parent.events.onAnimationComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}},n.Animation.prototype.constructor=n.Animation,Object.defineProperty(n.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(n){this.isPaused=n;n?this._pauseStartTime=this.game.time.now:this.isPlaying&&(this._timeNextFrame=this.game.time.now+this.delay)}}),Object.defineProperty(n.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(n.Animation.prototype,"frame",{get:function(){return this.currentFrame!==null?this.currentFrame.index:this._frameIndex},set:function(n){this.currentFrame=this._frameData.getFrame(n);this.currentFrame!==null&&(this._frameIndex=n,this._parent.setTexture(t.TextureCache[this.currentFrame.uuid]))}}),n.Animation.generateFrameNames=function(t,i,r,u,f){var s,o,e;if(typeof u=="undefined"&&(u=""),s=[],o="",i<r)for(e=i;e<=r;e++)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);else for(e=i;e>=r;e--)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);return s},n.Frame=function(t,i,r,u,f,e,o){this.index=t;this.x=i;this.y=r;this.width=u;this.height=f;this.name=e;this.uuid=o;this.centerX=Math.floor(u/2);this.centerY=Math.floor(f/2);this.distance=n.Math.distance(0,0,u,f);this.rotated=!1;this.rotationDirection="cw";this.trimmed=!1;this.sourceSizeW=u;this.sourceSizeH=f;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0},n.Frame.prototype={setTrim:function(n,t,i,r,u,f,e){this.trimmed=n;n&&(this.width=t,this.height=i,this.sourceSizeW=t,this.sourceSizeH=i,this.centerX=Math.floor(t/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=u,this.spriteSourceSizeW=f,this.spriteSourceSizeH=e)}},n.Frame.prototype.constructor=n.Frame,n.FrameData=function(){this._frames=[];this._frameNames=[]},n.FrameData.prototype={addFrame:function(n){return n.index=this._frames.length,this._frames.push(n),n.name!==""&&(this._frameNames[n.name]=n.index),n},getFrame:function(n){return this._frames.length>n?this._frames[n]:null},getFrameByName:function(n){return typeof this._frameNames[n]=="number"?this._frames[this._frameNames[n]]:null},checkFrameName:function(n){return this._frameNames[n]==null?!1:!0},getFrameRange:function(n,t,i){typeof i=="undefined"&&(i=[]);for(var r=n;r<=t;r++)i.push(this._frames[r]);return i},getFrames:function(n,t,i){var r,u;if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=[]),typeof n=="undefined"||n.length===0)for(r=0;r<this._frames.length;r++)i.push(this._frames[r]);else for(r=0,u=n.length;r<u;r++)t?i.push(this.getFrame(n[r])):i.push(this.getFrameByName(n[r]));return i},getFrameIndexes:function(n,t,i){var r,u;if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=[]),typeof n=="undefined"||n.length===0)for(r=0,u=this._frames.length;r<u;r++)i.push(this._frames[r].index);else for(r=0,u=n.length;r<u;r++)t?i.push(n[r]):this.getFrameByName(n[r])&&i.push(this.getFrameByName(n[r]).index);return i}},n.FrameData.prototype.constructor=n.FrameData,Object.defineProperty(n.FrameData.prototype,"total",{get:function(){return this._frames.length}}),n.AnimationParser={spriteSheet:function(i,r,u,f,e,o,s){var v=i.cache.getImage(r),h,c,a,w;if(v==null)return null;h=v.width;c=v.height;u<=0&&(u=Math.floor(-h/Math.min(-1,u)));f<=0&&(f=Math.floor(-c/Math.min(-1,f)));var k=Math.round(h/u),d=Math.round(c/f),y=k*d;if(e!==-1&&(y=e),h===0||c===0||h<u||c<f||y===0)return console.warn("Phaser.AnimationParser.spriteSheet: width/height zero or width/height < given frameWidth/frameHeight"),null;var b=new n.FrameData,l=o,p=o;for(a=0;a<y;a++)w=i.rnd.uuid(),b.addFrame(new n.Frame(a,l,p,u,f,"",w)),t.TextureCache[w]=new t.Texture(t.BaseTextureCache[r],{x:l,y:p,width:u,height:f}),l+=u+s,l===h&&(l=o,p+=f+s);return b},JSONData:function(i,r,u){var s,e,h,f,o;if(!r.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(r);return}for(s=new n.FrameData,e=r.frames,f=0;f<e.length;f++)o=i.rnd.uuid(),h=s.addFrame(new n.Frame(f,e[f].frame.x,e[f].frame.y,e[f].frame.w,e[f].frame.h,e[f].filename,o)),t.TextureCache[o]=new t.Texture(t.BaseTextureCache[u],{x:e[f].frame.x,y:e[f].frame.y,width:e[f].frame.w,height:e[f].frame.h}),e[f].trimmed&&(h.setTrim(e[f].trimmed,e[f].sourceSize.w,e[f].sourceSize.h,e[f].spriteSourceSize.x,e[f].spriteSourceSize.y,e[f].spriteSourceSize.w,e[f].spriteSourceSize.h),t.TextureCache[o].trimmed=!0,t.TextureCache[o].trim.x=e[f].spriteSourceSize.x,t.TextureCache[o].trim.y=e[f].spriteSourceSize.y);return s},JSONDataHash:function(i,r,u){var f,o;if(!r.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(r);return}var s=new n.FrameData,e=r.frames,h,c=0;for(f in e)o=i.rnd.uuid(),h=s.addFrame(new n.Frame(c,e[f].frame.x,e[f].frame.y,e[f].frame.w,e[f].frame.h,f,o)),t.TextureCache[o]=new t.Texture(t.BaseTextureCache[u],{x:e[f].frame.x,y:e[f].frame.y,width:e[f].frame.w,height:e[f].frame.h}),e[f].trimmed&&(h.setTrim(e[f].trimmed,e[f].sourceSize.w,e[f].sourceSize.h,e[f].spriteSourceSize.x,e[f].spriteSourceSize.y,e[f].spriteSourceSize.w,e[f].spriteSourceSize.h),t.TextureCache[o].trimmed=!0,t.TextureCache[o].trim.x=e[f].spriteSourceSize.x,t.TextureCache[o].trim.y=e[f].spriteSourceSize.y),c++;return s},XMLData:function(i,r,u){var a,v,k,e,d,f,y,p,c,l,o,s,w,b,h;if(!r.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}for(a=new n.FrameData,v=r.getElementsByTagName("SubTexture"),h=0;h<v.length;h++)e=i.rnd.uuid(),f=v[h].attributes,d=f.name.nodeValue,y=parseInt(f.x.nodeValue,10),p=parseInt(f.y.nodeValue,10),c=parseInt(f.width.nodeValue,10),l=parseInt(f.height.nodeValue,10),o=null,s=null,f.frameX&&(o=Math.abs(parseInt(f.frameX.nodeValue,10)),s=Math.abs(parseInt(f.frameY.nodeValue,10)),w=parseInt(f.frameWidth.nodeValue,10),b=parseInt(f.frameHeight.nodeValue,10)),k=a.addFrame(new n.Frame(h,y,p,c,l,d,e)),t.TextureCache[e]=new t.Texture(t.BaseTextureCache[u],{x:y,y:p,width:c,height:l}),(o!==null||s!==null)&&(k.setTrim(!0,c,l,o,s,w,b),t.TextureCache[e].realSize={x:o,y:s,w:w,h:b},t.TextureCache[e].trimmed=!0,t.TextureCache[e].trim.x=o,t.TextureCache[e].trim.y=s);return a}},n.Cache=function(t){this.game=t;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._tilemaps={};this._binary={};this._bitmapDatas={};this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new n.Signal},n.Cache.prototype={addCanvas:function(n,t,i){this._canvases[n]={canvas:t,context:i}},addBinary:function(n,t){this._binary[n]=t},addBitmapData:function(n,t){return this._bitmapDatas[n]=t,t},addRenderTexture:function(t,i){var r=new n.Frame(0,0,0,i.width,i.height,"","");this._textures[t]={texture:i,frame:r}},addSpriteSheet:function(i,r,u,f,e,o,s,h){this._images[i]={url:r,data:u,spriteSheet:!0,frameWidth:f,frameHeight:e,margin:s,spacing:h};t.BaseTextureCache[i]=new t.BaseTexture(u);t.TextureCache[i]=new t.Texture(t.BaseTextureCache[i]);this._images[i].frameData=n.AnimationParser.spriteSheet(this.game,i,f,e,o,s,h)},addTilemap:function(n,t,i,r){this._tilemaps[n]={url:t,data:i,format:r}},addTextureAtlas:function(i,r,u,f,e){this._images[i]={url:r,data:u,spriteSheet:!0};t.BaseTextureCache[i]=new t.BaseTexture(u);t.TextureCache[i]=new t.Texture(t.BaseTextureCache[i]);e==n.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[i].frameData=n.AnimationParser.JSONData(this.game,f,i):e==n.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[i].frameData=n.AnimationParser.JSONDataHash(this.game,f,i):e==n.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[i].frameData=n.AnimationParser.XMLData(this.game,f,i))},addBitmapFont:function(i,r,u,f){this._images[i]={url:r,data:u,spriteSheet:!0};t.BaseTextureCache[i]=new t.BaseTexture(u);t.TextureCache[i]=new t.Texture(t.BaseTextureCache[i]);n.LoaderParser.bitmapFont(this.game,f,i)},addDefaultImage:function(){var i=new Image;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:i,spriteSheet:!1};this._images.__default.frame=new n.Frame(0,0,0,32,32,"","");t.BaseTextureCache.__default=new t.BaseTexture(i);t.TextureCache.__default=new t.Texture(t.BaseTextureCache.__default)},addMissingImage:function(){var i=new Image;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:i,spriteSheet:!1};this._images.__missing.frame=new n.Frame(0,0,0,32,32,"","");t.BaseTextureCache.__missing=new t.BaseTexture(i);t.TextureCache.__missing=new t.Texture(t.BaseTextureCache.__missing)},addText:function(n,t,i){this._text[n]={url:t,data:i}},addImage:function(i,r,u){this._images[i]={url:r,data:u,spriteSheet:!1};this._images[i].frame=new n.Frame(0,0,0,u.width,u.height,i,this.game.rnd.uuid());t.BaseTextureCache[i]=new t.BaseTexture(u);t.TextureCache[i]=new t.Texture(t.BaseTextureCache[i])},addSound:function(n,t,i,r,u){r=r||!0;u=u||!1;var f=!1;u&&(f=!0);this._sounds[n]={url:t,data:i,isDecoding:!1,decoded:f,webAudio:r,audioTag:u,locked:this.game.sound.touchLocked}},reloadSound:function(n){var t=this;this._sounds[n]&&(this._sounds[n].data.src=this._sounds[n].url,this._sounds[n].data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(n)},!1),this._sounds[n].data.load())},reloadSoundComplete:function(n){this._sounds[n]&&(this._sounds[n].locked=!1,this.onSoundUnlock.dispatch(n))},updateSound:function(n,t,i){this._sounds[n]&&(this._sounds[n][t]=i)},decodedSound:function(n,t){this._sounds[n].data=t;this._sounds[n].decoded=!0;this._sounds[n].isDecoding=!1},getCanvas:function(n){if(this._canvases[n])return this._canvases[n].canvas;console.warn('Phaser.Cache.getCanvas: Invalid key: "'+n+'"')},getBitmapData:function(n){if(this._bitmapDatas[n])return this._bitmapDatas[n];console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+n+'"')},checkImageKey:function(n){return this._images[n]?!0:!1},getImage:function(n){if(this._images[n])return this._images[n].data;console.warn('Phaser.Cache.getImage: Invalid key: "'+n+'"')},getTilemapData:function(n){if(this._tilemaps[n])return this._tilemaps[n];console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+n+'"')},getFrameData:function(n){return this._images[n]&&this._images[n].frameData?this._images[n].frameData:null},getFrameByIndex:function(n,t){return this._images[n]&&this._images[n].frameData?this._images[n].frameData.getFrame(t):null},getFrameByName:function(n,t){return this._images[n]&&this._images[n].frameData?this._images[n].frameData.getFrameByName(t):null},getFrame:function(n){return this._images[n]&&this._images[n].spriteSheet===!1?this._images[n].frame:null},getTextureFrame:function(n){return this._textures[n]?this._textures[n].frame:null},getTexture:function(n){if(this._textures[n])return this._textures[n];console.warn('Phaser.Cache.getTexture: Invalid key: "'+n+'"')},getSound:function(n){if(this._sounds[n])return this._sounds[n];console.warn('Phaser.Cache.getSound: Invalid key: "'+n+'"')},getSoundData:function(n){if(this._sounds[n])return this._sounds[n].data;console.warn('Phaser.Cache.getSoundData: Invalid key: "'+n+'"')},isSoundDecoded:function(n){if(this._sounds[n])return this._sounds[n].decoded},isSoundReady:function(n){return this._sounds[n]&&this._sounds[n].decoded&&this.game.sound.touchLocked===!1},isSpriteSheet:function(n){return this._images[n]?this._images[n].spriteSheet:!1},getText:function(n){if(this._text[n])return this._text[n].data;console.warn('Phaser.Cache.getText: Invalid key: "'+n+'"')},getBinary:function(n){if(this._binary[n])return this._binary[n];console.warn('Phaser.Cache.getBinary: Invalid key: "'+n+'"')},getKeys:function(n){var i=[];for(var t in n)t!=="__default"&&t!=="__missing"&&i.push(t);return i},getImageKeys:function(){return this.getKeys(this._images)},getSoundKeys:function(){return this.getKeys(this._sounds)},getTextKeys:function(){return this.getKeys(this._text)},removeCanvas:function(n){delete this._canvases[n]},removeImage:function(n){delete this._images[n]},removeSound:function(n){delete this._sounds[n]},removeText:function(n){delete this._text[n]},destroy:function(){for(var n in this._canvases)delete this._canvases[n.key];for(n in this._images)delete this._images[n.key];for(n in this._sounds)delete this._sounds[n.key];for(n in this._text)delete this._text[n.key]}},n.Cache.prototype.constructor=n.Cache,n.Loader=function(t){this.game=t;this._fileList=[];this._fileIndex=0;this._progressChunk=0;this._xhr=new XMLHttpRequest;this.isLoading=!1;this.hasLoaded=!1;this.progress=0;this.progressFloat=0;this.preloadSprite=null;this.crossOrigin="";this.baseURL="";this.onFileComplete=new n.Signal;this.onFileError=new n.Signal;this.onLoadStart=new n.Signal;this.onLoadComplete=new n.Signal},n.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,n.Loader.TEXTURE_ATLAS_JSON_HASH=1,n.Loader.TEXTURE_ATLAS_XML_STARLING=2,n.Loader.prototype={setPreloadSprite:function(t,i){i=i||0;this.preloadSprite={sprite:t,direction:i,width:t.width,height:t.height,crop:null};this.preloadSprite.crop=i===0?new n.Rectangle(0,0,1,t.height):new n.Rectangle(0,0,t.width,1);t.crop=this.preloadSprite.crop;t.cropEnabled=!0},checkKeyExists:function(n,t){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===n&&this._fileList[i].key===t)return!0;return!1},getAsset:function(n,t){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===n&&this._fileList[i].key===t)return{index:i,file:this._fileList[i]};return!1},reset:function(){this.preloadSprite=null;this.isLoading=!1;this._fileList.length=0;this._fileIndex=0},addToFileList:function(n,t,i,r){var f={type:n,key:t,url:i,data:null,error:!1,loaded:!1},u;if(typeof r!="undefined")for(u in r)f[u]=r[u];this.checkKeyExists(n,t)===!1&&this._fileList.push(f)},replaceInFileList:function(n,t,i,r){var f={type:n,key:t,url:i,data:null,error:!1,loaded:!1},u;if(typeof r!="undefined")for(u in r)f[u]=r[u];this.checkKeyExists(n,t)===!1&&this._fileList.push(f)},image:function(n,t,i){return typeof i=="undefined"&&(i=!1),i?this.replaceInFileList("image",n,t):this.addToFileList("image",n,t),this},text:function(n,t,i){return typeof i=="undefined"&&(i=!1),i?this.replaceInFileList("text",n,t):this.addToFileList("text",n,t),this},script:function(n,t){return this.addToFileList("script",n,t),this},binary:function(n,t,i,r){return typeof i=="undefined"&&(i=!1),i!==!1&&typeof r=="undefined"&&(r=i),this.addToFileList("binary",n,t,{callback:i,callbackContext:r}),this},spritesheet:function(n,t,i,r,u,f,e){return typeof u=="undefined"&&(u=-1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),this.addToFileList("spritesheet",n,t,{frameWidth:i,frameHeight:r,frameMax:u,margin:f,spacing:e}),this},audio:function(n,t,i){return typeof i=="undefined"&&(i=!0),this.addToFileList("audio",n,t,{buffer:null,autoDecode:i}),this},tilemap:function(t,i,r,u){if(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=n.Tilemap.CSV),i==null&&r==null)return console.warn("Phaser.Loader.tilemap - Both mapDataURL and mapData are null. One must be set."),this;if(r){switch(u){case n.Tilemap.TILED_JSON:typeof r=="string"&&(r=JSON.parse(r))}this.game.cache.addTilemap(t,null,r,u)}else this.addToFileList("tilemap",t,i,{format:u});return this},bitmapFont:function(n,t,i,r){var u,f;if(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),i)this.addToFileList("bitmapfont",n,t,{xmlURL:i});else if(typeof r=="string"){try{window.DOMParser?(f=new DOMParser,u=f.parseFromString(r,"text/xml")):(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(r))}catch(e){u=undefined}if(u&&u.documentElement&&!u.getElementsByTagName("parsererror").length)this.addToFileList("bitmapfont",n,t,{xmlURL:null,xmlData:u});else throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");}return this},atlasJSONArray:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,i,r,u,f){var e,o;if(typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=null),typeof f=="undefined"&&(f=n.Loader.TEXTURE_ATLAS_JSON_ARRAY),r)this.addToFileList("textureatlas",t,i,{atlasURL:r,format:f});else{switch(f){case n.Loader.TEXTURE_ATLAS_JSON_ARRAY:typeof u=="string"&&(u=JSON.parse(u));break;case n.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof u=="string"){try{window.DOMParser?(o=new DOMParser,e=o.parseFromString(u,"text/xml")):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(u))}catch(s){e=undefined}if(e&&e.documentElement&&!e.getElementsByTagName("parsererror").length)u=e;else throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");}}this.addToFileList("textureatlas",t,i,{atlasURL:null,atlasData:u,format:f})}return this},removeFile:function(n,t){var i=this.getAsset(n,t);i!==!1&&this._fileList.splice(i.index,1)},removeAll:function(){this._fileList.length=0},start:function(){this.isLoading||(this.progress=0,this.progressFloat=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this._fileList.length),this._fileList.length>0?(this._fileIndex=0,this._progressChunk=100/this._fileList.length,this.loadFile()):(this.progress=100,this.progressFloat=100,this.hasLoaded=!0,this.onLoadComplete.dispatch()))},loadFile:function(){if(!this._fileList[this._fileIndex]){console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);return}var t=this._fileList[this._fileIndex],i=this;switch(t.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":t.data=new Image;t.data.name=t.key;t.data.onload=function(){return i.fileComplete(i._fileIndex)};t.data.onerror=function(){return i.fileError(i._fileIndex)};t.data.crossOrigin=this.crossOrigin;t.data.src=this.baseURL+t.url;break;case"audio":t.url=this.getAudioURL(t.url);t.url!==null?this.game.sound.usingWebAudio?(this._xhr.open("GET",this.baseURL+t.url,!0),this._xhr.responseType="arraybuffer",this._xhr.onload=function(){return i.fileComplete(i._fileIndex)},this._xhr.onerror=function(){return i.fileError(i._fileIndex)},this._xhr.send()):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.baseURL+t.url,this.fileComplete(this._fileIndex)):(t.data=new Audio,t.data.name=t.key,t.data.onerror=function(){return i.fileError(i._fileIndex)},t.data.preload="auto",t.data.src=this.baseURL+t.url,t.data.addEventListener("canplaythrough",n.GAMES[this.game.id].load.fileComplete(this._fileIndex),!1),t.data.load())):this.fileError(this._fileIndex);break;case"tilemap":if(this._xhr.open("GET",this.baseURL+t.url,!0),this._xhr.responseType="text",t.format===n.Tilemap.TILED_JSON)this._xhr.onload=function(){return i.jsonLoadComplete(i._fileIndex)};else if(t.format===n.Tilemap.CSV)this._xhr.onload=function(){return i.csvLoadComplete(i._fileIndex)};else throw new Error("Phaser.Loader. Invalid Tilemap format: "+t.format);this._xhr.onerror=function(){return i.dataLoadError(i._fileIndex)};this._xhr.send();break;case"text":case"script":this._xhr.open("GET",this.baseURL+t.url,!0);this._xhr.responseType="text";this._xhr.onload=function(){return i.fileComplete(i._fileIndex)};this._xhr.onerror=function(){return i.fileError(i._fileIndex)};this._xhr.send();break;case"binary":this._xhr.open("GET",this.baseURL+t.url,!0);this._xhr.responseType="arraybuffer";this._xhr.onload=function(){return i.fileComplete(i._fileIndex)};this._xhr.onerror=function(){return i.fileError(i._fileIndex)};this._xhr.send()}},getAudioURL:function(n){var t,i;for(typeof n=="string"&&(n=[n]),i=0;i<n.length;i++)if(t=n[i].toLowerCase(),t=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1),this.game.device.canPlayAudio(t))return n[i];return null},fileError:function(n){this._fileList[n].loaded=!0;this._fileList[n].error=!0;this.onFileError.dispatch(this._fileList[n].key,this._fileList[n]);console.warn("Phaser.Loader error loading file: "+this._fileList[n].key+" from URL "+this._fileList[n].url);this.nextFile(n,!1)},fileComplete:function(t){var i,f,r,e,u;if(!this._fileList[t]){console.warn("Phaser.Loader fileComplete invalid index "+t);return}i=this._fileList[t];i.loaded=!0;f=!0;r=this;switch(i.type){case"image":this.game.cache.addImage(i.key,i.url,i.data);break;case"spritesheet":this.game.cache.addSpriteSheet(i.key,i.url,i.data,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"textureatlas":if(i.atlasURL==null)this.game.cache.addTextureAtlas(i.key,i.url,i.data,i.atlasData,i.format);else{if(f=!1,this._xhr.open("GET",this.baseURL+i.atlasURL,!0),this._xhr.responseType="text",i.format==n.Loader.TEXTURE_ATLAS_JSON_ARRAY||i.format==n.Loader.TEXTURE_ATLAS_JSON_HASH)this._xhr.onload=function(){return r.jsonLoadComplete(t)};else if(i.format==n.Loader.TEXTURE_ATLAS_XML_STARLING)this._xhr.onload=function(){return r.xmlLoadComplete(t)};else throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+i.format);this._xhr.onerror=function(){return r.dataLoadError(t)};this._xhr.send()}break;case"bitmapfont":i.xmlURL==null?this.game.cache.addBitmapFont(i.key,i.url,i.data,i.xmlData):(f=!1,this._xhr.open("GET",this.baseURL+i.xmlURL,!0),this._xhr.responseType="text",this._xhr.onload=function(){return r.xmlLoadComplete(t)},this._xhr.onerror=function(){return r.dataLoadError(t)},this._xhr.send());break;case"audio":this.game.sound.usingWebAudio?(i.data=this._xhr.response,this.game.cache.addSound(i.key,i.url,i.data,!0,!1),i.autoDecode&&(this.game.cache.updateSound(u,"isDecoding",!0),e=this,u=i.key,this.game.sound.context.decodeAudioData(i.data,function(n){n&&(e.game.cache.decodedSound(u,n),e.game.sound.onSoundDecode.dispatch(u,e.game.cache.getSound(u)))}))):(i.data.removeEventListener("canplaythrough",n.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(i.key,i.url,i.data,!1,!0));break;case"text":i.data=this._xhr.responseText;this.game.cache.addText(i.key,i.url,i.data);break;case"script":i.data=document.createElement("script");i.data.language="javascript";i.data.type="text/javascript";i.data.defer=!1;i.data.text=this._xhr.responseText;document.head.appendChild(i.data);break;case"binary":i.data=i.callback?i.callback.call(i.callbackContext,i.key,this._xhr.response):this._xhr.response;this.game.cache.addBinary(i.key,i.data)}f&&this.nextFile(t,!0)},jsonLoadComplete:function(n){if(!this._fileList[n]){console.warn("Phaser.Loader jsonLoadComplete invalid index "+n);return}var t=this._fileList[n],i=JSON.parse(this._xhr.responseText);t.loaded=!0;t.type==="tilemap"?this.game.cache.addTilemap(t.key,t.url,i,t.format):this.game.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format);this.nextFile(n,!0)},csvLoadComplete:function(n){if(!this._fileList[n]){console.warn("Phaser.Loader csvLoadComplete invalid index "+n);return}var t=this._fileList[n],i=this._xhr.responseText;t.loaded=!0;this.game.cache.addTilemap(t.key,t.url,i,t.format);this.nextFile(n,!0)},dataLoadError:function(n){var t=this._fileList[n];t.loaded=!0;t.error=!0;console.warn("Phaser.Loader dataLoadError: "+t.key);this.nextFile(n,!0)},xmlLoadComplete:function(n){var r=this._xhr.responseText,i,u,t;try{window.DOMParser?(u=new DOMParser,i=u.parseFromString(r,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(r))}catch(f){i=undefined}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");t=this._fileList[n];t.loaded=!0;t.type=="bitmapfont"?this.game.cache.addBitmapFont(t.key,t.url,t.data,i):t.type=="textureatlas"&&this.game.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format);this.nextFile(n,!0)},nextFile:function(n,t){this.progressFloat+=this._progressChunk;this.progress=Math.round(this.progressFloat);this.progress>100&&(this.progress=100);this.preloadSprite!==null&&(this.preloadSprite.direction===0?this.preloadSprite.crop.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.crop.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.crop=this.preloadSprite.crop);this.onFileComplete.dispatch(this.progress,this._fileList[n].key,t,this.totalLoadedFiles(),this._fileList.length);this.totalQueuedFiles()>0?(this._fileIndex++,this.loadFile()):(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())},totalLoadedFiles:function(){for(var t=0,n=0;n<this._fileList.length;n++)this._fileList[n].loaded&&t++;return t},totalQueuedFiles:function(){for(var t=0,n=0;n<this._fileList.length;n++)this._fileList[n].loaded===!1&&t++;return t}},n.Loader.prototype.constructor=n.Loader,n.LoaderParser={bitmapFont:function(n,i,r){var f,u,s,h,o;if(!i.getElementsByTagName("font")){console.warn("Phaser.LoaderParser.bitmapFont: Invalid XML given, missing <font> tag");return}var c=t.TextureCache[r],e={},l=i.getElementsByTagName("info")[0],a=i.getElementsByTagName("common")[0];for(e.font=l.attributes.getNamedItem("face").nodeValue,e.size=parseInt(l.attributes.getNamedItem("size").nodeValue,10),e.lineHeight=parseInt(a.attributes.getNamedItem("lineHeight").nodeValue,10),e.chars={},f=i.getElementsByTagName("char"),u=0;u<f.length;u++)s=parseInt(f[u].attributes.getNamedItem("id").nodeValue,10),h={x:parseInt(f[u].attributes.getNamedItem("x").nodeValue,10),y:parseInt(f[u].attributes.getNamedItem("y").nodeValue,10),width:parseInt(f[u].attributes.getNamedItem("width").nodeValue,10),height:parseInt(f[u].attributes.getNamedItem("height").nodeValue,10)},t.TextureCache[s]=new t.Texture(c,h),e.chars[s]={xOffset:parseInt(f[u].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(f[u].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(f[u].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new t.Texture(c,h)};for(o=i.getElementsByTagName("kerning"),u=0;u<o.length;u++){var v=parseInt(o[u].attributes.getNamedItem("first").nodeValue,10),y=parseInt(o[u].attributes.getNamedItem("second").nodeValue,10),p=parseInt(o[u].attributes.getNamedItem("amount").nodeValue,10);e.chars[y].kerning[v]=p}t.BitmapText.fonts[e.font]=e}},n.Sound=function(t,i,r,u,f){typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=t.sound.connectToMaster);this.game=t;this.name=i;this.key=i;this.loop=u;this._volume=r;this.markers={};this.context=null;this._buffer=null;this._muted=!1;this.autoplay=!1;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.stopTime=0;this.paused=!1;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=!1;this.currentMarker="";this.pendingPlayback=!1;this.override=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=typeof this.context.createGain=="undefined"?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=r*this.game.sound.volume,f&&this.gainNode.connect(this.masterGainNode)):this.game.cache.getSound(i)&&this.game.cache.isSoundReady(i)?(this._sound=this.game.cache.getSoundData(i),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this);this.onDecoded=new n.Signal;this.onPlay=new n.Signal;this.onPause=new n.Signal;this.onResume=new n.Signal;this.onLoop=new n.Signal;this.onStop=new n.Signal;this.onMute=new n.Signal;this.onMarkerComplete=new n.Signal},n.Sound.prototype={soundHasUnlocked:function(n){n==this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(n,t,i,r,u){r=r||1;typeof u=="undefined"&&(u=!1);this.markers[n]={name:n,start:t,stop:t+i,volume:r,duration:i,durationMS:i*1e3,loop:u}},removeMarker:function(n){delete this.markers[n]},update:function(){this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop));this.isPlaying&&(this.currentTime=this.game.time.now-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.currentMarker===""?(this.currentTime=0,this.startTime=this.game.time.now):this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},play:function(n,t,i,r,u){if(n=n||"",t=t||0,typeof i=="undefined"&&(i=this._volume),typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=!0),this.isPlaying!==!0||u!==!1||this.override!==!1){if(this.isPlaying&&this.override&&(this.usingWebAudio?typeof this._sound.stop=="undefined"?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.currentMarker=n,n!=="")if(this.markers[n])this.position=this.markers[n].start,this.volume=this.markers[n].volume,this.loop=this.markers[n].loop,this.duration=this.markers[n].duration,this.durationMS=this.markers[n].durationMS,this._tempMarker=n,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop;else{console.warn("Phaser.Sound.play: audio marker "+n+" doesn't exist");return}else this.position=t,this.volume=i,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=n,this._tempPosition=t,this._tempVolume=i,this._tempLoop=r;this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._buffer==null&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode.input):this._sound.connect(this.gainNode),this.totalDuration=this._sound.buffer.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this.loop&&n===""&&(this._sound.loop=!0),typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,this.position,this.duration):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)?(this._sound.play(),this.totalDuration=this._sound.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0}},restart:function(n,t,i,r){n=n||"";t=t||0;i=i||1;typeof r=="undefined"&&(r=!1);this.play(n,t,i,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.stop(),this.isPlaying=!1,this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.now,this.onPause.dispatch(this))},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var n=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this.externalNode?this._sound.connect(this.externalNode.input):this._sound.connect(this.gainNode);this.loop&&(this._sound.loop=!0);typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,n,this.duration):this._sound.start(0,n,this.duration)}else this._sound.play();this.isPlaying=!0;this.paused=!1;this.startTime+=this.game.time.now-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){this.isPlaying&&this._sound&&(this.usingWebAudio?typeof this._sound.stop=="undefined"?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0));this.isPlaying=!1;var n=this.currentMarker;this.currentMarker="";this.onStop.dispatch(this,n)}},n.Sound.prototype.constructor=n.Sound,Object.defineProperty(n.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(n.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(n.Sound.prototype,"mute",{get:function(){return this._muted},set:function(n){n=n||null;n?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume));this.onMute.dispatch(this)}}),Object.defineProperty(n.Sound.prototype,"volume",{get:function(){return this._volume},set:function(n){this.usingWebAudio?(this._volume=n,this.gainNode.gain.value=n):this.usingAudioTag&&this._sound&&n>=0&&n<=1&&(this._volume=n,this._sound.volume=n)}}),n.SoundManager=function(t){this.game=t;this.onSoundDecode=new n.Signal;this._muted=!1;this._unlockSource=null;this._volume=1;this._sounds=[];this.context=null;this.usingWebAudio=!0;this.usingAudioTag=!1;this.noAudio=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32},n.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0){this.usingWebAudio=!1;this.noAudio=!0;return}if(window.PhaserGlobal.disableWebAudio===!0){this.usingWebAudio=!1;this.usingAudioTag=!0;this.noAudio=!1;return}}window.AudioContext?this.context=new window.AudioContext:window.webkitAudioContext?this.context=new window.webkitAudioContext:window.Audio?(this.usingWebAudio=!1,this.usingAudioTag=!0):(this.usingWebAudio=!1,this.noAudio=!0);this.context!==null&&(this.masterGain=typeof this.context.createGain=="undefined"?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var n=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=n;this._unlockSource.connect(this.context.destination);this._unlockSource.noteOn(0)}},stopAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].stop()},pauseAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].pause()},resumeAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].resume()},decode:function(n,t){var i,r;t=t||null;i=this.game.cache.getSoundData(n);i&&this.game.cache.isSoundDecoded(n)===!1&&(this.game.cache.updateSound(n,"isDecoding",!0),r=this,this.context.decodeAudioData(i,function(i){r.game.cache.decodedSound(n,i);t&&r.onSoundDecode.dispatch(n,t)}))},update:function(){this.touchLocked&&this.game.device.webAudio&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var n=0;n<this._sounds.length;n++)this._sounds[n].update()},add:function(t,i,r,u){typeof i=="undefined"&&(i=1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=this.connectToMaster);var f=new n.Sound(this.game,t,i,r,u);return this._sounds.push(f),f},add:function(n){this._sounds.push(n)},play:function(n,t,i,r){typeof r=="undefined"&&(r=!1);var u=this.add(n,t,i);return u.play(),u}},n.SoundManager.prototype.constructor=n.SoundManager,Object.defineProperty(n.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(n){var t;if(n=n||null,n){if(this._muted)return;for(this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0),t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0)}else{if(this._muted===!1)return;for(this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume),t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1)}}}),Object.defineProperty(n.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(n){n=this.game.math.clamp(n,1,0);this._volume=n;this.usingWebAudio&&(this.masterGain.gain.value=n);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*n)}}),n.Utils.Debug=function(n){this.game=n;this.context=n.context;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=!0;this.currentX=0;this.currentY=0;this.currentAlpha=1},n.Utils.Debug.prototype={start:function(n,t,i,r){this.context!=null&&(typeof n!="number"&&(n=0),typeof t!="number"&&(t=0),i=i||"rgb(255,255,255)",typeof r=="undefined"&&(r=0),this.currentX=n,this.currentY=t,this.currentColor=i,this.currentAlpha=this.context.globalAlpha,this.columnWidth=r,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=i,this.context.fillStyle=i,this.context.font=this.font,this.context.globalAlpha=1)},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha},line:function(n,t,i){this.context!=null&&(typeof t!="undefined"&&(this.currentX=t),typeof i!="undefined"&&(this.currentY=i),this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(n,this.currentX+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(n,this.currentX,this.currentY),this.currentY+=this.lineHeight)},splitline:function(){var t,n;if(this.context!=null){for(t=this.currentX,n=0;n<arguments.length;n++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[n],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[n],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight}},renderQuadTree:function(n,t){var r,i;if(t=t||"rgba(255,0,0,0.3)",this.start(),r=n.bounds,n.nodes.length===0)for(this.context.strokeStyle=t,this.context.strokeRect(r.x,r.y,r.width,r.height),this.renderText(n.ID+" / "+n.objects.length,r.x+4,r.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",i=0;i<n.objects.length;i++)this.context.strokeRect(n.objects[i].x,n.objects[i].y,n.objects[i].width,n.objects[i].height);else for(i=0;i<n.nodes.length;i++)this.renderQuadTree(n.nodes[i]);this.stop()},renderSpriteCorners:function(n,t,i,r){this.context!=null&&(t=t||!1,i=i||!1,r=r||"rgb(255,255,255)",this.start(0,0,r),i&&(this.context.beginPath(),this.context.strokeStyle="rgba(0, 255, 0, 0.7)",this.context.strokeRect(n.bounds.x,n.bounds.y,n.bounds.width,n.bounds.height),this.context.closePath(),this.context.stroke()),this.context.beginPath(),this.context.moveTo(n.topLeft.x,n.topLeft.y),this.context.lineTo(n.topRight.x,n.topRight.y),this.context.lineTo(n.bottomRight.x,n.bottomRight.y),this.context.lineTo(n.bottomLeft.x,n.bottomLeft.y),this.context.closePath(),this.context.strokeStyle="rgba(255, 0, 255, 0.7)",this.context.stroke(),this.renderPoint(n.offset),this.renderPoint(n.center),this.renderPoint(n.topLeft),this.renderPoint(n.topRight),this.renderPoint(n.bottomLeft),this.renderPoint(n.bottomRight),t&&(this.currentColor=r,this.line("x: "+Math.floor(n.topLeft.x)+" y: "+Math.floor(n.topLeft.y),n.topLeft.x,n.topLeft.y),this.line("x: "+Math.floor(n.topRight.x)+" y: "+Math.floor(n.topRight.y),n.topRight.x,n.topRight.y),this.line("x: "+Math.floor(n.bottomLeft.x)+" y: "+Math.floor(n.bottomLeft.y),n.bottomLeft.x,n.bottomLeft.y),this.line("x: "+Math.floor(n.bottomRight.x)+" y: "+Math.floor(n.bottomRight.y),n.bottomRight.x,n.bottomRight.y)),this.stop())},renderSoundInfo:function(n,t,i,r){this.context!=null&&(r=r||"rgb(255,255,255)",this.start(t,i,r),this.line("Sound: "+n.key+" Locked: "+n.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(n.key)+" Pending Playback: "+n.pendingPlayback),this.line("Decoded: "+n.isDecoded+" Decoding: "+n.isDecoding),this.line("Total Duration: "+n.totalDuration+" Playing: "+n.isPlaying),this.line("Time: "+n.currentTime),this.line("Volume: "+n.volume+" Muted: "+n.mute),this.line("WebAudio: "+n.usingWebAudio+" Audio: "+n.usingAudioTag),n.currentMarker!==""&&(this.line("Marker: "+n.currentMarker+" Duration: "+n.duration),this.line("Start: "+n.markers[n.currentMarker].start+" Stop: "+n.markers[n.currentMarker].stop),this.line("Position: "+n.position)),this.stop())},renderCameraInfo:function(n,t,i,r){this.context!=null&&(r=r||"rgb(255,255,255)",this.start(t,i,r),this.line("Camera ("+n.width+" x "+n.height+")"),this.line("X: "+n.x+" Y: "+n.y),this.line("Bounds x: "+n.bounds.x+" Y: "+n.bounds.y+" w: "+n.bounds.width+" h: "+n.bounds.height),this.line("View x: "+n.view.x+" Y: "+n.view.y+" w: "+n.view.width+" h: "+n.view.height),this.stop())},renderPointer:function(n,t,i,r,u){this.context!=null&&n!=null&&(typeof t=="undefined"&&(t=!1),i=i||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",u=u||"rgb(255,255,255)",t!==!0||n.isUp!==!0)&&(this.start(n.x,n.y-100,u),this.context.beginPath(),this.context.arc(n.x,n.y,n.circle.radius,0,Math.PI*2),this.context.fillStyle=n.active?i:r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(n.positionDown.x,n.positionDown.y),this.context.lineTo(n.position.x,n.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+n.id+" Active: "+n.active),this.line("World X: "+n.worldX+" World Y: "+n.worldY),this.line("Screen X: "+n.x+" Screen Y: "+n.y),this.line("Duration: "+n.duration+" ms"),this.stop())},renderSpriteInputInfo:function(n,t,i,r){r=r||"rgb(255,255,255)";this.start(t,i,r);this.line("Sprite Input: ("+n.width+" x "+n.height+")");this.line("x: "+n.input.pointerX().toFixed(1)+" y: "+n.input.pointerY().toFixed(1));this.line("over: "+n.input.pointerOver()+" duration: "+n.input.overDuration().toFixed(0));this.line("down: "+n.input.pointerDown()+" duration: "+n.input.downDuration().toFixed(0));this.line("just over: "+n.input.justOver()+" just out: "+n.input.justOut());this.stop()},renderBodyInfo:function(n,t,i,r){r=r||"rgb(255,255,255)";this.start(t,i,r,210);this.splitline("x: "+n.body.x.toFixed(2),"y: "+n.body.y.toFixed(2),"width: "+n.width,"height: "+n.height);this.splitline("speed: "+n.body.speed.toFixed(2),"angle: "+n.body.angle.toFixed(2),"linear damping: "+n.body.linearDamping);this.splitline("blocked left: "+n.body.blocked.left,"right: "+n.body.blocked.right,"up: "+n.body.blocked.up,"down: "+n.body.blocked.down);this.splitline("touching left: "+n.body.touching.left,"right: "+n.body.touching.right,"up: "+n.body.touching.up,"down: "+n.body.touching.down);this.splitline("gravity x: "+n.body.gravity.x,"y: "+n.body.gravity.y,"world gravity x: "+this.game.physics.gravity.x,"y: "+this.game.physics.gravity.y);this.splitline("acceleration x: "+n.body.acceleration.x.toFixed(2),"y: "+n.body.acceleration.y.toFixed(2));this.splitline("velocity x: "+n.body.velocity.x.toFixed(2),"y: "+n.body.velocity.y.toFixed(2),"deltaX: "+n.body.deltaX().toFixed(2),"deltaY: "+n.body.deltaY().toFixed(2));this.splitline("bounce x: "+n.body.bounce.x.toFixed(2),"y: "+n.body.bounce.y.toFixed(2));this.stop()},renderInputInfo:function(n,t,i){this.context!=null&&(i=i||"rgb(255,255,0)",this.start(n,t,i),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop())},renderSpriteInfo:function(n,t,i,r){this.context!=null&&(r=r||"rgb(255, 255, 255)",this.start(t,i,r),this.line("Sprite:  ("+n.width+" x "+n.height+") anchor: "+n.anchor.x+" x "+n.anchor.y),this.line("x: "+n.x.toFixed(1)+" y: "+n.y.toFixed(1)),this.line("angle: "+n.angle.toFixed(1)+" rotation: "+n.rotation.toFixed(1)),this.line("visible: "+n.visible+" in camera: "+n.inCamera),this.line("body x: "+n.body.x.toFixed(1)+" y: "+n.body.y.toFixed(1)),this.line("id: "+n._id),this.line("scale x: "+n.worldTransform[0]),this.line("scale y: "+n.worldTransform[4]),this.line("tx: "+n.worldTransform[2]),this.line("ty: "+n.worldTransform[5]),this.line("skew x: "+n.worldTransform[3]),this.line("skew y: "+n.worldTransform[1]),this.line("sdx: "+n.deltaX),this.line("sdy: "+n.deltaY),this.stop())},renderSpriteCoords:function(n,t,i,r){this.context!=null&&(r=r||"rgb(255, 255, 255)",this.start(t,i,r,100),n.name&&this.line(n.name),this.splitline("x:",n.x.toFixed(2),"y:",n.y.toFixed(2)),this.splitline("pos x:",n.position.x.toFixed(2),"pos y:",n.position.y.toFixed(2)),this.splitline("world x:",n.world.x.toFixed(2),"world y:",n.world.y.toFixed(2)),this.stop())},renderLine:function(n,t){this.context!=null&&(t=t||"rgb(255, 255, 255)",this.start(0,0,t),this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(n.start.x+.5,n.start.y+.5),this.context.lineTo(n.end.x+.5,n.end.y+.5),this.context.closePath(),this.context.stroke(),this.stop())},renderLineInfo:function(n,t,i,r){this.context!=null&&(r=r||"rgb(255, 255, 255)",this.start(t,i,r,80),this.splitline("start.x:",n.start.x.toFixed(2),"start.y:",n.start.y.toFixed(2)),this.splitline("end.x:",n.end.x.toFixed(2),"end.y:",n.end.y.toFixed(2)),this.splitline("length:",n.length.toFixed(2),"angle:",n.angle),this.stop())},renderPointInfo:function(n,t,i,r){this.context!=null&&(r=r||"rgb(255, 255, 255)",this.start(t,i,r),this.line("px: "+n.x.toFixed(1)+" py: "+n.y.toFixed(1)),this.stop())},renderSpriteBody:function(n,t,i){this.context!=null&&(t=t||"rgb(255,0,255)",typeof i=="undefined"&&(i=!1),this.start(0,0,t),i?(this.context.fillStyle=t,this.context.fillRect(n.body.left,n.body.top,n.body.width,n.body.height)):(this.context.strokeStyle=t,this.context.strokeRect(n.body.left,n.body.top,n.body.width,n.body.height),this.context.stroke()),this.stop())},renderSpriteBounds:function(n,t,i){this.context!=null&&(t=t||"rgb(255,0,255)",typeof i=="undefined"&&(i=!1),this.start(0,0,t),i?(this.context.fillStyle=t,this.context.fillRect(n.bounds.x,n.bounds.y,n.bounds.width,n.bounds.height)):(this.context.strokeStyle=t,this.context.strokeRect(n.bounds.x,n.bounds.y,n.bounds.width,n.bounds.height),this.context.stroke()),this.stop())},renderPixel:function(n,t,i){this.context!=null&&(i=i||"rgba(0,255,0,1)",this.start(),this.context.fillStyle=i,this.context.fillRect(n,t,2,2),this.stop())},renderPoint:function(n,t){this.context!=null&&(t=t||"rgba(0,255,0,1)",this.start(),this.context.fillStyle=t,this.context.fillRect(n.x,n.y,4,4),this.stop())},renderRectangle:function(n,t){this.context!=null&&(t=t||"rgba(0,255,0,0.3)",this.start(),this.context.fillStyle=t,this.context.fillRect(n.x,n.y,n.width,n.height),this.stop())},renderCircle:function(n,t){this.context!=null&&(t=t||"rgba(0,255,0,0.3)",this.start(),this.context.beginPath(),this.context.fillStyle=t,this.context.arc(n.x,n.y,n.radius,0,Math.PI*2,!1),this.context.fill(),this.context.closePath(),this.stop())},renderText:function(n,t,i,r,u){this.context!=null&&(r=r||"rgb(255,255,255)",u=u||"16px Courier",this.start(),this.context.font=u,this.context.fillStyle=r,this.context.fillText(n,t,i),this.stop())},renderPhysicsBody:function(t,i,r){var e,o,u,f;if(this.context!==null||r!==null)if(i=i||"rgb(255,255,255)",e=t.x-this.game.camera.x,o=t.y-this.game.camera.y,t.type===n.Physics.Arcade.CIRCLE)this.start(0,0,i),this.context.beginPath(),this.context.strokeStyle=i,this.context.arc(e,o,t.shape.r,0,Math.PI*2,!1),this.context.stroke(),this.context.closePath(),this.stop();else{for(u=t.polygon.points,this.start(0,0,i),this.context.beginPath(),this.context.moveTo(e+u[0].x,o+u[0].y),f=1;f<u.length;f++)this.context.lineTo(e+u[f].x,o+u[f].y);for(this.context.closePath(),this.context.strokeStyle=i,this.context.stroke(),this.context.fillStyle="rgb(255,0,0)",this.context.fillRect(e+u[0].x-2,o+u[0].y-2,5,5),f=1;f<u.length;f++)this.context.fillStyle="rgb(255,"+f*40+",0)",this.context.fillRect(e+u[f].x-2,o+u[f].y-2,5,5);this.stop()}},renderPolygon:function(n,t,i){var u;if(this.context!==null||i!==null){t=t||"rgb(255,255,255)";var r=n.points,f=n.pos.x,e=n.pos.y;for(this.start(0,0,t),this.context.beginPath(),this.context.moveTo(f+r[0].x,e+r[0].y),u=1;u<r.length;u++)this.context.lineTo(f+r[u].x,e+r[u].y);this.context.closePath();this.context.strokeStyle=t;this.context.stroke();this.stop()}}},n.Utils.Debug.prototype.constructor=n.Utils.Debug,n.Color={getColor32:function(n,t,i,r){return n<<24|t<<16|i<<8|r},getColor:function(n,t,i){return n<<16|t<<8|i},hexToRGB:function(n){var t=n.charAt(0)=="#"?n.substring(1,7):n;t.length==3&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2));var i=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),u=parseInt(t.substring(4,6),16);return i<<16|r<<8|u},getColorInfo:function(t){var i=n.Color.getRGB(t),r=n.Color.RGBtoHSV(t),u=n.Color.RGBtoHexstring(t)+"\n";return u=u.concat("Alpha: "+i.alpha+" Red: "+i.red+" Green: "+i.green+" Blue: "+i.blue)+"\n",u.concat("Hue: "+r.hue+" Saturation: "+r.saturation+" Lightnes: "+r.lightness)},RGBtoHexstring:function(t){var i=n.Color.getRGB(t);return"0x"+n.Color.colorToHexstring(i.alpha)+n.Color.colorToHexstring(i.red)+n.Color.colorToHexstring(i.green)+n.Color.colorToHexstring(i.blue)},RGBtoWebstring:function(t){var i=n.Color.getRGB(t);return"#"+n.Color.colorToHexstring(i.red)+n.Color.colorToHexstring(i.green)+n.Color.colorToHexstring(i.blue)},colorToHexstring:function(n){var t="0123456789ABCDEF",i=n%16,r=(n-i)/16;return t.charAt(r)+t.charAt(i)},interpolateColor:function(t,i,r,u,f){typeof f=="undefined"&&(f=255);var e=n.Color.getRGB(t),o=n.Color.getRGB(i),s=(o.red-e.red)*u/r+e.red,h=(o.green-e.green)*u/r+e.green,c=(o.blue-e.blue)*u/r+e.blue;return n.Color.getColor32(f,s,h,c)},interpolateColorWithRGB:function(t,i,r,u,f,e){var o=n.Color.getRGB(t),s=(i-o.red)*e/f+o.red,h=(r-o.green)*e/f+o.green,c=(u-o.blue)*e/f+o.blue;return n.Color.getColor(s,h,c)},interpolateRGB:function(t,i,r,u,f,e,o,s){var h=(u-t)*s/o+t,c=(f-i)*s/o+i,l=(e-r)*s/o+r;return n.Color.getColor(h,c,l)},getRandomColor:function(t,i,r){if((typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=255),typeof r=="undefined"&&(r=255),i>255)||t>i)return n.Color.getColor(255,255,255);var u=t+Math.round(Math.random()*(i-t)),f=t+Math.round(Math.random()*(i-t)),e=t+Math.round(Math.random()*(i-t));return n.Color.getColor32(r,u,f,e)},getRGB:function(n){return{alpha:n>>>24,red:n>>16&255,green:n>>8&255,blue:n&255}},getWebRGB:function(n){var t=(n>>>24)/255,i=n>>16&255,r=n>>8&255,u=n&255;return"rgba("+i.toString()+","+r.toString()+","+u.toString()+","+t.toString()+")"},getAlpha:function(n){return n>>>24},getAlphaFloat:function(n){return(n>>>24)/255},getRed:function(n){return n>>16&255},getGreen:function(n){return n>>8&255},getBlue:function(n){return n&255}},i=function(){"use strict";function n(n,t){this.x=n||0;this.y=t||0}function y(t,i){this.pos=t||new n;this.r=i||0}function r(t,i){this.pos=t||new n;this.points=i||[];this.recalc()}function e(t,i,r){this.pos=t||new n;this.w=i||0;this.h=r||0}function o(){this.a=null;this.b=null;this.overlapN=new n;this.overlapV=new n;this.clear()}function l(n,t,i){for(var r,u=Number.MAX_VALUE,f=-Number.MAX_VALUE,o=n.length,e=0;e<o;e++)r=n[e].dot(t),r<u&&(u=r),r>f&&(f=r);i[0]=u;i[1]=f}function a(n,i,r,f,e,o){var h=u.pop(),s=u.pop(),y=t.pop().copy(i).sub(n),w=y.dot(e),c,a,v,p;return(l(r,e,h),l(f,e,s),s[0]+=w,s[1]+=w,h[0]>s[1]||s[0]>h[1])?(t.push(y),u.push(h),u.push(s),!0):(o&&(c=0,h[0]<s[0]?(o.aInB=!1,h[1]<s[1]?(c=h[1]-s[0],o.bInA=!1):(a=h[1]-s[0],v=s[1]-h[0],c=a<v?a:-v)):(o.bInA=!1,h[1]>s[1]?(c=h[0]-s[1],o.aInB=!1):(a=h[1]-s[0],v=s[1]-h[0],c=a<v?a:-v)),p=Math.abs(c),p<o.overlap&&(o.overlap=p,o.overlapN.copy(e),c<0&&o.overlapN.reverse())),t.push(y),u.push(h),u.push(s),!1)}function s(n,t){var r=n.len2(),i=t.dot(n);return i<0?h:i>r?c:p}function w(n,i,r){var u=t.pop().copy(i.pos).sub(n.pos),e=n.r+i.r,s=e*e,o=u.len2(),f;return o>s?(t.push(u),!1):(r&&(f=Math.sqrt(o),r.a=n,r.b=i,r.overlap=e-f,r.overlapN.copy(u.normalize()),r.overlapV.copy(u).scale(r.overlap),r.aInB=n.r<=i.r&&f<=i.r-n.r,r.bInA=i.r<=n.r&&f<=n.r-i.r),t.push(u),!0)}function v(n,i,r){for(var v,b,e,a=t.pop().copy(i.pos).sub(n.pos),o=i.r,tt=o*o,w=n.points,k=w.length,f=t.pop(),u=t.pop(),l=0;l<k;l++){var g=l===k-1?0:l+1,nt=l===0?k-1:l-1,y=0,p=null;if(f.copy(n.edges[l]),u.copy(a).sub(w[l]),r&&u.len2()>tt&&(r.aInB=!1),v=s(f,u),v===h){if(f.copy(n.edges[nt]),b=t.pop().copy(a).sub(w[nt]),v=s(f,b),v===c){if(e=u.len(),e>o)return t.push(a),t.push(f),t.push(u),t.push(b),!1;r&&(r.bInA=!1,p=u.normalize(),y=o-e)}t.push(b)}else if(v===c){if(f.copy(n.edges[g]),u.copy(a).sub(w[g]),v=s(f,u),v===h){if(e=u.len(),e>o)return t.push(a),t.push(f),t.push(u),!1;r&&(r.bInA=!1,p=u.normalize(),y=o-e)}}else{var d=f.perp().normalize(),e=u.dot(d),it=Math.abs(e);if(e>0&&it>o)return t.push(a),t.push(d),t.push(u),!1;r&&(p=d,y=o-e,(e>=0||y<2*o)&&(r.bInA=!1))}p&&r&&Math.abs(y)<Math.abs(r.overlap)&&(r.overlap=y,r.overlapN.copy(p))}return r&&(r.a=n,r.b=i,r.overlapV.copy(r.overlapN).scale(r.overlap)),t.push(a),t.push(f),t.push(u),!0}function b(n,t,i){var r=v(t,n,i),u,f;return r&&i&&(u=i.a,f=i.aInB,i.overlapN.reverse(),i.overlapV.reverse(),i.a=i.b,i.b=u,i.aInB=i.bInA,i.bInA=f),r}function k(n,t,i){for(var u=n.points,e=u.length,f=t.points,o=f.length,r=0;r<e;r++)if(a(n.pos,t.pos,u,f,n.normals[r],i))return!1;for(r=0;r<o;r++)if(a(n.pos,t.pos,u,f,t.normals[r],i))return!1;return i&&(i.a=n,i.b=t,i.overlapV.copy(i.overlapN).scale(i.overlap)),!0}var i={},t,u,f;for(i.Vector=n,i.V=n,n.prototype.copy=n.prototype.copy=function(n){return this.x=n.x,this.y=n.y,this},n.prototype.perp=n.prototype.perp=function(){var n=this.x;return this.x=this.y,this.y=-n,this},n.prototype.rotate=n.prototype.rotate=function(n){var t=this.x,i=this.y;return this.x=t*Math.cos(n)-i*Math.sin(n),this.y=t*Math.sin(n)+i*Math.cos(n),this},n.prototype.rotatePrecalc=n.prototype.rotatePrecalc=function(n,t){var i=this.x,r=this.y;return this.x=i*t-r*n,this.y=i*n+r*t,this},n.prototype.reverse=n.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.normalize=n.prototype.normalize=function(){var n=this.len();return n>0&&(this.x=this.x/n,this.y=this.y/n),this},n.prototype.add=n.prototype.add=function(n){return this.x+=n.x,this.y+=n.y,this},n.prototype.sub=n.prototype.sub=function(n){return this.x-=n.x,this.y-=n.y,this},n.prototype.scale=n.prototype.scale=function(n,t){return this.x*=n,this.y*=t||n,this},n.prototype.project=n.prototype.project=function(n){var t=this.dot(n)/n.len2();return this.x=t*n.x,this.y=t*n.y,this},n.prototype.projectN=n.prototype.projectN=function(n){var t=this.dot(n);return this.x=t*n.x,this.y=t*n.y,this},n.prototype.reflect=n.prototype.reflect=function(n){var t=this.x,i=this.y;return this.project(n).scale(2),this.x-=t,this.y-=i,this},n.prototype.reflectN=n.prototype.reflectN=function(n){var t=this.x,i=this.y;return this.projectN(n).scale(2),this.x-=t,this.y-=i,this},n.prototype.dot=n.prototype.dot=function(n){return this.x*n.x+this.y*n.y},n.prototype.len2=n.prototype.len2=function(){return this.dot(this)},n.prototype.len=n.prototype.len=function(){return Math.sqrt(this.len2())},i.Circle=y,i.Polygon=r,r.prototype.recalc=r.prototype.recalc=function(){var i,r,t;for(this.edges=[],this.normals=[],i=this.points,r=i.length,t=0;t<r;t++){var f=i[t],e=t<r-1?i[t+1]:i[0],u=(new n).copy(e).sub(f),o=(new n).copy(u).perp().normalize();this.edges.push(u);this.normals.push(o)}return this},r.prototype.rotate=r.prototype.rotate=function(n){for(var u=this.points,f=this.edges,e=this.normals,o=u.length,i=Math.cos(n),r=Math.sin(n),t=0;t<o;t++)u[t].rotatePrecalc(r,i),f[t].rotatePrecalc(r,i),e[t].rotatePrecalc(r,i);return this},r.prototype.scale=r.prototype.scale=function(n,t){for(var r=this.points,u=this.edges,f=this.normals,e=r.length,i=0;i<e;i++)r[i].scale(n,t),u[i].scale(n,t),f[i].scale(n,t);return this},r.prototype.translate=r.prototype.translate=function(n,t){for(var r=this.points,u=r.length,i=0;i<u;i++)r[i].x+=n,r[i].y+=t;return this},i.Box=e,e.prototype.toPolygon=e.prototype.toPolygon=function(){var t=this.pos,i=this.w,u=this.h;return new r(new n(t.x,t.y),[new n,new n(i,0),new n(i,u),new n(0,u)])},i.Response=o,o.prototype.clear=o.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this},t=[],f=0;f<10;f++)t.push(new n);for(u=[],f=0;f<5;f++)u.push([]);var h=-1,p=0,c=1;return i.testCircleCircle=w,i.testPolygonCircle=v,i.testCirclePolygon=b,i.testPolygonPolygon=k,i}(),n.Physics={},n.Physics.Arcade=function(t){this.game=t;this.gravity=new n.Point;this.worldLeft=null;this.worldRight=null;this.worldTop=null;this.worldBottom=null;this.worldPolys=[null,null,null,null];this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.maxObjects=10;this.maxLevels=4;this._mapData=[];this._mapTiles=0;this._result=!1;this._total=0;this._angle=0;this._drag=0;this._dx=0;this._dy=0;this._p=new n.Point(0,0);this._intersection=[0,0,0,0];this._gravityX=0;this._gravityY=0;this._response=new i.Response;this.setBoundsToWorld(!0,!0,!0,!0)},n.Physics.Arcade.RECT=0,n.Physics.Arcade.CIRCLE=1,n.Physics.Arcade.POLYGON=2,n.Physics.Arcade.prototype={checkBounds:function(t){if(!t.collideWorldBounds||!this.worldLeft&&!this.worldRight&&!this.worldTop&&!this.worldBottom)return!1;this._response.clear();var u=i.testPolygonPolygon,r=t.polygon,f=!1;return t.type===n.Physics.Arcade.CIRCLE&&(u=i.testPolygonCircle,r=t.shape),this.worldLeft&&u(this.worldPolys[0],r,this._response)?(t.blocked.left=!0,r.pos.add(this._response.overlapV),t.blocked.x=Math.floor(t.x),t.blocked.y=Math.floor(t.y),f=!0):this.worldRight&&u(this.worldPolys[1],r,this._response)&&(t.blocked.right=!0,r.pos.add(this._response.overlapV),t.blocked.x=Math.floor(t.x),t.blocked.y=Math.floor(t.y),f=!0),this._response.clear(),this.worldTop&&u(this.worldPolys[2],r,this._response)?(t.blocked.up=!0,r.pos.add(this._response.overlapV),t.blocked.x=Math.floor(t.x),t.blocked.y=Math.floor(t.y),f=!0):this.worldBottom&&u(this.worldPolys[3],r,this._response)&&(t.blocked.down=!0,r.pos.add(this._response.overlapV),t.blocked.x=Math.floor(t.x),t.blocked.y=Math.floor(t.y),f=!0),f},setBoundsToWorld:function(n,t,i,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,n,t,i,r)},setBounds:function(n,t,r,u,f,e,o,s){typeof f=="undefined"&&(f=!0);typeof e=="undefined"&&(e=!0);typeof o=="undefined"&&(o=!0);typeof s=="undefined"&&(s=!0);var h=100;f?(this.worldLeft=new i.Box(new i.Vector(n-h,t),h,u),this.worldPolys[0]=this.worldLeft.toPolygon()):(this.worldLeft=null,this.worldPolys[0]=null);e?(this.worldRight=new i.Box(new i.Vector(n+r,t),h,u),this.worldPolys[1]=this.worldRight.toPolygon()):(this.worldRight=null,this.worldPolys[1]=null);o?(this.worldTop=new i.Box(new i.Vector(n,t-h),r,h),this.worldPolys[2]=this.worldTop.toPolygon()):(this.worldTop=null,this.worldPolys[2]=null);s?(this.worldBottom=new i.Box(new i.Vector(n,t+u),r,h),this.worldPolys[3]=this.worldBottom.toPolygon()):(this.worldBottom=null,this.worldPolys[3]=null)},updateMotion:function(n){return n.allowGravity?(this._gravityX=this.gravity.x+n.gravity.x,this._gravityY=this.gravity.y+n.gravity.y):(this._gravityX=n.gravity.x,this._gravityY=n.gravity.y),(this._gravityX<0&&n.blocked.left||this._gravityX>0&&n.blocked.right)&&(this._gravityX=0),(this._gravityY<0&&n.blocked.up||this._gravityY>0&&n.blocked.down)&&(this._gravityY=0),n.allowRotation&&(this._velocityDelta=n.angularAcceleration*this.game.time.physicsElapsed,n.angularDrag!==0&&n.angularAcceleration===0&&(this._drag=n.angularDrag*this.game.time.physicsElapsed,n.angularVelocity>0?n.angularVelocity-=this._drag:n.angularVelocity<0&&(n.angularVelocity+=this._drag)),n.rotation+=this.game.time.physicsElapsed*(n.angularVelocity+this._velocityDelta/2),n.angularVelocity+=this._velocityDelta,n.angularVelocity>n.maxAngular?n.angularVelocity=n.maxAngular:n.angularVelocity<-n.maxAngular&&(n.angularVelocity=-n.maxAngular)),this._p.setTo((n.acceleration.x+this._gravityX)*this.game.time.physicsElapsed,(n.acceleration.y+this._gravityY)*this.game.time.physicsElapsed),this._p},overlap:function(n,t,i,r,u){if(i=i||null,r=r||null,u=u||i,this._result=!1,this._total=0,Array.isArray(t))for(var f=0,e=t.length;f<e;f++)this.collideHandler(n,t[f],i,r,u,!0);else this.collideHandler(n,t,i,r,u,!0);return this._total>0},collide:function(n,t,i,r,u){if(i=i||null,r=r||null,u=u||i,this._result=!1,this._total=0,Array.isArray(t))for(var f=0,e=t.length;f<e;f++)this.collideHandler(n,t[f],i,r,u,!1);else this.collideHandler(n,t,i,r,u,!1);return this._total>0},collideHandler:function(t,i,r,u,f,e){if(typeof i=="undefined"&&(t.type===n.GROUP||t.type===n.EMITTER)){this.collideGroupVsSelf(t,r,u,f,e);return}t&&i&&t.exists&&i.exists&&(t.type==n.SPRITE||t.type==n.TILESPRITE?i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsSprite(t,i,r,u,f,e):i.type==n.GROUP||i.type==n.EMITTER?this.collideSpriteVsGroup(t,i,r,u,f,e):i.type==n.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,i,r,u,f):t.type==n.GROUP?i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsGroup(i,t,r,u,f,e):i.type==n.GROUP||i.type==n.EMITTER?this.collideGroupVsGroup(t,i,r,u,f,e):i.type==n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,r,u,f):t.type==n.TILEMAPLAYER?i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsTilemapLayer(i,t,r,u,f):(i.type==n.GROUP||i.type==n.EMITTER)&&this.collideGroupVsTilemapLayer(i,t,r,u,f):t.type==n.EMITTER&&(i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsGroup(i,t,r,u,f,e):i.type==n.GROUP||i.type==n.EMITTER?this.collideGroupVsGroup(t,i,r,u,f,e):i.type==n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,r,u,f)))},collideSpriteVsSprite:function(n,t,i,r,u,f){this.separate(n.body,t.body,r,u,f)&&(i&&i.call(u,n,t),this._total++)},collideSpriteVsGroup:function(t,i,r,u,f,e){if(i.length!==0){this.quadTree.clear();this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(i);this._potentials=this.quadTree.retrieve(t);for(var o=0,s=this._potentials.length;o<s;o++)this.separate(t.body,this._potentials[o],u,f,e)&&(r&&r.call(f,t,this._potentials[o].sprite),this._total++)}},collideGroupVsSelf:function(n,t,i,r,u){var o,f,e;if(n.length!==0)for(o=n._container.children.length,f=0;f<o;f++)for(e=f+1;e<=o;e++)n._container.children[f]&&n._container.children[e]&&n._container.children[f].exists&&n._container.children[e].exists&&this.collideSpriteVsSprite(n._container.children[f],n._container.children[e],t,i,r,u)},collideGroupVsGroup:function(n,t,i,r,u,f){if(n.length!==0&&t.length!==0&&n._container.first._iNext){var e=n._container.first._iNext;do e.exists&&this.collideSpriteVsGroup(e,t,i,r,u,f),e=e._iNext;while(e!=n._container.last._iNext)}},collideSpriteVsTilemapLayer:function(n,t,i,r,u){if(this._mapData=t.getTiles(n.body.left,n.body.top,n.body.width,n.body.height,!0),this._mapData.length!==0)if(this._mapData.length>1)this.separateTiles(n.body,this._mapData);else{var f=0;this.separateTile(n.body,this._mapData[f])&&(r?r.call(u,n,this._mapData[f])&&(this._total++,i&&i.call(u,n,this._mapData[f])):(this._total++,i&&i.call(u,n,this._mapData[f])))}},collideGroupVsTilemapLayer:function(n,t,i,r,u){if(n.length!==0&&n._container.first._iNext){var f=n._container.first._iNext;do f.exists&&this.collideSpriteVsTilemapLayer(f,t,i,r,u),f=f._iNext;while(f!=n._container.last._iNext)}},separate:function(n,t,i,r,u){return n===t||this.intersects(n,t)===!1?!1:i&&i.call(r,n.sprite,t.sprite)===!1?!1:(this._response.clear(),u)?n.overlap(t,this._response):n.overlap(t,this._response)?n.separate(t,this._response):!1},intersects:function(n,t){var i=!1;(n.width<=0||n.height<=0||t.width<=0||t.height<=0)&&(i=!1);i=!(n.right<t.left||n.bottom<t.top||n.left>t.right||n.top>t.bottom);!i&&n.inContact(t)&&n.removeContact(t)},tileIntersects:function(n,t){return n.width<=0||n.height<=0||t.width<=0||t.height<=0?(this._intersection[4]=0,this._intersection):(n.right<t.x||n.bottom<t.y||n.left>t.right||n.top>t.bottom)?(this._intersection[4]=0,this._intersection):(this._intersection[0]=Math.max(n.left,t.x),this._intersection[1]=Math.max(n.top,t.y),this._intersection[2]=Math.min(n.right,t.right)-this._intersection[0],this._intersection[3]=Math.min(n.bottom,t.bottom)-this._intersection[1],this._intersection[4]=1,this._intersection)},separateTiles:function(n,t){for(var r,u=!1,i=0;i<t.length;i++)r=t[i],this.separateTile(n,r)&&(u=!0);return u},separateTile:function(n,t){if((this._intersection=this.tileIntersects(n,t),this._intersection[4]===0||this._intersection[2]===0||this._intersection[3]===0)||(t.tile.callback||t.layer.callbacks[t.tile.index])&&(t.tile.callback&&t.tile.callback.call(t.tile.callbackContext,n.sprite,t)===!1||t.layer.callbacks[t.tile.index]&&t.layer.callbacks[t.tile.index].callback.call(t.layer.callbacks[t.tile.index].callbackContext,n.sprite,t)===!1))return!1;n.overlapX=0;n.overlapY=0;var i=!1;return n.deltaX()<0&&n.checkCollision.left&&t.tile.faceRight&&!n.blocked.left?(n.overlapX=n.left-t.right,n.overlapX<0?i=!0:n.overlapX=0):n.deltaX()>0&&n.checkCollision.right&&t.tile.faceLeft&&!n.blocked.right&&(n.overlapX=n.right-t.x,n.overlapX>0?i=!0:n.overlapX=0),n.deltaY()<0&&n.checkCollision.up&&t.tile.faceBottom&&!n.blocked.up?(n.overlapY=n.top-t.bottom,n.overlapY<0?i=!0:n.overlapY=0):n.deltaY()>0&&n.checkCollision.down&&t.tile.faceTop&&!n.blocked.down&&(n.overlapY=n.bottom-t.y,n.overlapY>0?i=!0:n.overlapY=0),n.overlapX!==0&&n.overlapY!==0&&(Math.abs(n.overlapX)>Math.abs(n.overlapY)?n.overlapX=0:n.overlapY=0),i?this.processTileSeparation(n):!1},processTileSeparation:function(n){return n.overlapX<0?(n.x-=n.overlapX,n.left-=n.overlapX,n.right-=n.overlapX,n.blocked.x=Math.floor(n.x),n.blocked.y=Math.floor(n.y),n.blocked.left=!0):n.overlapX>0&&(n.x-=n.overlapX,n.left-=n.overlapX,n.right-=n.overlapX,n.blocked.x=Math.floor(n.x),n.blocked.y=Math.floor(n.y),n.blocked.right=!0),n.overlapY<0?(n.y-=n.overlapY,n.top-=n.overlapY,n.bottom-=n.overlapY,n.blocked.x=Math.floor(n.x),n.blocked.y=Math.floor(n.y),n.blocked.up=!0):n.overlapY>0&&(n.y-=n.overlapY,n.top-=n.overlapY,n.bottom-=n.overlapY,n.blocked.x=Math.floor(n.x),n.blocked.y=Math.floor(n.y),n.blocked.down=!0),n.reboundCheck(n.overlapX,n.overlapY,!0),!0},moveToObject:function(n,t,i,r){return typeof i=="undefined"&&(i=60),typeof r=="undefined"&&(r=0),this._angle=Math.atan2(t.y-n.y,t.x-n.x),r>0&&(i=this.distanceBetween(n,t)/(r/1e3)),n.body.velocity.x=Math.cos(this._angle)*i,n.body.velocity.y=Math.sin(this._angle)*i,this._angle},moveToPointer:function(n,t,i,r){return typeof t=="undefined"&&(t=60),i=i||this.game.input.activePointer,typeof r=="undefined"&&(r=0),this._angle=this.angleToPointer(n,i),r>0&&(t=this.distanceToPointer(n,i)/(r/1e3)),n.body.velocity.x=Math.cos(this._angle)*t,n.body.velocity.y=Math.sin(this._angle)*t,this._angle},moveToXY:function(n,t,i,r,u){return typeof r=="undefined"&&(r=60),typeof u=="undefined"&&(u=0),this._angle=Math.atan2(i-n.y,t-n.x),u>0&&(r=this.distanceToXY(n,t,i)/(u/1e3)),n.body.velocity.x=Math.cos(this._angle)*r,n.body.velocity.y=Math.sin(this._angle)*r,this._angle},velocityFromAngle:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(this.game.math.degToRad(t))*i,Math.sin(this.game.math.degToRad(t))*i)},velocityFromRotation:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerationFromRotation:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerateToObject:function(n,t,i,r,u){return typeof i=="undefined"&&(i=60),typeof r=="undefined"&&(r=1e3),typeof u=="undefined"&&(u=1e3),this._angle=this.angleBetween(n,t),n.body.acceleration.setTo(Math.cos(this._angle)*i,Math.sin(this._angle)*i),n.body.maxVelocity.setTo(r,u),this._angle},accelerateToPointer:function(n,t,i,r,u){return typeof i=="undefined"&&(i=60),typeof t=="undefined"&&(t=this.game.input.activePointer),typeof r=="undefined"&&(r=1e3),typeof u=="undefined"&&(u=1e3),this._angle=this.angleToPointer(n,t),n.body.acceleration.setTo(Math.cos(this._angle)*i,Math.sin(this._angle)*i),n.body.maxVelocity.setTo(r,u),this._angle},accelerateToXY:function(n,t,i,r,u,f){return typeof r=="undefined"&&(r=60),typeof u=="undefined"&&(u=1e3),typeof f=="undefined"&&(f=1e3),this._angle=this.angleToXY(n,t,i),n.body.acceleration.setTo(Math.cos(this._angle)*r,Math.sin(this._angle)*r),n.body.maxVelocity.setTo(u,f),this._angle},distanceBetween:function(n,t){return this._dx=n.x-t.x,this._dy=n.y-t.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(n,t,i){return this._dx=n.x-t,this._dy=n.y-i,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(n,t){return t=t||this.game.input.activePointer,this._dx=n.x-t.x,this._dy=n.y-t.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(n,t){return this._dx=t.x-n.x,this._dy=t.y-n.y,Math.atan2(this._dy,this._dx)},angleToXY:function(n,t,i){return this._dx=t-n.x,this._dy=i-n.y,Math.atan2(this._dy,this._dx)},angleToPointer:function(n,t){return t=t||this.game.input.activePointer,this._dx=t.worldX-n.x,this._dy=t.worldY-n.y,Math.atan2(this._dy,this._dx)}},n.Physics.Arcade.prototype.constructor=n.Physics.Arcade,n.Physics.Arcade.Body=function(t){this.sprite=t;this.game=t.game;this.offset=new n.Point;this.preX=t.world.x;this.preY=t.world.y;this.preRotation=t.angle;this.velocity=new n.Point;this.acceleration=new n.Point;this.speed=0;this.angle=0;this.gravity=new n.Point;this.bounce=new n.Point;this.minVelocity=new n.Point;this.maxVelocity=new n.Point(1e3,1e3);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.linearDamping=0;this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={x:0,y:0,up:!1,down:!1,left:!1,right:!1};this.facing=n.NONE;this.rebound=!0;this.immovable=!1;this.moves=!0;this.rotation=0;this.allowRotation=!0;this.allowGravity=!0;this.customSeparateCallback=null;this.customSeparateContext=null;this.collideCallback=null;this.collideCallbackContext=null;this.collideWorldBounds=!1;this.type=n.Physics.Arcade.RECT;this.shape=null;this.polygon=null;this.left=0;this.right=0;this.top=0;this.bottom=0;this.width=0;this.height=0;this.contacts=[];this.overlapX=0;this.overlapY=0;this._temp=null;this._dx=0;this._dy=0;this._sx=t.scale.x;this._sy=t.scale.y;this._distances=[0,0,0,0];this._vx=0;this._vy=0;this.setRectangle(t.width,t.height,0,0);this.sprite.events.onBeginContact=new n.Signal;this.sprite.events.onEndContact=new n.Signal},n.Physics.Arcade.Body.prototype={updateScale:function(){this.polygon?this.polygon.scale(this.sprite.scale.x/this._sx,this.sprite.scale.y/this._sy):this.shape.r*=Math.max(this.sprite.scale.x,this.sprite.scale.y);this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y},preUpdate:function(){this.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.offset.x;this.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.offset.y;this.preX=this.x;this.preY=this.y;this.preRotation=this.sprite.angle;this.rotation=this.preRotation;(this.sprite.scale.x!==this._sx||this.sprite.scale.y!==this._sy)&&this.updateScale();this.checkBlocked();this.touching.none=!0;this.touching.up=!1;this.touching.down=!1;this.touching.left=!1;this.touching.right=!1;this.moves?((this._vx!==this.velocity.x||this._vy!==this.velocity.y)&&(this._vx=this.velocity.x,this._vy=this.velocity.y,this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.game.physics.checkBounds(this)&&this.reboundCheck(!0,!0,!0),this.applyDamping(),this.integrateVelocity(),this.updateBounds(),this.checkBlocked()):this.updateBounds()},checkBlocked:function(){(this.blocked.left||this.blocked.right)&&(Math.floor(this.x)!==this.blocked.x||Math.floor(this.y)!==this.blocked.y)&&(this.blocked.left=!1,this.blocked.right=!1);(this.blocked.up||this.blocked.down)&&(Math.floor(this.x)!==this.blocked.x||Math.floor(this.y)!==this.blocked.y)&&(this.blocked.up=!1,this.blocked.down=!1)},updateBounds:function(){this.type===n.Physics.Arcade.CIRCLE?(this.left=this.shape.pos.x-this.shape.r,this.right=this.shape.pos.x+this.shape.r,this.top=this.shape.pos.y-this.shape.r,this.bottom=this.shape.pos.y+this.shape.r):(this.left=n.Math.minProperty("x",this.polygon.points)+this.polygon.pos.x,this.right=n.Math.maxProperty("x",this.polygon.points)+this.polygon.pos.x,this.top=n.Math.minProperty("y",this.polygon.points)+this.polygon.pos.y,this.bottom=n.Math.maxProperty("y",this.polygon.points)+this.polygon.pos.y);this.width=this.right-this.left;this.height=this.bottom-this.top},applyDamping:function(){this.linearDamping>0&&this.acceleration.isZero()&&(this.speed>this.linearDamping?this.speed-=this.linearDamping:this.speed=0,this.speed>0&&(this.velocity.x=Math.cos(this.angle)*this.speed,this.velocity.y=Math.sin(this.angle)*this.speed,this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)))},reboundCheck:function(n,t,i){var r,u;n&&(i&&this.bounce.x!==0&&(this.blocked.left||this.blocked.right||this.touching.left||this.touching.right)&&(this._vx<=0&&this.velocity.x>0||this._vx>=0&&this.velocity.x<0||(this.velocity.x*=-this.bounce.x,this.angle=Math.atan2(this.velocity.y,this.velocity.x))),(this.bounce.x===0||Math.abs(this.velocity.x)<this.minVelocity.x)&&(r=this.getUpwardForce(),((this.blocked.left||this.touching.left)&&(r<0||this.velocity.x<0)||(this.blocked.right||this.touching.right)&&(r>0||this.velocity.x>0))&&(this.velocity.x=0)));t&&(i&&this.bounce.y!==0&&(this.blocked.up||this.blocked.down||this.touching.up||this.touching.down)&&(this._vy<=0&&this.velocity.y>0||this._vy>=0&&this.velocity.y<0||(this.velocity.y*=-this.bounce.y,this.angle=Math.atan2(this.velocity.y,this.velocity.x))),(this.bounce.y===0||Math.abs(this.velocity.y)<this.minVelocity.y)&&(u=this.getDownwardForce(),((this.blocked.up||this.touching.up)&&(u<0||this.velocity.y<0)||(this.blocked.down||this.touching.down)&&(u>0||this.velocity.y>0))&&(this.velocity.y=0)))},getUpwardForce:function(){return this.allowGravity?this.gravity.x+this.game.physics.gravity.x+this.velocity.x:this.gravity.x+this.velocity.x},getDownwardForce:function(){return this.allowGravity?this.gravity.y+this.game.physics.gravity.y+this.velocity.y:this.gravity.y+this.velocity.y},sub:function(n){this.x-=n.x;this.y-=n.y},add:function(n){this.x+=n.x;this.y+=n.y},give:function(n,t){this.add(t.overlapV);this.rebound&&(this.processRebound(n),this.reboundCheck(!0,!0,!1),n.reboundCheck(!0,!0,!1))},take:function(n,t){this.sub(t.overlapV);this.rebound&&(this.processRebound(n),this.reboundCheck(!0,!0,!1),n.reboundCheck(!0,!0,!1))},split:function(n,t){t.overlapV.scale(.5);this.sub(t.overlapV);n.add(t.overlapV);this.rebound&&(this.exchange(n),this.reboundCheck(!0,!0,!1),n.reboundCheck(!0,!0,!1))},exchange:function(n){if(this.mass===n.mass&&this.speed>0&&n.speed>0)this._dx=n.velocity.x,this._dy=n.velocity.y,n.velocity.x=this.velocity.x*n.bounce.x,n.velocity.y=this.velocity.y*n.bounce.x,this.velocity.x=this._dx*this.bounce.x,this.velocity.y=this._dy*this.bounce.y;else{var t=Math.sqrt(n.velocity.x*n.velocity.x*n.mass/this.mass)*(n.velocity.x>0?1:-1),i=Math.sqrt(this.velocity.x*this.velocity.x*this.mass/n.mass)*(this.velocity.x>0?1:-1),r=(t+i)*.5;t-=r;i-=r;this.velocity.x=t;n.velocity.x=i;t=Math.sqrt(n.velocity.y*n.velocity.y*n.mass/this.mass)*(n.velocity.y>0?1:-1);i=Math.sqrt(this.velocity.y*this.velocity.y*this.mass/n.mass)*(this.velocity.y>0?1:-1);r=(t+i)*.5;t-=r;i-=r;this.velocity.y=t;n.velocity.y=i}},processRebound:function(n){this._vx<=0&&this.velocity.x>0||this._vx>=0&&this.velocity.x<0||(this.velocity.x=n.velocity.x-this.velocity.x*this.bounce.x);this._vy<=0&&this.velocity.y>0||this._vy>=0&&this.velocity.y<0||(this.velocity.y=n.velocity.y-this.velocity.y*this.bounce.y);this.angle=Math.atan2(this.velocity.y,this.velocity.x);this.reboundCheck(!0,!0,!1)},overlap:function(t,r){var u=!1;return(this.type===n.Physics.Arcade.RECT||this.type===n.Physics.Arcade.POLYGON)&&(t.type===n.Physics.Arcade.RECT||t.type===n.Physics.Arcade.POLYGON)?u=i.testPolygonPolygon(this.polygon,t.polygon,r):this.type===n.Physics.Arcade.CIRCLE&&t.type===n.Physics.Arcade.CIRCLE?u=i.testCircleCircle(this.shape,t.shape,r):(this.type===n.Physics.Arcade.RECT||this.type===n.Physics.Arcade.POLYGON)&&t.type===n.Physics.Arcade.CIRCLE?u=i.testPolygonCircle(this.polygon,t.shape,r):this.type===n.Physics.Arcade.CIRCLE&&(t.type===n.Physics.Arcade.RECT||t.type===n.Physics.Arcade.POLYGON)&&(u=i.testCirclePolygon(this.shape,t.polygon,r)),u||this.removeContact(t),u},inContact:function(n){return this.contacts.indexOf(n)!=-1},addContact:function(n){return this.inContact(n)?!1:(this.contacts.push(n),this.sprite.events.onBeginContact.dispatch(this.sprite,n.sprite,this,n),n.addContact(this),!0)},removeContact:function(n){return this.inContact(n)?(this.contacts.splice(this.contacts.indexOf(n),1),this.sprite.events.onEndContact.dispatch(this.sprite,n.sprite,this,n),n.removeContact(this),!0):!1},separate:function(n,t){if(this._distances[0]=n.right-this.x,this._distances[1]=this.right-n.x,this._distances[2]=n.bottom-this.y,this._distances[3]=this.bottom-n.y,t.overlapN.x&&(this._distances[0]===0||this._distances[1]===0)?(t.overlapN.x=!1,t.overlapN.y=!0):t.overlapN.y&&(this._distances[2]===0||this._distances[3]===0)&&(t.overlapN.x=!0,t.overlapN.y=!1),this.customSeparateCallback)return this.customSeparateCallback.call(this.customSeparateContext,this,t,this._distances);var i=!1;return t.overlapN.x?this._distances[0]<this._distances[1]?i=this.hitLeft(n,t):this._distances[1]<this._distances[0]&&(i=this.hitRight(n,t)):t.overlapN.y&&(this._distances[2]<this._distances[3]?i=this.hitTop(n,t):this._distances[3]<this._distances[2]&&(i=this.hitBottom(n,t))),i?(this.game.physics.checkBounds(this),this.game.physics.checkBounds(n)):this.checkCollision.up&&this.checkCollision.down&&this.checkCollision.left&&this.checkCollision.right&&n.checkCollision.up&&n.checkCollision.down&&n.checkCollision.left&&n.checkCollision.right||this.addContact(n),i},hitLeft:function(t,i){return!this.checkCollision.left||!t.checkCollision.right?!1:this.collideCallback&&!this.collideCallback.call(this.collideCallbackContext,n.LEFT,this,t,i)?!1:(!this.moves||this.immovable||this.blocked.right||this.touching.right?t.give(this,i):t.immovable||t.blocked.left||t.touching.left?this.take(t,i):this.split(t,i),this.touching.left=!0,t.touching.right=!0,!0)},hitRight:function(t,i){return!this.checkCollision.right||!t.checkCollision.left?!1:this.collideCallback&&!this.collideCallback.call(this.collideCallbackContext,n.RIGHT,this,t)?!1:(!this.moves||this.immovable||this.blocked.left||this.touching.left?t.give(this,i):t.immovable||t.blocked.right||t.touching.right?this.take(t,i):this.split(t,i),this.touching.right=!0,t.touching.left=!0,!0)},hitTop:function(t,i){return!this.checkCollision.up||!t.checkCollision.down?!1:this.collideCallback&&!this.collideCallback.call(this.collideCallbackContext,n.UP,this,t)?!1:(!this.moves||this.immovable||this.blocked.down||this.touching.down?t.give(this,i):t.immovable||t.blocked.up||t.touching.up?this.take(t,i):this.split(t,i),this.touching.up=!0,t.touching.down=!0,!0)},hitBottom:function(t,i){return!this.checkCollision.down||!t.checkCollision.up?!1:this.collideCallback&&!this.collideCallback.call(this.collideCallbackContext,n.DOWN,this,t)?!1:(!this.moves||this.immovable||this.blocked.up||this.touching.up?t.give(this,i):t.immovable||t.blocked.down||t.touching.down?this.take(t,i):this.split(t,i),this.touching.down=!0,t.touching.up=!0,!0)},integrateVelocity:function(){this._temp=this.game.physics.updateMotion(this);this._dx=this.game.time.physicsElapsed*(this.velocity.x+this._temp.x/2);this._dy=this.game.time.physicsElapsed*(this.velocity.y+this._temp.y/2);(this._dx<0&&!this.blocked.left&&!this.touching.left||this._dx>0&&!this.blocked.right&&!this.touching.right)&&(this.x+=this._dx,this.velocity.x+=this._temp.x);(this._dy<0&&!this.blocked.up&&!this.touching.up||this._dy>0&&!this.blocked.down&&!this.touching.down)&&(this.y+=this._dy,this.velocity.y+=this._temp.y);this.velocity.x>this.maxVelocity.x?this.velocity.x=this.maxVelocity.x:this.velocity.x<-this.maxVelocity.x&&(this.velocity.x=-this.maxVelocity.x);this.velocity.y>this.maxVelocity.y?this.velocity.y=this.maxVelocity.y:this.velocity.y<-this.maxVelocity.y&&(this.velocity.y=-this.maxVelocity.y)},postUpdate:function(){this.moves&&(this.game.physics.checkBounds(this),this.reboundCheck(!0,!0,!0),this._dx=this.deltaX(),this._dy=this.deltaY(),this._dx<0?this.facing=n.LEFT:this._dx>0&&(this.facing=n.RIGHT),this._dy<0?this.facing=n.UP:this._dy>0&&(this.facing=n.DOWN),(this._dx!==0||this._dy!==0)&&(this.sprite.x+=this._dx,this.sprite.y+=this._dy),this.allowRotation&&this.deltaZ()!==0&&(this.sprite.angle+=this.deltaZ()),(this.sprite.scale.x!==this._sx||this.sprite.scale.y!==this._sy)&&this.updateScale())},reset:function(n){typeof n=="undefined"&&(n=!1);n&&(this.gravity.setTo(0,0),this.bounce.setTo(0,0),this.minVelocity.setTo(5,5),this.maxVelocity.setTo(1e3,1e3),this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.friction=0,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0});this.velocity.setTo(0,0);this.acceleration.setTo(0,0);this.angularVelocity=0;this.angularAcceleration=0;this.blocked={x:0,y:0,up:!1,down:!1,left:!1,right:!1};this.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.offset.x;this.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.offset.y;this.preX=this.x;this.preY=this.y;this.updateBounds();this.contacts.length=0},destroy:function(){this.sprite=null;this.collideCallback=null;this.collideCallbackContext=null;this.customSeparateCallback=null;this.customSeparateContext=null;this.contacts.length=0},setCircle:function(t,r,u){typeof r=="undefined"&&(r=this.sprite._cache.halfWidth);typeof u=="undefined"&&(u=this.sprite._cache.halfHeight);this.type=n.Physics.Arcade.CIRCLE;this.shape=new i.Circle(new i.Vector(this.sprite.x,this.sprite.y),t);this.polygon=null;this.offset.setTo(r,u)},setRectangle:function(t,r,u,f){typeof t=="undefined"&&(t=this.sprite.width);typeof r=="undefined"&&(r=this.sprite.height);typeof u=="undefined"&&(u=-this.sprite._cache.halfWidth);typeof f=="undefined"&&(f=-this.sprite._cache.halfHeight);this.type=n.Physics.Arcade.RECT;this.shape=new i.Box(new i.Vector(this.sprite.world.x,this.sprite.world.y),t,r);this.polygon=this.shape.toPolygon();this.polygon.translate(u,f);this.offset.setTo(0,0)},setPolygon:function(t){var u,r,f;if(this.type=n.Physics.Arcade.POLYGON,this.shape=null,Array.isArray(t)||(t=Array.prototype.slice.call(arguments)),typeof t[0]=="number"){for(u=[],r=0,f=t.length;r<f;r+=2)u.push(new i.Vector(t[r],t[r+1]));t=u}this.polygon=new i.Polygon(new i.Vector(this.sprite.center.x,this.sprite.center.y),t);this.offset.setTo(0,0)},translate:function(n,t){this.polygon&&this.polygon.translate(n,t)},onFloor:function(){return this.blocked.down},onWall:function(){return!this.blocked.down&&(this.blocked.left||this.blocked.right)},deltaX:function(){return this.x-this.preX},deltaY:function(){return this.y-this.preY},deltaZ:function(){return this.rotation-this.preRotation}},n.Physics.Arcade.Body.prototype.constructor=n.Physics.Arcade.Body,Object.defineProperty(n.Physics.Arcade.Body.prototype,"x",{get:function(){return this.type===n.Physics.Arcade.CIRCLE?this.shape.pos.x:this.polygon.pos.x},set:function(t){this.type===n.Physics.Arcade.CIRCLE?this.shape.pos.x=t:this.polygon.pos.x=t}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"y",{get:function(){return this.type===n.Physics.Arcade.CIRCLE?this.shape.pos.y:this.polygon.pos.y},set:function(t){this.type===n.Physics.Arcade.CIRCLE?this.shape.pos.y=t:this.polygon.pos.y=t}}),n.Particles=function(n){this.game=n;this.emitters={};this.ID=0},n.Particles.prototype={add:function(n){return this.emitters[n.name]=n,n},remove:function(n){delete this.emitters[n.name]},update:function(){for(var n in this.emitters)this.emitters[n].exists&&this.emitters[n].update()}},n.Particles.prototype.constructor=n.Particles,n.Particles.Arcade={},n.Particles.Arcade.Emitter=function(t,i,r,u){this.maxParticles=u||50;n.Group.call(this,t);this.name="emitter"+this.game.particles.ID++;this.type=n.EMITTER;this.x=0;this.y=0;this.width=1;this.height=1;this.minParticleSpeed=new n.Point(-100,-100);this.maxParticleSpeed=new n.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.minRotation=-360;this.maxRotation=360;this.gravity=100;this.particleClass=null;this.particleFriction=0;this.angularDrag=0;this.frequency=100;this.lifespan=2e3;this.bounce=new n.Point;this._quantity=0;this._timer=0;this._counter=0;this._explode=!0;this.on=!1;this.exists=!0;this.emitX=i;this.emitY=r},n.Particles.Arcade.Emitter.prototype=Object.create(n.Group.prototype),n.Particles.Arcade.Emitter.prototype.constructor=n.Particles.Arcade.Emitter,n.Particles.Arcade.Emitter.prototype.update=function(){if(this.on)if(this._explode){this._counter=0;do this.emitParticle(),this._counter++;while(this._counter<this._quantity);this.on=!1}else this.game.time.now>=this._timer&&(this.emitParticle(),this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1),this._timer=this.game.time.now+this.frequency)},n.Particles.Arcade.Emitter.prototype.makeParticles=function(t,i,r,u,f){typeof i=="undefined"&&(i=0);typeof r=="undefined"&&(r=this.maxParticles);typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=!1);for(var e,o=0,s=t,h=i;o<r;)this.particleClass===null&&(typeof t=="object"&&(s=this.game.rnd.pick(t)),typeof i=="object"&&(h=this.game.rnd.pick(i)),e=new n.Sprite(this.game,0,0,s,h)),u?(e.body.checkCollision.any=!0,e.body.checkCollision.none=!1):e.body.checkCollision.none=!0,e.body.collideWorldBounds=f,e.exists=!1,e.visible=!1,e.anchor.setTo(.5,.5),this.add(e),o++;return this},n.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1;this.alive=!1;this.exists=!1},n.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0;this.exists=!0},n.Particles.Arcade.Emitter.prototype.start=function(n,t,i,r){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=250);typeof r=="undefined"&&(r=0);this.revive();this.visible=!0;this.on=!0;this._explode=n;this.lifespan=t;this.frequency=i;n?this._quantity=r:this._quantity+=r;this._counter=0;this._timer=this.game.time.now+i},n.Particles.Arcade.Emitter.prototype.emitParticle=function(){var n=this.getFirstExists(!1),t;n!=null&&(this.width>1||this.height>1?n.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):n.reset(this.emitX,this.emitY),n.lifespan=this.lifespan,n.body.bounce.setTo(this.bounce.x,this.bounce.y),n.body.velocity.x=this.minParticleSpeed.x!=this.maxParticleSpeed.x?this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x):this.minParticleSpeed.x,n.body.velocity.y=this.minParticleSpeed.y!=this.maxParticleSpeed.y?this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y):this.minParticleSpeed.y,n.body.gravity.y=this.gravity,n.body.angularVelocity=this.minRotation!=this.maxRotation?this.game.rnd.integerInRange(this.minRotation,this.maxRotation):this.minRotation,(this.minParticleScale!==1||this.maxParticleScale!==1)&&(t=this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale),n.scale.setTo(t,t)),n.body.friction=this.particleFriction,n.body.angularDrag=this.angularDrag)},n.Particles.Arcade.Emitter.prototype.setSize=function(n,t){this.width=n;this.height=t},n.Particles.Arcade.Emitter.prototype.setXSpeed=function(n,t){n=n||0;t=t||0;this.minParticleSpeed.x=n;this.maxParticleSpeed.x=t},n.Particles.Arcade.Emitter.prototype.setYSpeed=function(n,t){n=n||0;t=t||0;this.minParticleSpeed.y=n;this.maxParticleSpeed.y=t},n.Particles.Arcade.Emitter.prototype.setRotation=function(n,t){n=n||0;t=t||0;this.minRotation=n;this.maxRotation=t},n.Particles.Arcade.Emitter.prototype.at=function(n){n.center&&(this.emitX=n.center.x,this.emitY=n.center.y)},Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"alpha",{get:function(){return this._container.alpha},set:function(n){this._container.alpha=n}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"visible",{get:function(){return this._container.visible},set:function(n){this._container.visible=n}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(n){this.emitX=n}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(n){this.emitY=n}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.width/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.width/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.height/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.height/2)}}),n.Tile=function(n,t,i,r,u,f){this.layer=n;this.index=t;this.x=i;this.y=r;this.width=u;this.height=f;this.alpha=1;this.properties={};this.scanned=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1;this.collides=!1;this.collideNone=!0;this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.callback=null;this.callbackContext=this},n.Tile.prototype={setCollisionCallback:function(n,t){this.collisionCallbackContext=t;this.collisionCallback=n},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(n,t,i,r){this.collideLeft=n;this.collideRight=t;this.collideUp=i;this.collideDown=r;this.collideNone=n||t||i||r?!1:!0},resetCollision:function(){this.collideNone=!0;this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1},copy:function(n){this.index=n.index;this.alpha=n.alpha;this.properties=n.properties;this.collides=n.collides;this.collideNone=n.collideNone;this.collideUp=n.collideUp;this.collideDown=n.collideDown;this.collideLeft=n.collideLeft;this.collideRight=n.collideRight;this.collisionCallback=n.collisionCallback;this.collisionCallbackContext=n.collisionCallbackContext}},n.Tile.prototype.constructor=n.Tile,Object.defineProperty(n.Tile.prototype,"canCollide",{get:function(){return this.collides||this.collisionCallback||this.layer.callbacks[this.index]}}),Object.defineProperty(n.Tile.prototype,"left",{get:function(){return this.x}}),Object.defineProperty(n.Tile.prototype,"right",{get:function(){return this.x+this.width}}),Object.defineProperty(n.Tile.prototype,"top",{get:function(){return this.y}}),Object.defineProperty(n.Tile.prototype,"bottom",{get:function(){return this.y+this.height}}),n.Tilemap=function(t,i){this.game=t;this.key=i;var r=n.TilemapParser.parse(this.game,i);r!==null&&(this.width=r.width,this.height=r.height,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.orientation=r.orientation,this.version=r.version,this.properties=r.properties,this.widthInPixels=r.widthInPixels,this.heightInPixels=r.heightInPixels,this.layers=r.layers,this.tilesets=r.tilesets,this.tiles=r.tiles,this.objects=r.objects,this.images=r.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},n.Tilemap.CSV=0,n.Tilemap.TILED_JSON=1,n.Tilemap.prototype={create:function(t,i,r){for(var f,e=[],u=0;u<r;u++)for(e[u]=[],f=0;f<i;f++)e[u][f]=0;this.layers.push({name:t,width:i,height:r,alpha:1,visible:!0,tileMargin:0,tileSpacing:0,format:n.Tilemap.CSV,data:e,indexes:[],dirty:!0});this.currentLayer=this.layers.length-1},addTilesetImage:function(n,t){if(typeof t=="undefined")if(typeof n=="string")t=n;else return!1;return(typeof n=="string"&&(n=this.getTilesetIndex(n)),this.tilesets[n])?(this.tilesets[n].image=this.game.cache.getImage(t),!0):!1},createFromObjects:function(n,t,i,r,u,f,e){var s,o,h;if(typeof u=="undefined"&&(u=!0),typeof f=="undefined"&&(f=!0),typeof e=="undefined"&&(e=this.game.world),!this.objects[n]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+n);return}for(o=0,h=this.objects[n].length;o<h;o++)if(this.objects[n][o].gid===t){s=e.create(this.objects[n][o].x,this.objects[n][o].y,i,r,u);s.anchor.setTo(0,1);s.name=this.objects[n][o].name;s.visible=this.objects[n][o].visible;s.autoCull=f;for(property in this.objects[n][o].properties)e.set(s,property,this.objects[n][o].properties[property],!1,!1,0)}},createLayer:function(t,i,r,u){typeof i=="undefined"&&(i=this.game.width);typeof r=="undefined"&&(r=this.game.height);typeof u=="undefined"&&(u=this.game.world);var f=t;if(typeof t=="string"&&(f=this.getLayerIndex(t)),f===null||f>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+f);return}return u.add(new n.TilemapLayer(this.game,this,f,i,r))},getIndex:function(n,t){for(var i=0;i<n.length;i++)if(n[i].name===t)return i;return null},getLayerIndex:function(n){return this.getIndex(this.layers,n)},getTilesetIndex:function(n){return this.getIndex(this.tilesets,n)},getImageIndex:function(n){return this.getIndex(this.images,n)},getObjectIndex:function(n){return this.getIndex(this.objects,n)},setTileIndexCallback:function(n,t,i,r){if(r=this.getLayer(r),typeof n=="number")this.layers[r].callbacks[n]={callback:t,callbackContext:i};else for(var u=0,f=n.length;u<f;u++)this.layers[r].callbacks[n[u]]={callback:t,callbackContext:i}},setTileLocationCallback:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(n,t,i,r,e),!(this._results.length<2))for(var o=1;o<this._results.length;o++)this._results[o].setCollisionCallback(u,f)},setCollision:function(n,t,i){if(typeof t=="undefined"&&(t=!0),i=this.getLayer(i),typeof n=="number")return this.setCollisionByIndex(n,t,i,!0);for(var r=0,u=n.length;r<u;r++)this.setCollisionByIndex(n[r],t,i,!1);this.calculateFaces(i)},setCollisionBetween:function(n,t,i,r){if(typeof i=="undefined"&&(i=!0),r=this.getLayer(r),!(n>t)){for(var u=n;u<=t;u++)this.setCollisionByIndex(u,i,r,!1);this.calculateFaces(r)}},setCollisionByExclusion:function(n,t,i){typeof t=="undefined"&&(t=!0);i=this.getLayer(i);for(var r=0,u=this.tiles.length;r<u;r++)n.indexOf(r)===-1&&this.setCollisionByIndex(r,t,i,!1);this.calculateFaces(i)},setCollisionByIndex:function(n,t,i,r){var f,e,u;for(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=this.currentLayer),typeof r=="undefined"&&(r=!0),f=0;f<this.layers[i].height;f++)for(e=0;e<this.layers[i].width;e++)u=this.layers[i].data[f][e],u&&u.index===n&&(u.collides=t,u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t);return r&&this.calculateFaces(i),i},getLayer:function(t){return typeof t=="undefined"?t=this.currentLayer:typeof t=="string"?t=this.getLayerIndex(t):t instanceof n.TilemapLayer&&(t=t.index),t},calculateFaces:function(n){for(var t,s,r,u=null,f=null,e=null,o=null,i=0,h=this.layers[n].height;i<h;i++)for(t=0,s=this.layers[n].width;t<s;t++)r=this.layers[n].data[i][t],r&&(u=this.getTileAbove(n,t,i),f=this.getTileBelow(n,t,i),e=this.getTileLeft(n,t,i),o=this.getTileRight(n,t,i),u&&u.collides&&(r.faceTop=!1),f&&f.collides&&(r.faceBottom=!1),e&&e.collides&&(r.faceLeft=!1),o&&o.collides&&(r.faceRight=!1))},getTileAbove:function(n,t,i){return i>0?this.layers[n].data[i-1][t]:null},getTileBelow:function(n,t,i){return i<this.layers[n].height-1?this.layers[n].data[i+1][t]:null},getTileLeft:function(n,t,i){return t>0?this.layers[n].data[i][t-1]:null},getTileRight:function(n,t,i){return t<this.layers[n].width-1?this.layers[n].data[i][t+1]:null},setLayer:function(n){n=this.getLayer(n);this.layers[n]&&(this.currentLayer=n)},putTile:function(t,i,r,u){u=this.getLayer(u);i>=0&&i<this.layers[u].width&&r>=0&&r<this.layers[u].height&&(t instanceof n.Tile?this.layers[u].data[r][i].copy(t):this.layers[u].data[r][i].index=t,this.layers[u].dirty=!0,this.calculateFaces(u))},putTileWorldXY:function(n,t,i,r,u,f){f=this.getLayer(f);t=this.game.math.snapToFloor(t,r)/r;i=this.game.math.snapToFloor(i,u)/u;this.putTile(n,t,i,f)},getTile:function(n,t,i){return i=this.getLayer(i),n>=0&&n<this.layers[i].width&&t>=0&&t<this.layers[i].height?this.layers[i].data[t][n]:void 0},getTileWorldXY:function(n,t,i,r,u){return u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.getTile(n,t,u)},copy:function(n,t,i,r,u){var f,e;if(u=this.getLayer(u),!this.layers[u]){this._results.length=0;return}for(typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=this.layers[u].width),typeof r=="undefined"&&(r=this.layers[u].height),n<0&&(n=0),t<0&&(t=0),i>this.layers[u].width&&(i=this.layers[u].width),r>this.layers[u].height&&(r=this.layers[u].height),this._results.length=0,this._results.push({x:n,y:t,width:i,height:r,layer:u}),f=t;f<t+r;f++)for(e=n;e<n+i;e++)this._results.push(this.layers[u].data[f][e]);return this._results},paste:function(n,t,i,r){var f,e,u;if(typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),r=this.getLayer(r),i&&!(i.length<2)){for(f=n-i[1].x,e=t-i[1].y,u=1;u<i.length;u++)this.layers[r].data[e+i[u].y][f+i[u].x].copy(i[u]);this.layers[r].dirty=!0;this.calculateFaces(r)}},swap:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._tempA=n,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(i,r,this._results,e))},swapHandler:function(n,t){n.index===this._tempA?this._results[t].index=this._tempB:n.index===this._tempB&&(this._results[t].index=this._tempA)},forEach:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._results.forEach(n,t),this.paste(i,r,this._results,e))},replace:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(i,r,u,f,e),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index===n&&(this._results[o].index=t);this.paste(i,r,this._results,e)}},random:function(n,t,i,r,u){var e,f,s,o;if(u=this.getLayer(u),this.copy(n,t,i,r,u),!(this._results.length<2)){for(e=[],f=1;f<this._results.length;f++)this._results[f].index&&(s=this._results[f].index,e.indexOf(s)===-1&&e.push(s));for(o=1;o<this._results.length;o++)this._results[o].index=this.game.rnd.pick(e);this.paste(n,t,this._results,u)}},shuffle:function(t,i,r,u,f){var s,e,o;if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(s=[],e=1;e<this._results.length;e++)this._results[e].index&&s.push(this._results[e].index);for(n.Utils.shuffle(s),o=1;o<this._results.length;o++)this._results[o].index=s[o-1];this.paste(t,i,this._results,f)}},fill:function(n,t,i,r,u,f){if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(var e=1;e<this._results.length;e++)this._results[e].index=n;this.paste(t,i,this._results,f)}},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){for(var n,r="",t=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(n=0;n<this.layers[this.currentLayer].width;n++)r+="%c  ",this.layers[this.currentLayer].data[i][n]>1?this.debugMap[this.layers[this.currentLayer].data[i][n]]?t.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):t.push("background: #ffffff"):t.push("background: rgb(0, 0, 0)");r+="\n"}t[0]=r;console.log.apply(console,t)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}},n.Tilemap.prototype.constructor=n.Tilemap,n.TilemapLayer=function(i,r,u,f,e){this.game=i;this.map=r;this.index=u;this.layer=r.layers[u];this.canvas=n.Canvas.create(f,e);this.context=this.canvas.getContext("2d");this.baseTexture=new t.BaseTexture(this.canvas);this.texture=new t.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,f,e,"tilemapLayer",i.rnd.uuid());n.Sprite.call(this,this.game,0,0,this.texture,this.textureFrame);this.name="";this.type=n.TILEMAPLAYER;this.fixedToCamera=!0;this.cameraOffset=new n.Point(0,0);this.tileColor="rgb(255, 255, 255)";this.debug=!1;this.debugAlpha=.5;this.debugColor="rgba(0, 255, 0, 1)";this.debugFill=!1;this.debugFillColor="rgba(0, 255, 0, 0.2)";this.debugCallbackColor="rgba(255, 0, 0, 1)";this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=!0;this._cw=r.tileWidth;this._ch=r.tileHeight;this._ga=1;this._dx=0;this._dy=0;this._dw=0;this._dh=0;this._tx=0;this._ty=0;this._tw=0;this._th=0;this._tl=0;this._maxX=0;this._maxY=0;this._startX=0;this._startY=0;this._results=[];this._x=0;this._y=0;this._prevX=0;this._prevY=0;this.updateMax()},n.TilemapLayer.prototype=Object.create(n.Sprite.prototype),n.TilemapLayer.prototype=n.Utils.extend(!0,n.TilemapLayer.prototype,n.Sprite.prototype,t.Sprite.prototype),n.TilemapLayer.prototype.constructor=n.TilemapLayer,n.TilemapLayer.prototype.postUpdate=function(){n.Sprite.prototype.postUpdate.call(this);this.scrollX=this.game.camera.x*this.scrollFactorX;this.scrollY=this.game.camera.y*this.scrollFactorY;this.render()},n.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)},n.TilemapLayer.prototype._fixX=function(n){return(n<0&&(n=0),this.scrollFactorX===1)?n:this._x+(n-this._x/this.scrollFactorX)},n.TilemapLayer.prototype._unfixX=function(n){return this.scrollFactorX===1?n:this._x/this.scrollFactorX+(n-this._x)},n.TilemapLayer.prototype._fixY=function(n){return(n<0&&(n=0),this.scrollFactorY===1)?n:this._y+(n-this._y/this.scrollFactorY)},n.TilemapLayer.prototype._unfixY=function(n){return this.scrollFactorY===1?n:this._y/this.scrollFactorY+(n-this._y)},n.TilemapLayer.prototype.getTileX=function(n){return this.game.math.snapToFloor(this._fixX(n),this.map.tileWidth)/this.map.tileWidth},n.TilemapLayer.prototype.getTileY=function(n){return this.game.math.snapToFloor(this._fixY(n),this.map.tileHeight)/this.map.tileHeight},n.TilemapLayer.prototype.getTileXY=function(n,t,i){return i.x=this.getTileX(n),i.y=this.getTileY(t),i},n.TilemapLayer.prototype.getTiles=function(n,t,i,r,u){var f,e,o,s;for(typeof u=="undefined"&&(u=!1),n=this._fixX(n),t=this._fixY(t),i>this.layer.widthInPixels&&(i=this.layer.widthInPixels),r>this.layer.heightInPixels&&(r=this.layer.heightInPixels),this._tx=this.game.math.snapToFloor(n,this._cw)/this._cw,this._ty=this.game.math.snapToFloor(t,this._ch)/this._ch,this._tw=(this.game.math.snapToCeil(i,this._cw)+this._cw)/this._cw,this._th=(this.game.math.snapToCeil(r,this._ch)+this._ch)/this._ch,this._results.length=0,f=this._ty;f<this._ty+this._th;f++)for(e=this._tx;e<this._tx+this._tw;e++)this.layer.data[f]&&this.layer.data[f][e]&&(u===!1||u&&this.layer.data[f][e].canCollide)&&(o=this._unfixX(e*this._cw)/this._cw,s=this._unfixY(f*this._ch)/this._ch,this._results.push({x:o*this._cw,y:s*this._ch,right:o*this._cw+this._cw,bottom:s*this._ch+this._ch,tile:this.layer.data[f][e],layer:this.layer.data[f][e].layer}));return this._results},n.TilemapLayer.prototype.updateMax=function(){this._maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1;this._maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1;this.layer&&(this._maxX>this.layer.width&&(this._maxX=this.layer.width),this._maxY>this.layer.height&&(this._maxY=this.layer.height));this.dirty=!0},n.TilemapLayer.prototype.render=function(){var i,r,s,h,f,e,u,o;if(this.layer.dirty&&(this.dirty=!0),this.dirty&&this.visible){for(this._prevX=this._dx,this._prevY=this._dy,this._dx=-(this._x-this._startX*this.map.tileWidth),this._dy=-(this._y-this._startY*this.map.tileHeight),this._tx=this._dx,this._ty=this._dy,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.tileColor,s=0,h=0,this.debug&&(this.context.globalAlpha=this.debugAlpha),f=this._startY,e=this._startY+this._maxY;f<e;f++){for(this._column=this.layer.data[f],u=this._startX,o=this._startX+this._maxX;u<o;u++)this._column[u]&&(i=this._column[u],this.map.tiles[i.index]&&(r=this.map.tilesets[this.map.tiles[i.index][2]],r.image?(this.debug===!1&&i.alpha!==this.context.globalAlpha&&(this.context.globalAlpha=i.alpha),r.tileWidth!==this.map.tileWidth||r.tileHeight!==this.map.tileHeight?this.context.drawImage(this.map.tilesets[this.map.tiles[i.index][2]].image,this.map.tiles[i.index][0],this.map.tiles[i.index][1],r.tileWidth,r.tileHeight,Math.floor(this._tx),Math.floor(this._ty)-(r.tileHeight-this.map.tileHeight),r.tileWidth,r.tileHeight):this.context.drawImage(this.map.tilesets[this.map.tiles[i.index][2]].image,this.map.tiles[i.index][0],this.map.tiles[i.index][1],this.map.tileWidth,this.map.tileHeight,Math.floor(this._tx),Math.floor(this._ty),this.map.tileWidth,this.map.tileHeight),i.debug&&(this.context.fillStyle="rgba(0, 255, 0, 0.4)",this.context.fillRect(Math.floor(this._tx),Math.floor(this._ty),this.map.tileWidth,this.map.tileHeight))):this.context.fillRect(Math.floor(this._tx),Math.floor(this._ty),this.map.tileWidth,this.map.tileHeight))),this._tx+=this.map.tileWidth;this._tx=this._dx;this._ty+=this.map.tileHeight}return this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.game.renderType===n.WEBGL&&t.texturesToUpdate.push(this.baseTexture),this.dirty=!1,this.layer.dirty=!1,!0}},n.TilemapLayer.prototype.renderDebug=function(){var t,r,i,u,n;for(this._tx=this._dx,this._ty=this._dy,this.context.strokeStyle=this.debugColor,this.context.fillStyle=this.debugFillColor,t=this._startY,r=this._startY+this._maxY;t<r;t++){for(this._column=this.layer.data[t],i=this._startX,u=this._startX+this._maxX;i<u;i++)n=this._column[i],n&&(n.faceTop||n.faceBottom||n.faceLeft||n.faceRight)&&(this._tx=Math.floor(this._tx),this.debugFill&&this.context.fillRect(this._tx,this._ty,this._cw,this._ch),this.context.beginPath(),n.faceTop&&(this.context.moveTo(this._tx,this._ty),this.context.lineTo(this._tx+this._cw,this._ty)),n.faceBottom&&(this.context.moveTo(this._tx,this._ty+this._ch),this.context.lineTo(this._tx+this._cw,this._ty+this._ch)),n.faceLeft&&(this.context.moveTo(this._tx,this._ty),this.context.lineTo(this._tx,this._ty+this._ch)),n.faceRight&&(this.context.moveTo(this._tx+this._cw,this._ty),this.context.lineTo(this._tx+this._cw,this._ty+this._ch)),this.context.stroke()),n&&(n.collisionCallback||n.layer.callbacks[n.index])&&(this.context.fillStyle=this.debugCallbackColor,this.context.fillRect(this._tx,this._ty,this._cw,this._ch),this.context.fillStyle=this.debugFillColor),this._tx+=this.map.tileWidth;this._tx=this._dx;this._ty+=this.map.tileHeight}},Object.defineProperty(n.TilemapLayer.prototype,"scrollX",{get:function(){return this._x},set:function(n){n!==this._x&&n>=0&&this.layer.widthInPixels>this.width&&(this._x=n,this._x>this.layer.widthInPixels-this.width&&(this._x=this.layer.widthInPixels-this.width),this._startX=this.game.math.floor(this._x/this.map.tileWidth),this._startX<0&&(this._startX=0),this._startX+this._maxX>this.layer.width&&(this._startX=this.layer.width-this._maxX),this.dirty=!0)}}),Object.defineProperty(n.TilemapLayer.prototype,"scrollY",{get:function(){return this._y},set:function(n){n!==this._y&&n>=0&&this.layer.heightInPixels>this.height&&(this._y=n,this._y>this.layer.heightInPixels-this.height&&(this._y=this.layer.heightInPixels-this.height),this._startY=this.game.math.floor(this._y/this.map.tileHeight),this._startY<0&&(this._startY=0),this._startY+this._maxY>this.layer.height&&(this._startY=this.layer.height-this._maxY),this.dirty=!0)}}),Object.defineProperty(n.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._cw},set:function(n){this._cw=n;this.dirty=!0}}),Object.defineProperty(n.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._ch},set:function(n){this._ch=n;this.dirty=!0}}),n.TilemapParser={tileset:function(t,i,r,u,f,e,o,s,h){var c=t.cache.getTilesetImage(i),l,a;return c===null?(console.warn("Phaser.TilemapParser.tileSet: Invalid image key given"),null):(l=c.width,a=c.height,o===-1&&(o=Math.round(l/r)),s===-1&&(s=Math.round(a/u)),h===-1&&(h=o*s),l===0||a===0||l<r||a<u||h===0)?(console.warn("Phaser.TilemapParser.tileSet: width/height zero or width/height < given tileWidth/tileHeight"),null):new n.Tileset(c,i,r,u,f,e,o,s,h)},parse:function(t,i){var r=t.cache.getTilemapData(i);if(r){if(r.format===n.Tilemap.CSV)return this.parseCSV(r.data);if(r.format===n.Tilemap.TILED_JSON)return this.parseTiledJSON(r.data)}else return{layers:[],objects:[],images:[],tilesets:[]}},parseCSV:function(n){var t,r,i;n=n.trim();var u=[],f=n.split("\n"),o=f.length,e=0;for(t=0;t<f.length;t++){for(u[t]=[],r=f[t].split(","),i=0;i<r.length;i++)u[t][i]=parseInt(r[i],10);e===0&&(e=r.length)}return[{name:"csv",width:e,height:o,alpha:1,visible:!0,indexes:[],tileMargin:0,tileSpacing:0,data:u}]},parseTiledJSON:function(t){var u,v,h,p,w,a,f,l,d,b,r,o,i,e;if(t.orientation!=="orthogonal")return console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser"),null;for(u={},u.width=t.width,u.height=t.height,u.tileWidth=t.tilewidth,u.tileHeight=t.tileheight,u.orientation=t.orientation,u.version=t.version,u.properties=t.properties,u.widthInPixels=u.width*u.tileWidth,u.heightInPixels=u.height*u.tileHeight,v=[],i=0;i<t.layers.length;i++)if(t.layers[i].type==="tilelayer"){h={name:t.layers[i].name,x:t.layers[i].x,y:t.layers[i].y,width:t.layers[i].width,height:t.layers[i].height,widthInPixels:t.layers[i].width*t.tilewidth,heightInPixels:t.layers[i].height*t.tileheight,alpha:t.layers[i].opacity,visible:t.layers[i].visible,properties:{},indexes:[],callbacks:[]};t.layers[i].properties&&(h.properties=t.layers[i].properties);var s=0,c=[],y=[];for(e=0,l=t.layers[i].data.length;e<l;e++)t.layers[i].data[e]>0?c.push(new n.Tile(h,t.layers[i].data[e],s,y.length,t.tilewidth,t.tileheight)):c.push(null),s++,s===t.layers[i].width&&(y.push(c),s=0,c=[]);h.data=y;v.push(h)}for(u.layers=v,p=[],i=0;i<t.layers.length;i++)t.layers[i].type==="imagelayer"&&(w={name:t.layers[i].name,image:t.layers[i].image,x:t.layers[i].x,y:t.layers[i].y,alpha:t.layers[i].opacity,visible:t.layers[i].visible,properties:{}},t.layers[i].properties&&(w.properties=t.layers[i].properties),p.push(w));for(u.images=p,a={},i=0;i<t.layers.length;i++)if(t.layers[i].type==="objectgroup")for(a[t.layers[i].name]=[],f=0,l=t.layers[i].objects.length;f<l;f++)t.layers[i].objects[f].gid&&(d={gid:t.layers[i].objects[f].gid,name:t.layers[i].objects[f].name,x:t.layers[i].objects[f].x,y:t.layers[i].objects[f].y,visible:t.layers[i].objects[f].visible,properties:t.layers[i].objects[f].properties},a[t.layers[i].name].push(d));for(u.objects=a,b=[],i=0;i<t.tilesets.length;i++)r=t.tilesets[i],o=new n.Tileset(r.name,r.firstgid,r.tilewidth,r.tileheight,r.margin,r.spacing,r.properties),r.tileproperties&&(o.tileProperties=r.tileproperties),o.rows=(r.imageheight-r.margin)/(r.tileheight+r.spacing),o.columns=(r.imagewidth-r.margin)/(r.tilewidth+r.spacing),o.total=o.rows*o.columns,b.push(o);for(u.tilesets=b,u.tiles=[],i=0;i<u.tilesets.length;i++){var r=u.tilesets[i],s=r.tileMargin,g=r.tileMargin,nt=0,k=0,tt=0;for(e=r.firstgid;e<r.firstgid+r.total;e++){if(u.tiles[e]=[s,g,i],s+=r.tileWidth+r.tileSpacing,nt++,nt===r.total)break;if(k++,k===r.columns&&(s=r.tileMargin,g+=r.tileHeight+r.tileSpacing,k=0,tt++,tt===r.rows))break}}return u}},n.Tileset=function(n,t,i,r,u,f,e){this.name=n;this.firstgid=t;this.tileWidth=i;this.tileHeight=r;this.tileMargin=u;this.tileSpacing=f;this.properties=e;this.image=null;this.rows=0;this.columns=0;this.total=0},n.Tileset.prototype={setSpacing:function(n,t){this.tileMargin=n;this.tileSpacing=t}},n.Tileset.prototype.constructor=n.Tileset,t.CanvasRenderer.prototype.render=function(i){t.texturesToUpdate.length=0;t.texturesToDestroy.length=0;t.visibleCount++;i.updateTransform();this.context.setTransform(1,0,0,1,0,0);n.CANVAS_CLEAR_RECT&&this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(i,!1);t.Texture.frameUpdates.length>0&&(t.Texture.frameUpdates.length=0)},t.CanvasRenderer.prototype.renderDisplayObject=function(i,r){var e=i.last._iNext,f,u;i=i.first;do{if(!i.visible&&!r){i=i.last._iNext;continue}if(!i.renderable||i.alpha===0){i=i._iNext;continue}i instanceof t.Sprite?i.texture.frame&&(this.context.globalAlpha=i.worldAlpha,n.CANVAS_PX_ROUND?this.context.setTransform(i.worldTransform[0],i.worldTransform[3],i.worldTransform[1],i.worldTransform[4],Math.floor(i.worldTransform[2]),Math.floor(i.worldTransform[5])):this.context.setTransform(i.worldTransform[0],i.worldTransform[3],i.worldTransform[1],i.worldTransform[4],i.worldTransform[2],i.worldTransform[5]),i.texture.trimmed&&this.context.transform(1,0,0,1,i.texture.trim.x,i.texture.trim.y),this.smoothProperty&&this.scaleMode!==i.texture.baseTexture.scaleMode&&(this.scaleMode=i.texture.baseTexture.scaleMode,this.context[this.smoothProperty]=this.scaleMode===t.BaseTexture.SCALE_MODE.LINEAR),this.context.drawImage(i.texture.baseTexture.source,i.texture.frame.x,i.texture.frame.y,i.texture.frame.width,i.texture.frame.height,Math.floor(i.anchor.x*-i.texture.frame.width),Math.floor(i.anchor.y*-i.texture.frame.height),i.texture.frame.width,i.texture.frame.height)):i instanceof t.Strip?(this.context.setTransform(i.worldTransform[0],i.worldTransform[3],i.worldTransform[1],i.worldTransform[4],i.worldTransform[2],i.worldTransform[5]),this.renderStrip(i)):i instanceof t.TilingSprite?(this.context.setTransform(i.worldTransform[0],i.worldTransform[3],i.worldTransform[1],i.worldTransform[4],i.worldTransform[2],i.worldTransform[5]),this.renderTilingSprite(i)):i instanceof t.CustomRenderable?i.renderCanvas(this):i instanceof t.Graphics?(this.context.setTransform(i.worldTransform[0],i.worldTransform[3],i.worldTransform[1],i.worldTransform[4],i.worldTransform[2],i.worldTransform[5]),t.CanvasGraphics.renderGraphics(i,this.context)):i instanceof t.FilterBlock&&(i.open?(this.context.save(),f=i.mask.alpha,u=i.mask.worldTransform,this.context.setTransform(u[0],u[3],u[1],u[4],u[2],u[5]),i.mask.worldAlpha=.5,this.context.worldAlpha=0,t.CanvasGraphics.renderGraphicsMask(i.mask,this.context),this.context.clip(),i.mask.worldAlpha=f):this.context.restore());i=i._iNext}while(i!=e)},t.WebGLBatch.prototype.update=function(){for(var u,d,g,nt,tt,o,s,h,c,n,l,a,v,y,f,e,w=0,i=this.head,p;i;){if(i.vcount===t.visibleCount){if(d=i.texture.frame.width,g=i.texture.frame.height,nt=i.anchor.x,tt=i.anchor.y,o=d*(1-nt),s=d*-nt,h=g*(1-tt),c=g*-tt,n=w*8,u=i.worldTransform,l=u[0],a=u[3],v=u[1],y=u[4],f=u[2],e=u[5],i.texture.trimmed&&(f+=i.texture.trim.x,e+=i.texture.trim.y),this.verticies[n+0]=l*s+v*c+f,this.verticies[n+1]=y*c+a*s+e,this.verticies[n+2]=l*o+v*c+f,this.verticies[n+3]=y*c+a*o+e,this.verticies[n+4]=l*o+v*h+f,this.verticies[n+5]=y*h+a*o+e,this.verticies[n+6]=l*s+v*h+f,this.verticies[n+7]=y*h+a*s+e,i.updateFrame||i.texture.updateFrame){this.dirtyUVS=!0;var it=i.texture,r=it.frame,b=it.baseTexture.width,k=it.baseTexture.height;this.uvs[n+0]=r.x/b;this.uvs[n+1]=r.y/k;this.uvs[n+2]=(r.x+r.width)/b;this.uvs[n+3]=r.y/k;this.uvs[n+4]=(r.x+r.width)/b;this.uvs[n+5]=(r.y+r.height)/k;this.uvs[n+6]=r.x/b;this.uvs[n+7]=(r.y+r.height)/k;i.updateFrame=!1}i.cacheAlpha!=i.worldAlpha&&(i.cacheAlpha=i.worldAlpha,p=w*4,this.colors[p]=this.colors[p+1]=this.colors[p+2]=this.colors[p+3]=i.worldAlpha,this.dirtyColors=!0)}else n=w*8,this.verticies[n+0]=0,this.verticies[n+1]=0,this.verticies[n+2]=0,this.verticies[n+3]=0,this.verticies[n+4]=0,this.verticies[n+5]=0,this.verticies[n+6]=0,this.verticies[n+7]=0;w++;i=i.__next}},n});
/*
//# sourceMappingURL=phaser.min.js.map
*/